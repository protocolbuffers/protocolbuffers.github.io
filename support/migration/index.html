<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Migration Guide | Protocol Buffers Documentation</title>
<meta name=description content="A list of the breaking changes made to versions of the libraries, and how to update your code to accommodate the changes."><meta property="og:title" content="Migration Guide"><meta property="og:description" content="A list of the breaking changes made to versions of the libraries, and how to update your code to accommodate the changes."><meta property="og:type" content="article"><meta property="og:url" content="https://protobuf.dev/support/migration/"><meta property="article:section" content="support"><meta itemprop=name content="Migration Guide"><meta itemprop=description content="A list of the breaking changes made to versions of the libraries, and how to update your code to accommodate the changes."><meta itemprop=wordCount content="3172"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Migration Guide"><meta name=twitter:description content="A list of the breaking changes made to versions of the libraries, and how to update your code to accommodate the changes."><link rel=preload href=/scss/main.min.27bc098c9a8f7a1246d474f5c8afcee53760c9c7f38125d343ff52e0bf493011.css as=style integrity="sha256-J7wJjJqPehJG1HT1yK/O5TdgycfzgSXTQ/9S4L9JMBE=" crossorigin=anonymous><link href=/scss/main.min.27bc098c9a8f7a1246d474f5c8afcee53760c9c7f38125d343ff52e0bf493011.css rel=stylesheet integrity="sha256-J7wJjJqPehJG1HT1yK/O5TdgycfzgSXTQ/9S4L9JMBE=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-5L8P8GRN4Y"></script><script>var doNotTrack=!1,dnt;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-5L8P8GRN4Y")}</script></head><body class=td-page><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>Protocol Buffers Documentation</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav></ul></div><div class="d-none d-lg-block"><div class=td-search><div class=td-search__icon></div><input type=search class="td-search__input form-control td-search-input" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><div class=td-search><div class=td-search__icon></div><input type=search class="td-search__input form-control td-search-input" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="td-sidebar-nav collapse td-sidebar-nav--search-disabled" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m--li><a href=/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-><span>Protocol Buffers</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-overview-li><a href=/overview/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-overview><span>Overview</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-installation-li><a href=/installation/ title="Protocol Buffer Compiler Installation" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-installation><span>Protoc Installation</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-news-li><a href=/news/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-news><span>News</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-programming-guides-li><a href=/programming-guides/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-programming-guides><span>Programming Guides</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guideseditions-li><a href=/programming-guides/editions/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guideseditions><span>Language Guide (editions)</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesproto2-li><a href=/programming-guides/proto2/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesproto2><span>Language Guide (proto 2)</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesproto3-li><a href=/programming-guides/proto3/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesproto3><span>Language Guide (proto 3)</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesproto-limits-li><a href=/programming-guides/proto-limits/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesproto-limits><span>Proto Limits</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesstyle-li><a href=/programming-guides/style/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesstyle><span>Style Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesenum-li><a href=/programming-guides/enum/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesenum><span>Enum Behavior</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesencoding-li><a href=/programming-guides/encoding/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesencoding><span>Encoding</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesjson-li><a href=/programming-guides/json/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesjson><span>ProtoJSON Format</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidestechniques-li><a href=/programming-guides/techniques/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidestechniques><span>Techniques</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesaddons-li><a href=/programming-guides/addons/ title="Third-Party Add-ons" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesaddons><span>Add-ons</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesextension_declarations-li><a href=/programming-guides/extension_declarations/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesextension_declarations><span>Extension Declarations</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesfield_presence-li><a href=/programming-guides/field_presence/ title="Application Note: Field Presence" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesfield_presence><span>Field Presence</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesserialization-not-canonical-li><a href=/programming-guides/serialization-not-canonical/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesserialization-not-canonical><span>Proto Serialization Is Not Canonical</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesdeserialize-debug-li><a href=/programming-guides/deserialize-debug/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesdeserialize-debug><span>Deserializing Debug Proto Representations</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-editions-li><a href=/editions/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-editions><span>Protobuf Editions</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-editionsoverview-li><a href=/editions/overview/ title="Protobuf Editions Overview" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-editionsoverview><span>Overview</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-editionsfeatures-li><a href=/editions/features/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-editionsfeatures><span>Feature Settings for Editions</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-editionsimplementation-li><a href=/editions/implementation/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-editionsimplementation><span>Implementing Editions Support</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-design-decisions-li><a href=/design-decisions/ title="Protobuf Team Design Decisions" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-design-decisions><span>Design Decisions</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-design-decisionsnullable-getters-setters-li><a href=/design-decisions/nullable-getters-setters/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-design-decisionsnullable-getters-setters><span>No Nullable Setters/Getters Support</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-best-practices-li><a href=/best-practices/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-best-practices><span>Proto Best Practices</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-best-practicesno-cargo-cults-li><a href=/best-practices/no-cargo-cults/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-best-practicesno-cargo-cults><span>Avoid Cargo Culting</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-best-practicesdos-donts-li><a href=/best-practices/dos-donts/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-best-practicesdos-donts><span>Proto Best Practices</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-best-practicesapi-li><a href=/best-practices/api/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-best-practicesapi><span>API Best Practices</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-best-practices1-1-1-li><a href=/best-practices/1-1-1/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-best-practices1-1-1><span>1-1-1 Best Practice</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-getting-started-li><a href=/getting-started/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-getting-started><span>Tutorials</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedcpptutorial-li><a href=/getting-started/cpptutorial/ title="Protocol Buffer Basics: C++" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedcpptutorial><span>C++</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedcsharptutorial-li><a href=/getting-started/csharptutorial/ title="Protocol Buffer Basics: C#" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedcsharptutorial><span>C#</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-starteddarttutorial-li><a href=/getting-started/darttutorial/ title="Protocol Buffer Basics: Dart" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-getting-starteddarttutorial><span>Dart</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedgotutorial-li><a href=/getting-started/gotutorial/ title="Protocol Buffer Basics: Go" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedgotutorial><span>Go</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedjavatutorial-li><a href=/getting-started/javatutorial/ title="Protocol Buffer Basics: Java" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedjavatutorial><span>Java</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedkotlintutorial-li><a href=/getting-started/kotlintutorial/ title="Protocol Buffer Basics: Kotlin" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedkotlintutorial><span>Kotlin</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedpythontutorial-li><a href=/getting-started/pythontutorial/ title="Protocol Buffer Basics: Python" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedpythontutorial><span>Python</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-reference-li><a href=/reference/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-reference><span>Reference Guides</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencecpp-li><a href=/reference/cpp/ title="C++ Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referencecpp><span>C++</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecppcpp-generated-li><a href=/reference/cpp/cpp-generated/ title="C++ Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencecppcpp-generated><span>Generated Code Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecppstring-view-li><a href=/reference/cpp/string-view/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencecppstring-view><span>String View APIs</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecpparenas-li><a href=/reference/cpp/arenas/ title="C++ Arena Allocation Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencecpparenas><span>Arena Allocation Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecppabseil-li><a href=/reference/cpp/abseil/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencecppabseil><span>Abseil Support</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecppapi-docs-link-li><a href=/reference/cpp/api-docs/ target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencecppapi-docs-link><span>C++ API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencecsharp-li><a href=/reference/csharp/ title="C# Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referencecsharp><span>C#</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecsharpcsharp-generated-li><a href=/reference/csharp/csharp-generated/ title="C# Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencecsharpcsharp-generated><span>Generated Code Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecsharpapi-docs-link-li><a href=/reference/csharp/api-docs target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencecsharpapi-docs-link><span>C# API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencedart-li><a href=/reference/dart/ title="Dart Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referencedart><span>Dart</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencedartdart-generated-li><a href=/reference/dart/dart-generated/ title="Dart Generated Code" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencedartdart-generated><span>Generated Code</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencedartapi-docs-link-li><a href=https://pub.dartlang.org/documentation/protobuf target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencedartapi-docs-link><span>Dart API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencego-li><a href=/reference/go/ title="Go Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referencego><span>Go</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencegogo-generated-li><a href=/reference/go/go-generated/ title="Go Generated Code Guide (Open)" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencegogo-generated><span>Generated Code Guide (Open)</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencegogo-generated-opaque-li><a href=/reference/go/go-generated-opaque/ title="Go Generated Code Guide (Opaque)" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencegogo-generated-opaque><span>Generated Code Guide (Opaque)</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencegofaq-li><a href=/reference/go/faq/ title="Go FAQ" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencegofaq><span>FAQ</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencegosize-li><a href=/reference/go/size/ title="Go Size Semantics" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencegosize><span>Size Semantics</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencegoapi-docs-link-li><a href=https://pkg.go.dev/google.golang.org/protobuf/proto target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencegoapi-docs-link><span>Go API</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencegoopaque-migration-li><a href=/reference/go/opaque-migration/ title="Go Opaque API Migration" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencegoopaque-migration><span>Opaque API Migration</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencegoopaque-migration-manual-li><a href=/reference/go/opaque-migration-manual/ title="Go Opaque API: Manual Migration" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencegoopaque-migration-manual><span>Opaque API: Manual Migration</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencegoopaque-faq-li><a href=/reference/go/opaque-faq/ title="Go Opaque API FAQ" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencegoopaque-faq><span>Opaque API FAQ</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencejava-li><a href=/reference/java/ title="Java Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referencejava><span>Java</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencejavajava-generated-li><a href=/reference/java/java-generated/ title="Java Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencejavajava-generated><span>Generated Code Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencejavajava-proto-names-li><a href=/reference/java/java-proto-names/ title="Java Proto Names" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencejavajava-proto-names><span>Generated Proto Names</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencejavaapi-docs-link-li><a href=/reference/java/api-docs/overview-summary.html target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencejavaapi-docs-link><span>Java API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencekotlin-li><a href=/reference/kotlin/ title="Kotlin Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referencekotlin><span>Kotlin</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencekotlinapi-docs-li><a href=/reference/kotlin/api-docs/ title="Kotlin Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referencekotlinapi-docs><span>Kotlin</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencekotlinkotlin-generated-li><a href=/reference/kotlin/kotlin-generated/ title="Kotlin Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencekotlinkotlin-generated><span>Generated Code Guide</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referenceobjective-c-li><a href=/reference/objective-c/ title="Objective-C Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referenceobjective-c><span>Objective-C</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceobjective-cobjective-c-generated-li><a href=/reference/objective-c/objective-c-generated/ title="Objective-C Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referenceobjective-cobjective-c-generated><span>Generated Code Guide</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencephp-li><a href=/reference/php/ title="PHP Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referencephp><span>PHP</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencephpphp-generated-li><a href=/reference/php/php-generated/ title="PHP Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencephpphp-generated><span>Generated Code Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencephpapi-docs-link-li><a href=/reference/php/api-docs/ target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencephpapi-docs-link><span>PHP API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencepython-li><a href=/reference/python/ title="Python Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referencepython><span>Python</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencepythonpython-generated-li><a href=/reference/python/python-generated/ title="Python Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencepythonpython-generated><span>Generated Code Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencepythonapi-docs-link-li><a href=https://googleapis.dev/python/protobuf/latest/ target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencepythonapi-docs-link><span>Python API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referenceruby-li><a href=/reference/ruby/ title="Ruby Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referenceruby><span>Ruby</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencerubyruby-generated-li><a href=/reference/ruby/ruby-generated/ title="Ruby Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencerubyruby-generated><span>Generated Code Guide</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referenceprotobuf-li><a href=/reference/protobuf/ title="Protocol Buffers Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referenceprotobuf><span>Protocol Buffers</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceprotobufedition-2023-spec-li><a href=/reference/protobuf/edition-2023-spec/ title="Protocol Buffers Edition 2023 Language Specification" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referenceprotobufedition-2023-spec><span>2023 Language Specification</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceprotobufproto2-spec-li><a href=/reference/protobuf/proto2-spec/ title="Protocol Buffers Version 2 Language Specification" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referenceprotobufproto2-spec><span>Version 2 Language Specification</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceprotobufproto3-spec-li><a href=/reference/protobuf/proto3-spec/ title="Protocol Buffers Version 3 Language Specification" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referenceprotobufproto3-spec><span>Version 3 Language Specification</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceprotobuftextformat-spec-li><a href=/reference/protobuf/textformat-spec/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referenceprotobuftextformat-spec><span>Text Format Language Specification</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceprotobufgoogleprotobuf-li><a href=/reference/protobuf/google.protobuf/ title="Protocol Buffers Well-Known Types" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referenceprotobufgoogleprotobuf><span>Well-Known Types</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceother-li><a href=/reference/other/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referenceother><span>Other Languages</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-support-li><a href=/support/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-support><span>Support</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-supportversion-support-li><a href=/support/version-support/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-supportversion-support><span>Version Support</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-supportmigration-li><a href=/support/migration/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-supportmigration><span class=td-sidebar-nav-active-item>Migration Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-supportcross-version-runtime-guarantee-li><a href=/support/cross-version-runtime-guarantee/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-supportcross-version-runtime-guarantee><span>Cross-Version Runtime Guarantee</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-downloads-li><a href=/downloads/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-downloads><span>Downloads</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-history-li><a href=/history/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-history><span>History</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-forum-link-li><a href=https://groups.google.com/g/protobuf target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-forum-link><span>Forum</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-navbar-li><a href=/navbar/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-navbar><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-search-li><a href=/search/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-search><span>Search Results</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/protocolbuffers/protocolbuffers.github.io/tree/main/content/support/migration.md class=td-page-meta--view target=_blank rel=noopener><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
<a href=https://github.com/protocolbuffers/protocolbuffers.github.io/edit/main/content/support/migration.md class=td-page-meta--edit target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
<a href="https://github.com/protocolbuffers/protocolbuffers.github.io/new/main/content/support/migration.md?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class=td-page-meta--child target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
<a href="https://github.com/protocolbuffers/protocolbuffers.github.io/issues/new?title=Migration%20Guide" class=td-page-meta--issue target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create documentation issue</a>
<a href=https://github.com/protocolbuffers/protobuf/issues/new class=td-page-meta--project-issue target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create project issue</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#v30>Changes in v30.0</a><ul><li><a href=#replaced-cmake-submodules-with-fetched-deps>Replaced CMake Submodules with Fetched Deps</a></li><li><a href=#string_view-return-type>string_view return type</a></li><li><a href=#poison-msvc--bazel>Poison MSVC + Bazel</a></li><li><a href=#ctype-removed>ctype Removed from FieldDescriptor Options</a></li><li><a href=#debug-redaction>Modified Debug APIs to Redact Sensitive Fields</a></li><li><a href=#remove-deprecated>Removed Deprecated APIs</a></li><li><a href=#drop-cpp-14>Dropped C++14 Support</a></li><li><a href=#introduced-asan-poisoning-after-clearing-oneof-messages-on-arena>Introduced ASAN Poisoning After Clearing Oneof Messages on Arena</a></li><li><a href=#dropped-our-c-cocoapods-release>Dropped our C++ CocoaPods release</a></li><li><a href=#python>Changes in Python</a></li><li><a href=#objc>Changes in Objective-C</a></li><li><a href=#poison>Poison Pill Warnings</a></li><li><a href=#utf-8-enforcement>Changes to UTF-8 Enforcement in C# and Ruby</a></li><li><a href=#ruby-and-php-errors-in-json-parsing>Ruby and PHP Errors in JSON Parsing</a></li></ul></li><li><a href=#compiler-22>Compiler Changes in v22.0</a><ul><li><a href=#json-field-names>JSON Field Name Conflicts</a></li></ul></li><li><a href=#cpp-22>C++ API Changes in v22.0</a><ul><li><a href=#autotools>Autotools Turndown</a></li><li><a href=#abseil>Abseil Dependency</a></li><li><a href=#getcurrenttime>Changes in GetCurrentTime Method</a></li></ul></li><li><a href=#cpp20>C++20 Support</a><ul><li><a href=#final-classes>Final Classes</a></li><li><a href=#container-static-assertions>Container Static Assertions</a></li><li><a href=#cleared-elements>Cleared Element Deprecation</a></li><li><a href=#unsafe-arena>UnsafeArena Deprecation</a></li><li><a href=#map-pairs>Map Pair Upgrades</a></li><li><a href=#json-parser>New JSON Parser</a></li><li><a href=#arena-init><code>Arena::Init</code></a></li><li><a href=#error-collector>ErrorCollector Migration</a></li></ul></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=/support/>Support</a></li><li class="breadcrumb-item active" aria-current=page>Migration Guide</li></ol></nav><div class=td-content><h1>Migration Guide</h1><div class=lead>A list of the breaking changes made to versions of the libraries, and how to update your code to accommodate the changes.</div><header class=article-meta></header><h2 id=v30>Changes in v30.0</h2><p>The following is a list of the breaking changes made to versions of the
libraries, and how to update your code to accommodate the changes.</p><p>This covers breaking changes announced in
<a href=/news/v30>News Announcements for v30.x</a> and
<a href=https://github.com/protocolbuffers/protobuf/releases/tag/v30.0>Release Notes for v30.0</a>.</p><h3 id=replaced-cmake-submodules-with-fetched-deps>Replaced CMake Submodules with Fetched Deps</h3><p>Previously, our default CMake behavior was to use Git submodules to grab pinned
dependencies. Specifying <code>-Dprotobuf_ABSL_PROVIDER=package</code> would flip our CMake
configs to look for local installations of Abseil (with similar options for
jsoncpp and gtest). These options no longer exist, and the default behavior is
to first look for installations of all our dependencies, falling back to
fetching pinned versions from GitHub if needed.</p><p>To prevent any fallback fetching (similar to the old <code>package</code> behavior), you
can call CMake with:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cmake data-lang=cmake><span style=display:flex><span><span style=color:#a40000>cmake</span> <span style=color:#a40000>.</span> <span style=color:#a40000>-Dprotobuf_LOCAL_DEPENDENCIES_ONLY=ON
</span></span></span></code></pre></div><p>To <em>always</em> fetch dependencies from a fixed version (similar to the old default
behavior), you can call CMake with:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cmake data-lang=cmake><span style=display:flex><span><span style=color:#a40000>cmake</span> <span style=color:#a40000>.</span> <span style=color:#a40000>-Dprotobuf_FORCE_FETCH_DEPENDENCIES=ON
</span></span></span></code></pre></div><h3 id=string_view-return-type>string_view return type</h3><p>Return types are now <code>absl::string_view</code> for the following descriptor APIs,
which opens up memory savings:</p><ul><li><code>MessageLite::GetTypeName</code></li><li><code>UnknownField::length_delimited</code></li><li>Descriptor API name functions, such as <code>FieldDescriptor::full_name</code></li></ul><p>We expect future breaking releases to continue migrating additional APIs to
<code>absl::string_view</code>.</p><p>In most cases, you should try to update types to use <code>absl::string_view</code> where
safe, or explicitly copy to the original type where needed. You may need to
update callers as well if this is returned in a function.</p><p>If the string returned by the affected API methods is being used as:</p><table><tr><th>Type</th><th>Migration</th></tr><tr><td><p><code>std::string</code></p></td><td><p>Explicitly convert to <code>std::string</code> to preserve the existing behavior.</p><p>Or, switch to the more performant <code>absl::string_view</code></p></td></tr><tr><td><p><code>const std::string&</code></p></td><td><p>Migrate to <code>absl::string_view</code></p><p>If infeasible (such as due to large number of dependencies), copying to a <code>std::string</code> might be easier.</p></td></tr><tr><td><p><code>const std::string*</code></p><p><code>const char*</code></p></td><td><p>If nullable, migrate to <code>std::optional&lt;absl::string_view></code>.</p><p>Otherwise, migrate to <code>absl::string_view</code>.</p><p>Be careful when calling <code>data()</code> since <code>absl::string_view</code> isn't guaranteed to be null-terminated.</td></tr></table><p>For common containers and other APIs, you may be able to migrate to variants
compatible with <code>absl::string_view</code>. Below are some common examples.</p><table><tr><th>Category</th><th>Pre-Migration</th><th>Migration</th></tr><tr><td>Insertion into <code>std::vector&lt;std::string></code></td><td><p><code>push_back()</code></p><p><code>push_front()</code></p><p><code>push()</code></p></td><td><p><code>emplace_back()</code></p><p><code>emplace_front()</code></p><p><code>emplace()</code></p></td></tr><tr><td>Insertion for map or sets</td><td><p><code>set.insert(key)</code></p><p><code>map.insert({key, value})</code></p><p><code>map.insert({key,<br>{value_params...}})</code></p></td><td><p><code>set.emplace(key)</code></p><p><code>map.emplace(key, value)</code></p><p><code>map.try_emplace(key,<br>value_params...)</code></p></td></tr><tr><td>Lookup for map or sets</td><td><p><code>find()</code></p><p><code>count()</code></p><p><code>contains()</code></p></td><td><p>Migrate to Abseil containers.</p><p>Or, define a transparent comparator.</p><p><code>std::set&lt;std::string, std::less&lt;>><br>std::map&lt;std::string, T, std::less&lt;>></code></p><p>See <a href=https://abseil.io/tips/144>https://abseil.io/tips/144</a></p></td></tr><tr><td>String Concatenation</td><td><p><code>operator+</code></p><p><code>operator+=</code></p></td><td><p><code>absl::StrCat()</code></p><p><code>absl::StrAppend()</code></p><p>These are recommended for performance reasons anyways. See <a href=https://abseil.io/tips/3>https://abseil.io/tips/3</a>.</p></td></tr></table><p>See also <a href=https://abseil.io/tips/1>https://abseil.io/tips/1</a> for general tips
around using <code>absl::string_view</code>.</p><h3 id=poison-msvc--bazel>Poison MSVC + Bazel</h3><p>Bazel users on Windows should switch to using clang-cl by adding the following
to their project, like in this
<a href=https://github.com/protocolbuffers/protobuf/commit/117e7bbe74ac7c7faa9b6f44c1b22de366302854#diff-48bcd3965c4a015a8f61ad82b225790209baef37363ee0478519536a620a85e5>example</a>.</p><p><strong>.bazelrc</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span><span style=color:#000>common</span> <span style=color:#ce5c00;font-weight:700>--</span><span style=color:#000>enable_platform_specific_config</span> <span style=color:#000>build</span><span style=color:#000;font-weight:700>:</span><span style=color:#000>windows</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>--</span><span style=color:#000>extra_toolchains</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#a40000>@</span><span style=color:#000>local_config_cc</span><span style=color:#ce5c00;font-weight:700>//</span><span style=color:#000;font-weight:700>:</span><span style=color:#000>cc</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>toolchain</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>x64_windows</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>clang</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>cl</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>--</span><span style=color:#000>extra_execution_platforms</span><span style=color:#ce5c00;font-weight:700>=//</span><span style=color:#000;font-weight:700>:</span><span style=color:#000>x64_windows</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>clang</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>cl</span>
</span></span></code></pre></div><p><strong>MODULE.bazel</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>bazel_dep(name = &#34;platforms&#34;, version = &#34;0.0.10&#34;)
</span></span><span style=display:flex><span>bazel_dep(name = &#34;rules_cc&#34;, version = &#34;0.0.17&#34;)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span># For clang-cl configuration
</span></span><span style=display:flex><span>cc_configure = use_extension(&#34;@rules_cc//cc:extensions.bzl&#34;, &#34;cc_configure_extension&#34;)
</span></span><span style=display:flex><span>use_repo(cc_configure, &#34;local_config_cc&#34;)
</span></span></code></pre></div><p><strong>WORKSPACE</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span><span style=color:#204a87>load</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;//:protobuf_deps.bzl&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;PROTOBUF_MAVEN_ARTIFACTS&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;protobuf_deps&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>protobuf_deps</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87>load</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;@rules_cc//cc:repositories.bzl&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;rules_cc_dependencies&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;rules_cc_toolchains&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>rules_cc_dependencies</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>rules_cc_toolchains</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><p><strong>BUILD</strong></p><p>For users that need compatibility with Bazel 8 only.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span><span style=color:#000>platform</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;x64_windows-clang-cl&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>constraint_values</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;@platforms//cpu:x86_64&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;@platforms//os:windows&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;@bazel_tools//tools/cpp:clang-cl&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>For users that need compatibility with Bazel 7 and 8.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span><span style=color:#000>platform</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;x64_windows-clang-cl&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>constraint_values</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;@platforms//cpu:x86_64&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;@platforms//os:windows&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic># See https://github.com/bazelbuild/rules_cc/issues/330.</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;@rules_cc//cc/private/toolchain:clang-cl&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>Users can also temporarily silence the error by setting the opt-out flag
<code>--define=protobuf_allow_msvc=true</code> until the next breaking release.</p><p>Alternatively, users that wish to continue using MSVC may switch to using CMake.
This can be done with
<a href="https://learn.microsoft.com/en-us/cpp/build/cmake-projects-in-visual-studio?view=msvc-170">Visual Studio</a>,
or by supplying the CMake command-line an MSVC generator. For example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cmake data-lang=cmake><span style=display:flex><span><span style=color:#a40000>cmake</span> <span style=color:#a40000>-G</span> <span style=color:#a40000>&#34;Visual</span> <span style=color:#a40000>Studio</span> <span style=color:#a40000>17</span> <span style=color:#a40000>2022&#34;</span> <span style=color:#a40000>-A</span> <span style=color:#a40000>Win64</span> <span style=color:#a40000>.
</span></span></span></code></pre></div><h3 id=ctype-removed>ctype Removed from FieldDescriptor Options</h3><p>We stopped exposing the <code>ctype</code> from <code>FieldDescriptor</code> options. You can use the
<code>FieldDescriptor::cpp_string_type()</code> API, added in the
<a href=https://github.com/protocolbuffers/protobuf/releases/tag/v28.0>v28 release</a>,
in its place.</p><h3 id=debug-redaction>Modified Debug APIs to Redact Sensitive Fields</h3><p>The Protobuf C++ debug APIs (including Protobuf AbslStringify,
<code>proto2::ShortFormat</code>, <code>proto2::Utf8Format</code>, <code>Message::DebugString</code>,
<code>Message::ShortDebugString</code>, <code>Message::Utf8DebugString</code>) changed to redact
sensitive fields annotated by <code>debug_redact</code>; the outputs of these APIs contain
a per-process randomized prefix, and are no longer parseable by Protobuf
TextFormat Parsers. Users should adopt the new redacted debug format for most
cases requiring a human-readable output (such as logging), or consider switching
to binary format for serialization and deserialization. Users who need the old
deserializable format can use <code>TextFormat.printer().printToString(proto)</code>, but
this does not redact sensitive fields and so should be used with caution.</p><p>Read more about this in the
<a href=/news/2024-12-04.md>news article released December 4, 2024</a>.</p><h3 id=remove-deprecated>Removed Deprecated APIs</h3><p>We removed the following public runtime APIs, which have been marked deprecated
(such as <code>ABSL_DEPRECATED</code>) for at least one minor or major release and that are
obsolete or replaced.</p><p><strong>API:</strong>
<a href=https://github.com/protocolbuffers/protobuf/blob/f4b57b98b08aec8bc52e6a7b762edb7a1b9e8883/src/google/protobuf/arena.h#L179><code>Arena::CreateMessage</code></a></p><p><strong>Replacement:</strong>
<a href=https://github.com/protocolbuffers/protobuf/blob/f4b57b98b08aec8bc52e6a7b762edb7a1b9e8883/src/google/protobuf/arena.h#L191><code>Arena::Create</code></a></p><p><strong>API:</strong>
<a href=https://github.com/protocolbuffers/protobuf/blob/237332ef92daf83a53e76decd6ac43c3fcee782b/src/google/protobuf/arena.h#L346><code>Arena::GetArena</code></a></p><p><strong>Replacement:</strong> <code>value->GetArena()</code></p><p><strong>API:</strong>
<a href=https://github.com/protocolbuffers/protobuf/blame/f4b57b98b08aec8bc52e6a7b762edb7a1b9e8883/src/google/protobuf/repeated_ptr_field.h#L1157><code>RepeatedPtrField::ClearedCount</code></a></p><p><strong>Replacement:</strong> Migrate to Arenas
(<a href=https://protobuf.dev/support/migration/#cleared-elements>migration guide</a>).</p><p><strong>API:</strong>
<a href=https://github.com/protocolbuffers/protobuf/blob/f4b57b98b08aec8bc52e6a7b762edb7a1b9e8883/src/google/protobuf/util/json_util.h#L22><code>JsonOptions</code></a></p><p><strong>Replacement:</strong> <code>JsonPrintOptions</code></p><h3 id=drop-cpp-14>Dropped C++14 Support</h3><p>This release dropped C++ 14 as the minimum supported version and raised it to
17, as per the
<a href=https://github.com/google/oss-policies-info/blob/main/foundational-cxx-support-matrix.md>Foundational C++ Support matrix</a>.</p><p>Users should upgrade to C++17.</p><h3 id=introduced-asan-poisoning-after-clearing-oneof-messages-on-arena>Introduced ASAN Poisoning After Clearing Oneof Messages on Arena</h3><p>This change added a hardening check that affects C++ protobufs using Arenas.
Oneof messages allocated on the protobuf arena are now cleared in debug and
poisoned in ASAN mode. After calling clear, future attempts to use the memory
region will cause a crash in ASAN as a use-after-free error.</p><p>This implementation requires C++17.</p><h3 id=dropped-our-c-cocoapods-release>Dropped our C++ CocoaPods release</h3><p>We dropped our C++ CocoaPods release, which has been broken since v4.x.x. C++
users should use our
<a href=https://github.com/protocolbuffers/protobuf/releases>GitHub release</a> directly
instead.</p><h3 id=python>Changes in Python</h3><p>Python bumped its major version from 5.29.x to 6.30.x.</p><h4 id=dropped-python-38-support>Dropped Python 3.8 Support</h4><p>The minimum supported Python version is 3.9. Users should upgrade.</p><h4 id=python-remove-alias>Removed bazel/system_python.bzl Alias</h4><p>We removed the legacy <code>bazel/system_python.bzl</code> alias.</p><p>Remove direct references to <code>system_python.bzl</code> in favor of using
<code>protobuf_deps.bzl</code> instead. Use <code>python/dist/system_python.bzl</code> where it was
moved
<a href=https://github.com/protocolbuffers/protobuf/commit/d7f032ad1596ceeabd45ca1354516c39b97b2551>in v5.27.0</a>
if you need a direct reference.</p><h4 id=python-setter-validation>Field Setter Validation Changes</h4><p>Python&rsquo;s and upb&rsquo;s field setters now validate closed enums under edition 2023.
Closed enum fields updated with invalid values generate errors.</p><h4 id=removed-deprecated-py_proto_library-macro>Removed Deprecated py_proto_library Macro</h4><p>The deprecated internal <code>py_proto_library</code> Bazel macro in <code>protobuf.bzl</code> was
removed. It was replaced by the official <code>py_proto_library</code> which was moved to
protobuf in <code>bazel/py_proto_library</code> in v29.x. This implementation was
previously available in <code>rules_python</code> prior to v29.x.</p><h4 id=python-remove-apis>Remove Deprecated APIs</h4><p>We removed the following public runtime APIs, which had been marked deprecated
for at least one minor or major release.</p><h5 id=reflection-methods>Reflection Methods</h5><p><strong>APIs:</strong>
<a href=https://github.com/protocolbuffers/protobuf/blob/7f395af40e86e00b892e812beb67a03564884756/python/google/protobuf/reflection.py#L40><code>reflection.ParseMessage</code></a>,
<a href=https://github.com/protocolbuffers/protobuf/blob/7f395af40e86e00b892e812beb67a03564884756/python/google/protobuf/reflection.py#L66><code>reflection.MakeClass</code></a></p><p><strong>Replacement:</strong> <code>message_factory.GetMessageClass()</code></p><h5 id=rpc-service-interfaces>RPC Service Interfaces</h5><p><strong>APIs:</strong>
<a href=https://github.com/protocolbuffers/protobuf/blob/21c545c8c5cec0b052dc7715b778f0353d37d02c/python/google/protobuf/service.py#L23><code>service.RpcException</code></a>,
<a href=https://github.com/protocolbuffers/protobuf/blob/21c545c8c5cec0b052dc7715b778f0353d37d02c/python/google/protobuf/service.py#L28><code>service.Service</code></a>,
<a href=https://github.com/protocolbuffers/protobuf/blob/21c545c8c5cec0b052dc7715b778f0353d37d02c/python/google/protobuf/service.py#L97><code>service.RpcController</code></a>,
and
<a href=https://github.com/protocolbuffers/protobuf/blob/21c545c8c5cec0b052dc7715b778f0353d37d02c/python/google/protobuf/service.py#L180><code>service.RpcChannel</code></a></p><p><strong>Replacement:</strong> Starting with version 2.3.0, RPC implementations should not try
to build on these, but should instead provide code generator plugins which
generate code specific to the particular RPC implementation.</p><h5 id=messagefactory-and-symboldatabase-methods>MessageFactory and SymbolDatabase Methods</h5><p><strong>APIs:</strong>
<a href=https://github.com/protocolbuffers/protobuf/blob/7f395af40e86e00b892e812beb67a03564884756/python/google/protobuf/message_factory.py#L145><code>MessageFactory.GetPrototype</code></a>,
<a href=https://github.com/protocolbuffers/protobuf/blob/7f395af40e86e00b892e812beb67a03564884756/python/google/protobuf/message_factory.py#L165><code>MessageFactory.CreatePrototype</code></a>,
<a href=https://github.com/protocolbuffers/protobuf/blob/7f395af40e86e00b892e812beb67a03564884756/python/google/protobuf/message_factory.py#L185><code>MessageFactory.GetMessages</code></a>,
<a href=https://github.com/protocolbuffers/protobuf/blob/7f395af40e86e00b892e812beb67a03564884756/python/google/protobuf/symbol_database.py#L54><code>SymbolDatabase.GetPrototype</code></a>,
<a href=https://github.com/protocolbuffers/protobuf/blob/7f395af40e86e00b892e812beb67a03564884756/python/google/protobuf/symbol_database.py#L60><code>SymbolDatabase.CreatePrototype</code></a>,
and
<a href=https://github.com/protocolbuffers/protobuf/blob/7f395af40e86e00b892e812beb67a03564884756/python/google/protobuf/symbol_database.py#L66><code>SymbolDatabase.GetMessages</code></a></p><p><strong>Replacement:</strong> <code>message_factory.GetMessageClass()</code> and
<code>message_factory.GetMessageClassesForFiles()</code>.</p><h5 id=getdebugstring>GetDebugString</h5><p><strong>APIs:</strong>
<a href=https://github.com/protocolbuffers/protobuf/blob/7f395af40e86e00b892e812beb67a03564884756/python/google/protobuf/pyext/descriptor.cc#L1510><code>GetDebugString</code></a></p><p><strong>Replacement:</strong></p><p>No replacement. It&rsquo;s only in Python C++ which is no longer released. It is not
supported in pure Python or UPB.</p><h4 id=python-setdefault-behavior-change-for-map-fields>Python setdefault Behavior Change for Map Fields</h4><p><code>setdefault</code> is similar to <code>dict</code> for <code>ScalarMap</code>, except that both key and
value must be set. <code>setdefault</code> is rejected for <code>MessageMaps</code>.</p><h4 id=python-nested-message-class-__qualname__-contains-the-outer-message-name>Python Nested Message Class __qualname__ Contains the Outer Message Name</h4><p>Python nested message class <code>__qualname__</code> now contains the outer message name.
Previously, <code>__qualname__</code> had the same result with <code>__name__</code> for nested
message, in that the outer message name was not included.</p><p>For example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>message</span> <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>message</span> <span style=color:#000>Bar</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87>bool</span> <span style=color:#000>bool_field</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000>nested</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>test_pb2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Bar</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>assertEqual</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;Bar&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>nested</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>__class__</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>__name__</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>assertEqual</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;Foo.Bar&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>nested</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>__class__</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>__qualname__</span><span style=color:#000;font-weight:700>)</span> <span style=color:#8f5902;font-style:italic># It was &#39;Bar&#39; before</span>
</span></span></code></pre></div><h3 id=objc>Changes in Objective-C</h3><p><strong>This is the first breaking release for Objective-C</strong>.</p><p>Objective-C bumped its major version from 3.x.x to 4.30.x.</p><h4 id=objc-field-handling>Overhauled Unknown Field Handling APIs Deprecating Most of the Existing APIs</h4><p>We deprecated <code>GPBUnknownFieldSet</code> and replaced it with <code>GPBUnknownFields</code>. The
new type preserves the ordering of unknown fields from the original input or API
calls, to ensure any semantic meaning to the ordering is maintained when a
message is written back out.</p><p>As part of this, the <code>GPBUnknownField</code> type also has APIs changes, with almost
all of the existing APIs deprecated and new ones added.</p><p>Deprecated property APIs:</p><ul><li><code>varintList</code></li><li><code>fixed32List</code></li><li><code>fixed64List</code></li><li><code>lengthDelimitedList</code></li><li><code>groupList</code></li></ul><p>Deprecated modification APIs:</p><ul><li><code>addVarint:</code></li><li><code>addFixed32:</code></li><li><code>addFixed64:</code></li><li><code>addLengthDelimited:</code></li><li><code>addGroup:</code></li></ul><p>Deprecated initializer <code>initWithNumber:</code>.</p><p>New property APIs:</p><ul><li><code>type</code></li><li><code>varint</code></li><li><code>fixed32</code></li><li><code>fixed64</code></li><li><code>lengthDelimited</code></li><li><code>group</code></li></ul><p>This type models a single field number in its value, rather than <em>grouping</em> all
the values for a given field number. The APIs for creating new fields are the
<code>add*</code> APIs on the <code>GPBUnknownFields</code> class.</p><p>We also deprecated <code>-[GPBMessage unknownFields]</code>. In its place, there are new
APIs to extract and update the unknown fields of the message.</p><h4 id=objc-remove-apis>Removed Deprecated APIs</h4><p>We removed the following public runtime APIs, which had been marked deprecated
for at least one minor or major release.</p><h5 id=gpbfiledescriptor>GPBFileDescriptor</h5><p><strong>API:</strong>
<a href=https://github.com/protocolbuffers/protobuf/blob/44bd65b2d3c0470d91a23cc14df5ffb1ab0af7cd/objectivec/GPBDescriptor.h#L118-L119>-[<code>GPBFileDescriptor</code> syntax]</a></p><p><strong>Replacement:</strong> Obsolete.</p><h5 id=gpbmessage-mergefromextensionregistry>GPBMessage mergeFrom:extensionRegistry</h5><p><strong>API:</strong>
<a href=https://github.com/protocolbuffers/protobuf/blob/44bd65b2d3c0470d91a23cc14df5ffb1ab0af7cd/objectivec/GPBMessage.h#L258-L261>-[<code>GPBMessage mergeFrom:extensionRegistry:</code>]</a></p><p><strong>Replacement:</strong>
<a href=https://github.com/protocolbuffers/protobuf/blob/44bd65b2d3c0470d91a23cc14df5ffb1ab0af7cd/objectivec/GPBMessage.h#L275-L277>-[<code>GPBMessage mergeFrom:extensionRegistry:error:</code>]</a></p><h5 id=gpbduration-timeintervalsince1970>GPBDuration timeIntervalSince1970</h5><p><strong>API:</strong>
<a href=https://github.com/protocolbuffers/protobuf/blob/29fca8a64b62491fb0a2ce61878e70eda88dde98/objectivec/GPBWellKnownTypes.h#L95-L100>-[<code>GPBDuration timeIntervalSince1970</code>]</a></p><p><strong>Replacement:</strong>
<a href=https://github.com/protocolbuffers/protobuf/blob/29fca8a64b62491fb0a2ce61878e70eda88dde98/objectivec/GPBWellKnownTypes.h#L74-L89>-[<code>GPBDuration timeInterval</code>]</a></p><h5 id=gpbtextformatforunknownfieldset>GPBTextFormatForUnknownFieldSet</h5><p><strong>API:</strong>
<a href=https://github.com/protocolbuffers/protobuf/blob/29fca8a64b62491fb0a2ce61878e70eda88dde98/objectivec/GPBUtilities.h#L32-L43><code>GPBTextFormatForUnknownFieldSet()</code></a></p><p><strong>Replacement:</strong> Obsolete - Use
<a href=https://github.com/protocolbuffers/protobuf/blob/29fca8a64b62491fb0a2ce61878e70eda88dde98/objectivec/GPBUtilities.h#L20-L30><code>GPBTextFormatForMessage()</code></a>,
which includes any unknown fields.</p><h5 id=gpbunknownfieldset>GPBUnknownFieldSet</h5><p><strong>API:</strong>
<a href=https://github.com/protocolbuffers/protobuf/blob/224573d66a0cc958c76cb43d8b2eb3aa7cdb89f2/objectivec/GPBUnknownFieldSet.h><code>GPBUnknownFieldSet</code></a></p><p><strong>Replacement:</strong>
<a href=https://github.com/protocolbuffers/protobuf/blob/224573d66a0cc958c76cb43d8b2eb3aa7cdb89f2/objectivec/GPBUnknownFields.h><code>GPBUnknownFields</code></a></p><h5 id=gpbmessage-unknownfields>GPBMessage unknownFields</h5><p><strong>API:</strong>
<a href=https://github.com/protocolbuffers/protobuf/blob/224573d66a0cc958c76cb43d8b2eb3aa7cdb89f2/objectivec/GPBMessage.h#L73-L76><code>GPBMessage unknownFields</code> property</a></p><p><strong>Replacement:</strong>
<a href=https://github.com/protocolbuffers/protobuf/blob/224573d66a0cc958c76cb43d8b2eb3aa7cdb89f2/objectivec/GPBUnknownFields.h#L30-L38>-[<code>GPBUnknownFields initFromMessage:</code>]</a>,
<a href=https://github.com/protocolbuffers/protobuf/blob/f26bdff7cc0bb7e8ed88253ba16f81614a26cf16/objectivec/GPBMessage.h#L506-L528>-[<code>GPBMessage mergeUnknownFields:extensionRegistry:error:</code>]</a>,
and
<a href=https://github.com/protocolbuffers/protobuf/blob/224573d66a0cc958c76cb43d8b2eb3aa7cdb89f2/objectivec/GPBMessage.h#L497-L504C9>-[<code>GPBMessage clearUnknownFields</code>]</a></p><h4 id=objc-remove-apis-gencode>Removed Deprecated Runtime APIs for Old Gencode</h4><p>This release removed deprecated runtime methods that supported the Objective-C
gencode from before the 3.22.x release. The library also issues a log message at
runtime when old generated code is starting up.</p><p><strong>API:</strong> <a href=https://github.com/protocolbuffers/protobuf/blob/1b44ce0feef45a78ba99d09bd2e5ff5052a6541b/objectivec/GPBDescriptor_PackagePrivate.h#L213-L220><code>+[GPBFileDescriptor allocDescriptorForClass:file:fields:fieldCount:storageSize:flags:]</code></a></p><p><strong>Replacement:</strong> Regenerate with a current version of the library.</p><p><strong>API:</strong> <a href=https://github.com/protocolbuffers/protobuf/blob/1b44ce0feef45a78ba99d09bd2e5ff5052a6541b/objectivec/GPBDescriptor_PackagePrivate.h#L221-L229><code>+[GPBFileDescriptor allocDescriptorForClass:rootClass:file:fields:fieldCount:storageSize:flags:]</code></a></p><p><strong>Replacement:</strong> Regenerate with a current version of the library.</p><p><strong>API:</strong> <a href=https://github.com/protocolbuffers/protobuf/blob/1b44ce0feef45a78ba99d09bd2e5ff5052a6541b/objectivec/GPBDescriptor_PackagePrivate.h#L285-L291><code>+[GPBEnumDescriptor allocDescriptorForName:valueNames:values:count:enumVerifier:]</code></a></p><p><strong>Replacement:</strong> Regenerate with a current version of the library.</p><p><strong>API:</strong> <a href=https://github.com/protocolbuffers/protobuf/blob/1b44ce0feef45a78ba99d09bd2e5ff5052a6541b/objectivec/GPBDescriptor_PackagePrivate.h#L292-L299><code>+[GPBEnumDescriptor allocDescriptorForName:valueNames:values:count:enumVerifier:extraTextFormatInfo:]</code></a></p><p><strong>Replacement:</strong> Regenerate with a current version of the library.</p><p><strong>API:</strong>
<a href=https://github.com/protocolbuffers/protobuf/blob/1b44ce0feef45a78ba99d09bd2e5ff5052a6541b/objectivec/GPBDescriptor_PackagePrivate.h#L317-L320><code>-[GPBExtensionDescriptor initWithExtensionDescription:]</code></a></p><p><strong>Replacement:</strong> Regenerate with a current version of the library.</p><h3 id=poison>Poison Pill Warnings</h3><p>We updated poison pills to emit warnings for old gencode + new runtime
combinations that work under the new rolling upgrade policy, but will break in
the <em>next</em> major bump. For example, Python 4.x.x gencode should work against
5.x.x runtime but warn of upcoming breakage against 6.x.x runtime.</p><h3 id=utf-8-enforcement>Changes to UTF-8 Enforcement in C# and Ruby</h3><p>We included a fix to make UTF-8 enforcement consistent across languages. Users
with bad non-UTF8 data in string fields may see surfaced UTF-8 enforcement
errors earlier.</p><h3 id=ruby-and-php-errors-in-json-parsing>Ruby and PHP Errors in JSON Parsing</h3><p>We fixed non-conformance in JSON parsing of strings in numeric fields per the
<a href=https://protobuf.dev/programming-guides/json/>JSON spec</a>.</p><p>This fix is not accompanied by a major version bump, but Ruby and PHP now raise
errors for non-numeric strings (such as <code>""</code>, <code>"12abc"</code>, <code>"abc"</code>) in numeric
fields. v29.x includes a warning for these error cases.</p><h2 id=compiler-22>Compiler Changes in v22.0</h2><h3 id=json-field-names>JSON Field Name Conflicts</h3><p>Source of changes: <a href=https://github.com/protocolbuffers/protobuf/pull/11349>PR #11349</a>, <a href=https://github.com/protocolbuffers/protobuf/pull/10750>PR #10750</a></p><p>We&rsquo;ve made some subtle changes in how we handle field name conflicts with
respect to JSON mappings. In proto3, we&rsquo;ve partially loosened the restrictions
and only give errors when field names produce case-sensitive JSON mappings
(camel case of the original name). We now also check the <code>json_name</code> option, and
give errors for case-sensitive conflicts. In proto2, we&rsquo;ve tightened
restrictions a bit and will give errors if two <code>json_name</code> specifications
conflict. If implicit JSON mappings (camel case) have conflicts, we will give
warnings in proto2.</p><p>We&rsquo;ve provided a temporary message/enum option for restoring the legacy
behavior. If renaming the conflicting fields isn&rsquo;t an option you can take
immediately, set the <code>deprecated_legacy_json_field_conflicts</code> option on the
specific message/enum. This option will be removed in a future release, but
gives you more time to migrate.</p><h2 id=cpp-22>C++ API Changes in v22.0</h2><p>4.22.0 has breaking changes for C++ runtime and protoc, as
<a href=/news/2022-08-03#cpp-changes>announced in August</a>.</p><h3 id=autotools>Autotools Turndown</h3><p>Source of changes:
<a href=https://github.com/protocolbuffers/protobuf/pull/10132>PR #10132</a></p><p>In v22.0, we removed all Autotools support from the protobuf compiler and the
C++ runtime. If you&rsquo;re using Autotools to build either of these, you must
migrate to <a href=http://cmake.org>CMake</a> or <a href=http://bazel.build>Bazel</a>. We have
some
<a href=https://github.com/protocolbuffers/protobuf/blob/main/cmake/README.md>dedicated instructions</a>
for setting up protobuf with CMake.</p><h3 id=abseil>Abseil Dependency</h3><p>Source of changes:
<a href=https://github.com/protocolbuffers/protobuf/pull/10416>PR #10416</a></p><p>With v22.0, we&rsquo;ve taken on an explicit dependency on
<a href=https://github.com/abseil/abseil-cpp>Abseil</a>. This allowed us to remove most
of our
<a href=https://github.com/protocolbuffers/protobuf/tree/21.x/src/google/protobuf/stubs>stubs</a>,
which were branched from old internal code that later became Abseil. There are a
number of subtle behavior changes, but most should be transparent to users. Some
notable changes include:</p><ul><li><p><strong>string_view</strong> - <code>absl::string_view</code> has replaced <code>const std::string&</code> in
many of our APIs. This is most-commonly used for input arguments, where
there should be no noticeable change for users. In a few cases (such as
virtual method arguments or return types) users may need to make an explicit
change to use the new signature.</p></li><li><p><strong>tables</strong> - Instead of STL sets/maps, we now use Abseil&rsquo;s <code>flat_hash_map</code>,
<code>flat_hash_set</code>, <code>btree_map</code>, and <code>btree_set</code>. These are more efficient and
allow for <a href=https://abseil.io/tips/144>heterogeneous lookup</a>. This should be
mostly invisible to users, but may cause some subtle behavior changes
related to table ordering.</p></li><li><p><strong>logging</strong> - Abseil&rsquo;s
<a href=https://abseil.io/docs/cpp/guides/logging>logging library</a> is very similar
to our old logging code, with just a slightly different spelling (for
example, <code>ABSL_CHECK</code> instead of <code>GOOGLE_CHECK</code>). The biggest difference is
that it doesn&rsquo;t support exceptions, and will now always crash when <code>FATAL</code>
assertions fail. (Previously we had a <code>PROTOBUF_USE_EXCEPTIONS</code> flag to
switch to exceptions.) Since these only occur when serious issues are
encountered, we feel unconditional crashing is a suitable response.</p><p>Source of logging changes: <a href=https://github.com/protocolbuffers/protobuf/pull/11623>PR #11623</a></p></li><li><p><strong>Build dependency</strong> - A new build dependency can always cause breakages for
downstream users. We require
<a href=https://github.com/abseil/abseil-cpp/releases/tag/20230125.0>Abseil LTS 20230125</a>
or later to build.</p><ul><li><p>For Bazel builds, Abseil will be automatically downloaded and built at a
pinned LTS release when
<a href=https://github.com/protocolbuffers/protobuf/blob/main/protobuf_deps.bzl><code>protobuf_deps</code></a>
is run from your <code>WORKSPACE</code>. This should be transparent, but if you
depend on an older version of Abseil, you&rsquo;ll need to upgrade your
dependency.</p></li><li><p>For CMake builds, we will first look for an existing Abseil installation
pulled in by the top-level CMake configuration (see
<a href=https://github.com/abseil/abseil-cpp/blob/master/CMake/README#traditional-cmake-set-up>instructions</a>).
Otherwise, if <code>protobuf_ABSL_PROVIDER</code> is set to <code>module</code> (its default)
we will attempt to build and link Abseil from our git
<a href=https://github.com/protocolbuffers/protobuf/tree/main/third_party>submodule</a>.
If <code>protobuf_ABSL_PROVIDER</code> is set to <code>package</code>, we will look for a
pre-installed system version of Abseil.</p></li></ul></li></ul><h3 id=getcurrenttime>Changes in GetCurrentTime Method</h3><p>On Windows, <code>GetCurrentTime()</code> is the name of a macro provided by the system.
Prior to v22.x, Protobuf incorrectly removed the macro definition for
<code>GetCurrentTime()</code>. That made the macro unusable for Windows developers after
including <code>&lt;protobuf/util/time_util.h></code>. Starting with v22.x, Protobuf preserves
the macro definition. This may break customer code relying on the previous
behavior, such as if they use the expression
<a href=/reference/cpp/api-docs/google.protobuf.util.time_util#TimeUtil><code>google::protobuf::util::TimeUtil::GetCurrentTime()</code></a>.</p><p>To migrate your app to the new behavior, change your code to do one of the
following:</p><ul><li>if the <code>GetCurrent</code> macro is defined, explicitly undefine the
<code>GetCurrentTime</code> macro</li><li>prevent the macro expansion by using
<code>(google::protobuf::util::TimeUtil::GetCurrentTime)()</code> or a similar
expression</li></ul><h4 id=example-undefining-the-macro>Example: Undefining the macro</h4><p>Use this approach if you don&rsquo;t use the macro from Windows.</p><p>Before:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&lt;google/protobuf/util/time_util.h&gt;</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>F</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>auto</span> <span style=color:#000>time</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>protobuf</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>util</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>TimeUtil</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>GetCurrentTime</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>After:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&lt;google/protobuf/util/time_util.h&gt;</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#ifdef GetCurrentTime
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#undef GetCurrentTime
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#endif
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>F</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>auto</span> <span style=color:#000>time</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>protobuf</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>util</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>TimeUtil</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>GetCurrentTime</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p><strong>Example 2: Preventing macro expansion</strong></p><p>Before:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&lt;google/protobuf/util/time_util.h&gt;</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>F</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>auto</span> <span style=color:#000>time</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>protobuf</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>util</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>TimeUtil</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>GetCurrentTime</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>After:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&lt;google/protobuf/util/time_util.h&gt;</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>F</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>auto</span> <span style=color:#000>time</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>protobuf</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>util</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>TimeUtil</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>GetCurrentTime</span><span style=color:#000;font-weight:700>)();</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=cpp20>C++20 Support</h2><p>Source of changes: <a href=https://github.com/protocolbuffers/protobuf/pull/10796>PR #10796</a></p><p>To support C++20, we&rsquo;ve reserved the new
<a href=https://en.cppreference.com/w/cpp/keyword>keywords</a> in C++ generated protobuf
code. As with other reserved keywords, if you use them for any fields, enums, or
messages, we will add an underscore suffix to make them valid C++. For example,
a <code>concept</code> field will generate a <code>concept_()</code> getter. In the scenario where you
have existing protos that use these keywords, you&rsquo;ll need to update the C++ code
that references them to add the appropriate underscores.</p><h3 id=final-classes>Final Classes</h3><p>Source of changes: <a href=https://github.com/protocolbuffers/protobuf/pull/11604>PR #11604</a></p><p>As part of a larger effort to harden assumptions made in the Protobuf library,
we&rsquo;ve marked some classes <code>final</code> that were never intended to be inherited from.
There are no known use cases for inheriting from these, and doing so would
likely cause problems. There is no mitigation if your code is inheriting from
these classes, but if you think you have some valid reason for the inheritance
you&rsquo;re using, you can
<a href=https://github.com/protocolbuffers/protobuf/issues>open an issue</a>.</p><h3 id=container-static-assertions>Container Static Assertions</h3><p>Source of changes: <a href=https://github.com/protocolbuffers/protobuf/pull/11550>PR #11550</a></p><p>As part of a larger effort to harden assumptions made in the Protobuf library,
we&rsquo;ve added static assertions to the <code>Map</code>, <code>RepeatedField</code>, and
<code>RepeatedPtrField</code> containers. These ensure that you&rsquo;re using these containers
with only expected types, as
<a href=https://protobuf.dev/programming-guides/proto/#maps>covered in our documentation</a>.
If you hit these static assertions, you should migrate your code to use Abseil
or STL containers. <code>std::vector</code> is a good drop-in replacement for repeated
field containers, and <code>std::unordered_map</code> or <code>absl::flat_hash_map</code> for <code>Map</code>
(the former gives similar pointer stability, while the latter is more
efficient).</p><h3 id=cleared-elements>Cleared Element Deprecation</h3><p>Source of changes: <a href=https://github.com/protocolbuffers/protobuf/pull/11588>PR #11588</a>, <a href=https://github.com/protocolbuffers/protobuf/pull/11639>PR #11639</a></p><p>The <code>RepeatedPtrField</code> API around &ldquo;cleared fields&rdquo; has been deprecated, and will
be fully removed in a later breaking release. This was originally added as an
optimization for reusing elements after they&rsquo;ve been cleared, but ended up not
working well. If you&rsquo;re using this API, you should consider migrating to arenas
for better memory reuse.</p><h3 id=unsafe-arena>UnsafeArena Deprecation</h3><p>Source of changes: <a href=https://github.com/protocolbuffers/protobuf/pull/10325>PR #10325</a></p><p>As part of a larger effort to remove arena-unsafe APIs, we&rsquo;ve hidden
<code>RepeatedField::UnsafeArenaSwap</code>. This is the only one we&rsquo;ve removed so far, but
in later releases we will continue to remove them and provide helpers to handle
efficient borrowing patterns between arenas. Within a single arena (or the
stack/heap), <code>Swap</code> is just as efficient as <code>UnsafeArenaSwap</code>. The benefit is
that it won&rsquo;t cause invalid memory operations if you accidentally call it across
different arenas.</p><h3 id=map-pairs>Map Pair Upgrades</h3><p>Source of changes: <a href=https://github.com/protocolbuffers/protobuf/pull/11625>PR #11625</a></p><p>For v22.0 we&rsquo;ve started cleaning up the <code>Map</code> API to make it more consistent
with Abseil and STL. Notably, we&rsquo;ve replaced the <code>MapPair</code> class with an alias
to <code>std::pair</code>. This should be transparent for most users, but if you were using
the class directly you may need to update your code.</p><h3 id=json-parser>New JSON Parser</h3><p>Source of changes: <a href=https://github.com/protocolbuffers/protobuf/pull/10729>PR #10729</a></p><p>We have rewritten the C++ JSON parser this release. It should be mostly a hidden
change, but inevitably some undocumented quirks my have changed; test
accordingly. Parsing documents that are not valid RFC-8219 JSON (such as those
that are missing quotes or using non-standard bools) is deprecated and will be
removed in a future release. The serialization order of fields is now guaranteed
to match the field number order, where before it was less deterministic.</p><p>As part of this migration, all of the files under
<a href=https://github.com/protocolbuffers/protobuf/tree/21.x/src/google/protobuf/util/internal>util/internal</a>
have been deleted. These were used in the old parser, and were never intended to
be used externally.</p><h3 id=arena-init><code>Arena::Init</code></h3><p>Source of changes: <a href=https://github.com/protocolbuffers/protobuf/pull/10623>PR #10623</a></p><p>The <code>Init</code> method in <code>Arena</code> was code that didn&rsquo;t do anything, and has now been
removed. If you were calling this method, you likely meant to call the <code>Arena</code>
constructor directly with a set of <code>ArenaOptions</code>. You should either delete the
call or migrate to that constructor.</p><h3 id=error-collector>ErrorCollector Migration</h3><p>Source of changes: <a href=https://github.com/protocolbuffers/protobuf/pull/11555>PR #11555</a></p><p>As part of our Abseil migration, we&rsquo;re moving from <code>const std::string&</code> to
<code>absl::string_view</code>. For our three error collector classes, this can&rsquo;t be done
without breaking existing code. For v22.0, we&rsquo;ve decided to release both
variants, and rename the methods from <code>AddError</code> and <code>AddWarning</code> to
<code>RecordError</code> and <code>RecordWarning</code>. The old signature has been marked deprecated,
and will be slightly less efficient (due to string copies), but will otherwise
still work. You should migrate these to the new version, as the <code>Add*</code> methods
will be removed in a later breaking release.</p></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow" aria-label="Stack Overflow"><a class=text-white target=_blank rel=noopener href=https://stackoverflow.com/questions/tagged/protocol-buffers aria-label="Stack Overflow"><i class="fab fa-stack-overflow"></i></a></li></ul><script type=text/javascript id=cookiebanner src=https://cdn.jsdelivr.net/gh/dobarkod/cookie-banner@1.2.2/dist/cookiebanner.min.js data-height=50px data-message="Protobuf.dev uses cookies from Google to deliver and enhance the quality of its services and to analyze traffic." data-bg=#ffb data-fg=#000 data-position=bottom data-padding="10px 16px" data-close-text="OK, got it" data-font-size=18px data-moreinfo=https://policies.google.com/technologies/cookies></script></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/protocolbuffers/protobuf aria-label=GitHub><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Developer mailing list" aria-label="Developer mailing list"><a class=text-white target=_blank rel=noopener href=https://groups.google.com/g/protobuf aria-label="Developer mailing list"><i class="fa fa-envelope"></i></a></li></ul><script type=text/javascript id=cookiebanner src=https://cdn.jsdelivr.net/gh/dobarkod/cookie-banner@1.2.2/dist/cookiebanner.min.js data-height=50px data-message="Protobuf.dev uses cookies from Google to deliver and enhance the quality of its services and to analyze traffic." data-bg=#ffb data-fg=#000 data-position=bottom data-padding="10px 16px" data-close-text="OK, got it" data-font-size=18px data-moreinfo=https://policies.google.com/technologies/cookies></script></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2025 Google LLC All Rights Reserved</small>
<small class=ml-1><a href=https://policies.google.com/privacy target=_blank rel=noopener>Privacy Policy</a></small>
<span class=text-white>Hosted by GitHub Pages.</span> <a href=https://docs.github.com/en/site-policy/privacy-policies/github-privacy-statement target=_blank>GitHub Privacy Statement</a></div></div></div></footer></div><script src=/js/main.min.c91cdfdcc1576ecc360abc6f1c3ca0485d047f65ac6d3203ec57ed29e0af808b.js integrity="sha256-yRzf3MFXbsw2CrxvHDygSF0Ef2WsbTID7FftKeCvgIs=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>