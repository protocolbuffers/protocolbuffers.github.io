+++
title = "Cross-Version Runtime Guarantee"
weight = 930
description = "The guarantees that the language has for cross-version runtime compatibility."
type = "docs"
+++

<link rel="stylesheet" href="/includes/version-tables.css">

Protobuf language bindings have two components. The generated code (gencode) and
the runtime libraries that implement common functionality for that generated
code. When these come from different releases of protobuf, we are in a "cross
version runtime" situation.

We intend to offer the following guarantees across most languages. These are the
default guarantees; however, owners of protobuf code generators and runtimes may
explicitly override them with more specific guarantees for that language.
[C++ and Rust](#cpp) have stricter guarantees than typical, and
[Python](#python) has looser ones.

Protobuf cross-version usages outside the guarantees are **error-prone and not
supported**. Version skews can lead to *flakes and undefined behaviors* that are
hard to diagnose, even if it can often *seem* to work as long as nothing has
changed in a source-incompatible way. For Protobuf, the proliferation of tools
and services that rely on using unsupported Protobuf language bindings prevents
the protobuf team from updating the protobuf implementation in response to bug
reports or security vulnerabilities.

## New Gencode + Old Runtime = Never Allowed {#backwards}

We may add new runtime APIs in any kind of release (Major, Minor, or Patch).
Gencode in that release is allowed to use those new APIs. The consequence is
that gencode should never be paired with a runtime that predates the `protoc`
and plugin that was used to generate those bindings.

We will add “poison pills” where possible to prevent attempts to pair newer
gencode with an older runtime.

## Major Versions {#major}

Protobuf implements sliding window compatibility for major versions. Code
generated for a major version V (full version: V.x.y) will be supported by
protobuf runtimes of major version V and V+1.

Protobuf will **not** support using gencode from version V with runtime &gt;=
V+2 and will be using a "poison pill" mechanism to fail with a clear error
message when a software assembly attempts to use such a configuration.

For Example:

*   Java code generated by protobuf version 3.0.0 will work with runtimes 3.0.0
    to 4.x.y but **not** with runtimes 2.0.0 to 2.x.y or runtimes &gt;= 5.0.0.
*   Java code generated by protobuf version 4.27.2 will work with runtimes
    4.27.2 to 5.x.y but **not** runtimes 2.0.0 to 4.27.1 or runtimes &gt;= 6.0.0

Exceptions may be made in case where compatibility with older gencode *cannot*
be maintained, such as in the case of [security](#exception) fixes requiring
updated gencode.

**Note:** Poison pills were introduced in the protobuf 26.0 release. Java
gencode older than 4.26.0 may *appear* to work with runtimes that are older than
the gencode. However, the combination of
[newer gencode and older runtime](#backwards) may have serious bugs that do not
manifest until runtime.

**Note:** [C++ and Rust](#cpp) do not support compatibility windows, and
[Python](#python) supports much longer ones.

## Minor Versions {#minor}

Within a single major runtime version, generated code from an older version of
`protoc` will run on a newer runtime.

**Note:** [C++ and Rust](#cpp) do not support compatibility across minor
versions.

## Security Exception {#exception}

We reserve the right to violate the above promises if needed for security
reasons. We expect these exceptions to be rare, but will always prioritize
security above these guarantees. For example,
[the footmitten CVE](https://cve.report/CVE-2022-3510) required paired updates
to both the runtime and the generated code for Java. As a result, code generated
by 3.20.3 (which contained the footmitten fix) would not load with runtime
library 3.21.6 (which predates the footmitten fix), creating the following
compatibility matrix:

<table>
  <tr>
    <td colspan="2" rowspan="2"></td>
    <td colspan="4">Generated Code Version</td>
  </tr>
  <tr>
    <td class="gray">3.20.2</td>
    <td class="gray">3.20.3</td>
    <td class="gray">3.21.6</td>
    <td class="gray">3.21.7</td>
  </tr>
  <tr>
    <td rowspan="4">Runtime<br>Version</td>
    <td class="gray">3.20.2</td>
    <td class="yellow">Vuln</td>
    <td class="red"><b>!Broken!</b></td>
    <td class="yellow"><b>!Vuln!</b></td>
    <td class="red"><b>!Broken!</b></td>
  </tr>
  <tr>
    <td class="gray">3.20.3</td>
    <td class="yellow">Vuln</td>
    <td class="green">Works</td>
    <td class="yellow"><b>!Vuln!</b></td>
    <td class="green"><b>!Works?!</b></td>
  </tr>
  <tr>
    <td class="gray">3.21.6</td>
    <td class="yellow">Vuln</td>
    <td class="red">Broken</td>
    <td class="yellow">Vuln</td>
    <td class="red"><b>!Broken!</b></td>
  </tr>
  <tr>
    <td class="gray">3.21.7</td>
    <td class="yellow">Vuln</td>
    <td class="green">Works</td>
    <td class="yellow">Vuln</td>
    <td class="green">Works</td>
  </tr>
</table>

*   “Vuln” indicates that the combination will successfully start, but the
    security vulnerability still exists.
*   “Works” indicates that the combination will successfully start and does not
    have the vulnerability.
*   “Broken” indicates that the combination will not successfully start.
*   **!Bold!** indicates configurations that mix newer gencode with older
    runtime and were never intended to work together.

## No Coexistence of Multiple Major Runtime Versions {#coexist}

Coexistence of multiple major versions in the same process is **not** supported.

## C++ and Rust-specific Guarantees {#cpp}

Protobuf C++ and Rust disclaim all cross-runtime support and require an exact
match between the generated code version and the runtime version at all times.

Additionally, Protobuf C++ makes no guarantees about ABI stability across any
releases (major, minor, or micro).

## Python-specific Guarantees {#python}

Since the 3.20.0 release, the Protobuf Python generated code became a thin
wrapper around an embedded `FileDescriptorProto`. Because these protos are
supported on extremely long timeframes, our usual
[major version compatibility windows](#major) aren't typically necessary.

Python may break generated code compatibility in specific future major version
releases, but it will be coupled with poison pill warnings and errors in
advance. As of 6.32.0, all generated code since 3.20.0 will be supported until
at least 8.x.y.
