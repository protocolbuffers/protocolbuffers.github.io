<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>API Best Practices | Protocol Buffers Documentation</title>
<meta name=description content="A future-proof API is surprisingly hard to get right. The suggestions in this document make trade-offs to favor long-term, bug-free evolution."><meta property="og:title" content="API Best Practices"><meta property="og:description" content="A future-proof API is surprisingly hard to get right. The suggestions in this document make trade-offs to favor long-term, bug-free evolution."><meta property="og:type" content="article"><meta property="og:url" content="https://protobuf.dev/best-practices/api/"><meta property="article:section" content="best-practices"><meta itemprop=name content="API Best Practices"><meta itemprop=description content="A future-proof API is surprisingly hard to get right. The suggestions in this document make trade-offs to favor long-term, bug-free evolution."><meta itemprop=wordCount content="6023"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="API Best Practices"><meta name=twitter:description content="A future-proof API is surprisingly hard to get right. The suggestions in this document make trade-offs to favor long-term, bug-free evolution."><link rel=preload href=/scss/main.min.27bc098c9a8f7a1246d474f5c8afcee53760c9c7f38125d343ff52e0bf493011.css as=style integrity="sha256-J7wJjJqPehJG1HT1yK/O5TdgycfzgSXTQ/9S4L9JMBE=" crossorigin=anonymous><link href=/scss/main.min.27bc098c9a8f7a1246d474f5c8afcee53760c9c7f38125d343ff52e0bf493011.css rel=stylesheet integrity="sha256-J7wJjJqPehJG1HT1yK/O5TdgycfzgSXTQ/9S4L9JMBE=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-5L8P8GRN4Y"></script><script>var doNotTrack=!1,dnt;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-5L8P8GRN4Y")}</script></head><body class=td-page><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>Protocol Buffers Documentation</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav></ul></div><div class="d-none d-lg-block"><div class=td-search><div class=td-search__icon></div><input type=search class="td-search__input form-control td-search-input" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><div class=td-search><div class=td-search__icon></div><input type=search class="td-search__input form-control td-search-input" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="td-sidebar-nav collapse td-sidebar-nav--search-disabled" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m--li><a href=/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-><span>Protocol Buffers</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-overview-li><a href=/overview/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-overview><span>Overview</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-installation-li><a href=/installation/ title="Protocol Buffer Compiler Installation" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-installation><span>Protoc Installation</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-news-li><a href=/news/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-news><span>News</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-programming-guides-li><a href=/programming-guides/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-programming-guides><span>Programming Guides</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guideseditions-li><a href=/programming-guides/editions/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guideseditions><span>Language Guide (editions)</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesproto2-li><a href=/programming-guides/proto2/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesproto2><span>Language Guide (proto 2)</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesproto3-li><a href=/programming-guides/proto3/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesproto3><span>Language Guide (proto 3)</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesproto-limits-li><a href=/programming-guides/proto-limits/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesproto-limits><span>Proto Limits</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesstyle-li><a href=/programming-guides/style/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesstyle><span>Style Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesenum-li><a href=/programming-guides/enum/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesenum><span>Enum Behavior</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesencoding-li><a href=/programming-guides/encoding/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesencoding><span>Encoding</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesjson-li><a href=/programming-guides/json/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesjson><span>ProtoJSON Format</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidestechniques-li><a href=/programming-guides/techniques/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidestechniques><span>Techniques</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesaddons-li><a href=/programming-guides/addons/ title="Third-Party Add-ons" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesaddons><span>Add-ons</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesextension_declarations-li><a href=/programming-guides/extension_declarations/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesextension_declarations><span>Extension Declarations</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesfield_presence-li><a href=/programming-guides/field_presence/ title="Application Note: Field Presence" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesfield_presence><span>Field Presence</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesserialization-not-canonical-li><a href=/programming-guides/serialization-not-canonical/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesserialization-not-canonical><span>Proto Serialization Is Not Canonical</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesdeserialize-debug-li><a href=/programming-guides/deserialize-debug/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesdeserialize-debug><span>Deserializing Debug Proto Representations</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-editions-li><a href=/editions/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-editions><span>Protobuf Editions</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-editionsoverview-li><a href=/editions/overview/ title="Protobuf Editions Overview" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-editionsoverview><span>Overview</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-editionsfeatures-li><a href=/editions/features/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-editionsfeatures><span>Feature Settings for Editions</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-editionsimplementation-li><a href=/editions/implementation/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-editionsimplementation><span>Implementing Editions Support</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-design-decisions-li><a href=/design-decisions/ title="Protobuf Team Design Decisions" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-design-decisions><span>Design Decisions</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-design-decisionsnullable-getters-setters-li><a href=/design-decisions/nullable-getters-setters/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-design-decisionsnullable-getters-setters><span>No Nullable Setters/Getters Support</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-best-practices-li><a href=/best-practices/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-best-practices><span>Proto Best Practices</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-best-practicesno-cargo-cults-li><a href=/best-practices/no-cargo-cults/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-best-practicesno-cargo-cults><span>Avoid Cargo Culting</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-best-practicesdos-donts-li><a href=/best-practices/dos-donts/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-best-practicesdos-donts><span>Proto Best Practices</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-best-practicesapi-li><a href=/best-practices/api/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-best-practicesapi><span class=td-sidebar-nav-active-item>API Best Practices</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-best-practices1-1-1-li><a href=/best-practices/1-1-1/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-best-practices1-1-1><span>1-1-1 Best Practice</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-getting-started-li><a href=/getting-started/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-getting-started><span>Tutorials</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedcpptutorial-li><a href=/getting-started/cpptutorial/ title="Protocol Buffer Basics: C++" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedcpptutorial><span>C++</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedcsharptutorial-li><a href=/getting-started/csharptutorial/ title="Protocol Buffer Basics: C#" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedcsharptutorial><span>C#</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-starteddarttutorial-li><a href=/getting-started/darttutorial/ title="Protocol Buffer Basics: Dart" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-getting-starteddarttutorial><span>Dart</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedgotutorial-li><a href=/getting-started/gotutorial/ title="Protocol Buffer Basics: Go" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedgotutorial><span>Go</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedjavatutorial-li><a href=/getting-started/javatutorial/ title="Protocol Buffer Basics: Java" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedjavatutorial><span>Java</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedkotlintutorial-li><a href=/getting-started/kotlintutorial/ title="Protocol Buffer Basics: Kotlin" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedkotlintutorial><span>Kotlin</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedpythontutorial-li><a href=/getting-started/pythontutorial/ title="Protocol Buffer Basics: Python" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedpythontutorial><span>Python</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-reference-li><a href=/reference/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-reference><span>Reference Guides</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencecpp-li><a href=/reference/cpp/ title="C++ Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referencecpp><span>C++</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecppcpp-generated-li><a href=/reference/cpp/cpp-generated/ title="C++ Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencecppcpp-generated><span>Generated Code Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecppstring-view-li><a href=/reference/cpp/string-view/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencecppstring-view><span>String View APIs</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecpparenas-li><a href=/reference/cpp/arenas/ title="C++ Arena Allocation Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencecpparenas><span>Arena Allocation Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecppabseil-li><a href=/reference/cpp/abseil/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencecppabseil><span>Abseil Support</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecppapi-docs-link-li><a href=/reference/cpp/api-docs/ target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencecppapi-docs-link><span>C++ API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencecsharp-li><a href=/reference/csharp/ title="C# Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referencecsharp><span>C#</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecsharpcsharp-generated-li><a href=/reference/csharp/csharp-generated/ title="C# Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencecsharpcsharp-generated><span>Generated Code Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecsharpapi-docs-link-li><a href=/reference/csharp/api-docs target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencecsharpapi-docs-link><span>C# API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencedart-li><a href=/reference/dart/ title="Dart Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referencedart><span>Dart</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencedartdart-generated-li><a href=/reference/dart/dart-generated/ title="Dart Generated Code" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencedartdart-generated><span>Generated Code</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencedartapi-docs-link-li><a href=https://pub.dartlang.org/documentation/protobuf target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencedartapi-docs-link><span>Dart API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencego-li><a href=/reference/go/ title="Go Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referencego><span>Go</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencegogo-generated-li><a href=/reference/go/go-generated/ title="Go Generated Code Guide (Open)" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencegogo-generated><span>Generated Code Guide (Open)</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencegogo-generated-opaque-li><a href=/reference/go/go-generated-opaque/ title="Go Generated Code Guide (Opaque)" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencegogo-generated-opaque><span>Generated Code Guide (Opaque)</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencegofaq-li><a href=/reference/go/faq/ title="Go FAQ" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencegofaq><span>FAQ</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencegosize-li><a href=/reference/go/size/ title="Go Size Semantics" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencegosize><span>Size Semantics</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencegoapi-docs-link-li><a href=https://pkg.go.dev/google.golang.org/protobuf/proto target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencegoapi-docs-link><span>Go API</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencegoopaque-migration-li><a href=/reference/go/opaque-migration/ title="Go Opaque API Migration" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencegoopaque-migration><span>Opaque API Migration</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencegoopaque-migration-manual-li><a href=/reference/go/opaque-migration-manual/ title="Go Opaque API: Manual Migration" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencegoopaque-migration-manual><span>Opaque API: Manual Migration</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencegoopaque-faq-li><a href=/reference/go/opaque-faq/ title="Go Opaque API FAQ" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencegoopaque-faq><span>Opaque API FAQ</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencejava-li><a href=/reference/java/ title="Java Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referencejava><span>Java</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencejavajava-generated-li><a href=/reference/java/java-generated/ title="Java Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencejavajava-generated><span>Generated Code Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencejavajava-proto-names-li><a href=/reference/java/java-proto-names/ title="Java Proto Names" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencejavajava-proto-names><span>Generated Proto Names</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencejavaapi-docs-link-li><a href=/reference/java/api-docs/overview-summary.html target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencejavaapi-docs-link><span>Java API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencekotlin-li><a href=/reference/kotlin/ title="Kotlin Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referencekotlin><span>Kotlin</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencekotlinapi-docs-li><a href=/reference/kotlin/api-docs/ title="Kotlin Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referencekotlinapi-docs><span>Kotlin</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencekotlinkotlin-generated-li><a href=/reference/kotlin/kotlin-generated/ title="Kotlin Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencekotlinkotlin-generated><span>Generated Code Guide</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referenceobjective-c-li><a href=/reference/objective-c/ title="Objective-C Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referenceobjective-c><span>Objective-C</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceobjective-cobjective-c-generated-li><a href=/reference/objective-c/objective-c-generated/ title="Objective-C Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referenceobjective-cobjective-c-generated><span>Generated Code Guide</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencephp-li><a href=/reference/php/ title="PHP Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referencephp><span>PHP</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencephpphp-generated-li><a href=/reference/php/php-generated/ title="PHP Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencephpphp-generated><span>Generated Code Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencephpapi-docs-link-li><a href=/reference/php/api-docs/ target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencephpapi-docs-link><span>PHP API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencepython-li><a href=/reference/python/ title="Python Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referencepython><span>Python</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencepythonpython-generated-li><a href=/reference/python/python-generated/ title="Python Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencepythonpython-generated><span>Generated Code Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencepythonapi-docs-link-li><a href=https://googleapis.dev/python/protobuf/latest/ target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencepythonapi-docs-link><span>Python API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referenceruby-li><a href=/reference/ruby/ title="Ruby Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referenceruby><span>Ruby</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencerubyruby-generated-li><a href=/reference/ruby/ruby-generated/ title="Ruby Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencerubyruby-generated><span>Generated Code Guide</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referenceprotobuf-li><a href=/reference/protobuf/ title="Protocol Buffers Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referenceprotobuf><span>Protocol Buffers</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceprotobufedition-2023-spec-li><a href=/reference/protobuf/edition-2023-spec/ title="Protocol Buffers Edition 2023 Language Specification" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referenceprotobufedition-2023-spec><span>2023 Language Specification</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceprotobufproto2-spec-li><a href=/reference/protobuf/proto2-spec/ title="Protocol Buffers Version 2 Language Specification" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referenceprotobufproto2-spec><span>Version 2 Language Specification</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceprotobufproto3-spec-li><a href=/reference/protobuf/proto3-spec/ title="Protocol Buffers Version 3 Language Specification" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referenceprotobufproto3-spec><span>Version 3 Language Specification</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceprotobuftextformat-spec-li><a href=/reference/protobuf/textformat-spec/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referenceprotobuftextformat-spec><span>Text Format Language Specification</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceprotobufgoogleprotobuf-li><a href=/reference/protobuf/google.protobuf/ title="Protocol Buffers Well-Known Types" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referenceprotobufgoogleprotobuf><span>Well-Known Types</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceother-li><a href=/reference/other/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referenceother><span>Other Languages</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-support-li><a href=/support/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-support><span>Support</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-supportversion-support-li><a href=/support/version-support/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-supportversion-support><span>Version Support</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-supportmigration-li><a href=/support/migration/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-supportmigration><span>Migration Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-supportcross-version-runtime-guarantee-li><a href=/support/cross-version-runtime-guarantee/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-supportcross-version-runtime-guarantee><span>Cross-Version Runtime Guarantee</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-downloads-li><a href=/downloads/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-downloads><span>Downloads</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-history-li><a href=/history/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-history><span>History</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-forum-link-li><a href=https://groups.google.com/g/protobuf target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-forum-link><span>Forum</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-navbar-li><a href=/navbar/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-navbar><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-search-li><a href=/search/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-search><span>Search Results</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/protocolbuffers/protocolbuffers.github.io/tree/main/content/best-practices/api.md class=td-page-meta--view target=_blank rel=noopener><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
<a href=https://github.com/protocolbuffers/protocolbuffers.github.io/edit/main/content/best-practices/api.md class=td-page-meta--edit target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
<a href="https://github.com/protocolbuffers/protocolbuffers.github.io/new/main/content/best-practices/api.md?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class=td-page-meta--child target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
<a href="https://github.com/protocolbuffers/protocolbuffers.github.io/issues/new?title=API%20Best%20Practices" class=td-page-meta--issue target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create documentation issue</a>
<a href=https://github.com/protocolbuffers/protobuf/issues/new class=td-page-meta--project-issue target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create project issue</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#precisely-concisely>Precisely, Concisely Document Most Fields and Messages</a></li><li><a href=#use-different-messages>Use Different Messages for Wire and Storage</a></li><li><a href=#support-partial-updates>For Mutations, Support Partial Updates or Append-Only Updates, Not Full Replaces</a><ul><li><a href=#use-update-field-mask>Fix #1: Use an Update Field-mask</a></li><li><a href=#expose-more-narrow-mutations>Fix #2: Expose More Narrow Mutations That Change Individual Pieces</a></li></ul></li><li><a href=#dont-include-primitive-types>Don&rsquo;t Include Primitive Types in a Top-level Request or Response Proto</a></li><li><a href=#never-use-booleans-for-two-states>Never Use Booleans for Something That Has Two States Now, but Might Have More Later</a></li><li><a href=#integer-field-for-id>Rarely Use an Integer Field for an ID</a></li><li><a href=#dont-encode-data-in-a-string>Don’t Encode Data in a String That You Expect a Client to Construct or Parse</a><ul><li><a href=#returning-html>Don&rsquo;t Return HTML in a Front-End Proto</a></li></ul></li><li><a href=#encode-opaque-data-in-strings>Encode Opaque Data in Strings by Web-Safe Encoding Binary Proto Serialization</a></li><li><a href=#dont-include-fields>Don&rsquo;t Include Fields that Your Clients Can&rsquo;t Possibly Have a Use for</a></li><li><a href=#define-pagination-api><em>Rarely</em> Define a Pagination API Without a Continuation Token</a></li><li><a href=#group-related-fields>Group Related Fields into a new <code>message</code>. Nest Only Fields with High Cohesion</a></li><li><a href=#include-field-read-mask>Include a Field Read Mask in Read Requests</a></li><li><a href=#include-version-field>Include a Version Field to Allow for Consistent Reads</a></li><li><a href=#use-consistent-request-options>Use Consistent Request Options for RPCs that Return the Same Data Type</a></li><li><a href=#batch-multi-phase-requests>Batch/multi-phase Requests</a></li><li><a href=#create-methods-manipulate-small-bits>Create Methods that Return or Manipulate Small Bits of Data and Expect Clients to Compose UIs from Batching Multiple Such Requests</a></li><li><a href=#make-one-off-rpc>Make a One-off RPC when the Alternative is Serial Round-trips on Mobile or Web</a></li><li><a href=#repeated-fields-messages-scalar-types>Make Repeated Fields Messages, Not Scalars or Enums</a></li><li><a href=#use-proto-maps>Use Proto Maps</a></li><li><a href=#prefer-idempotency>Prefer Idempotency</a></li><li><a href=#service-name-globally-unique>Be Mindful of Your Service Name, and Make it Globally Unique</a></li><li><a href=#bound-req-res-sizes>Bound Request and Response Sizes</a></li><li><a href=#propagate-status-codes>Propagate Status Codes Carefully</a></li><li><a href=#unique-protos>Create Unique Protos per Method</a><ul><li><a href=#reuse-messages>Reusing Messages</a></li></ul></li><li><a href=#appendix>Appendix</a><ul><li><a href=#returning-repeated-fields>Returning Repeated Fields</a></li><li><a href=#updating-repeated-fields>Updating Repeated Fields</a></li><li><a href=#order-independence-repeated-fields>Order Independence in Repeated Fields</a></li><li><a href=#leaking-features>Leaking Features Because Your Proto is in a Mobile Build</a></li><li><a href=#performance-optimizations>Performance Optimizations</a></li></ul></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=/best-practices/>Proto Best Practices</a></li><li class="breadcrumb-item active" aria-current=page>API Best Practices</li></ol></nav><div class=td-content><h1>API Best Practices</h1><div class=lead>A future-proof API is surprisingly hard to get right. The suggestions in this document make trade-offs to favor long-term, bug-free evolution.</div><header class=article-meta></header><p>Updated for proto3. Patches welcome!</p><p>This doc is a complement to
<a href=/best-practices/dos-donts>Proto Best Practices</a>. It&rsquo;s
not a prescription for Java/C++/Go and other APIs.</p><p>If you see a proto straying from these guidelines in a code review, point the
author to this topic and help spread the word.</p><div class="alert alert-note" role=alert><h4 class=alert-heading>Note</h4>These guidelines are just that and many have documented exceptions. For example,
if you&rsquo;re writing a performance-critical backend, you might want to sacrifice
flexibility or safety for speed. This
topic will help you better understand the trade-offs and make a decision that
works for your situation.</div><h2 id=precisely-concisely>Precisely, Concisely Document Most Fields and Messages</h2><p>Chances are good your proto will be inherited and used by people who don&rsquo;t know
what you were thinking when you wrote or modified it. Document each field in
terms that will be useful to a new team-member or client with little knowledge
of your system.</p><p>Some concrete examples:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Bad: Option to enable Foo
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Good: Configuration controlling the behavior of the Foo feature.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>FeatureFooConfig</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Bad: Sets whether the feature is enabled
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// Good: Required field indicating whether the Foo feature
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// is enabled for account_id.  Must be false if account_id&#39;s
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// FOO_OPTIN Gaia bit is not set.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>bool</span> <span style=color:#000>enabled</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>// Bad: Foo object.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Good: Client-facing representation of a Foo (what/foo) exposed in APIs.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Bad: Title of the foo.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// Good: Indicates the user-supplied title of this Foo, with no
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// normalization or escaping.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// An example title: &#34;Picture of my cat in a box &lt;3 &lt;3 !!!&#34;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>title</span> <span style=color:#000;font-weight:700>[(</span><span style=color:#000>max_length</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>512</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>// Bad: Foo config.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Less-Bad: If the most useful comment is re-stating the name, better to omit
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// the comment.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>FooConfig</span> <span style=color:#000>foo_config</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>Document the constraints, expectations and interpretation of each field in as
few words as possible.</p><p>You can use custom proto annotations.
See <a href=/programming-guides/proto2#options>Custom Options</a>
to define cross-language constants like <code>max_length</code> in the example above.
Supported in proto2 and proto3.</p><p>Over time, documentation of an interface can get longer and longer. The length
takes away from the clarity. When the documentation is genuinely unclear, fix it, but
look at it holistically and aim for brevity.</p><h2 id=use-different-messages>Use Different Messages for Wire and Storage</h2><p>If a top-level proto you expose to clients is the same one you store on disk,
you&rsquo;re headed for trouble. More and more binaries will depend on your API over
time, making it harder to change. You&rsquo;ll want the freedom to change your storage
format without impacting your clients. Layer your code so that modules deal
either with client protos, storage protos, or translation.</p><p>Why? You might want to swap your underlying storage system. You might want to
normalize—or denormalize—data differently. You might realize that parts of your
client-exposed proto make sense to store in RAM while other parts make sense to
go on disk.</p><p>When it comes to protos nested one or more levels within a top-level request or
response, the case for separating storage and wire protos isn&rsquo;t as strong, and
depends on how closely you&rsquo;re willing to couple your clients to those protos.</p><p>There&rsquo;s a cost in maintaining the translation layer, but it quickly pays off
once you have clients and have to do your first storage changes.</p><p>You might be tempted to share protos and diverge &ldquo;when you need to.&rdquo; With a
perceived high cost to diverge and no clear place to put internal fields, your
API will accrue fields clients either don&rsquo;t understand or begin to depend on
without your knowledge.</p><p>By starting with separate proto files, your team will know where to add internal
fields without polluting your API. In the early days, the wire proto can be
tag-for-tag identical with an automatic translation layer (think: byte copying
or proto reflection). Proto annotations can also power an automatic translation
layer.</p><p>The following are exceptions to the rule:</p><ul><li><p>If the proto field is one of a common type, such as <code>google.type</code> or
<code>google.protobuf</code>, then using that type both as storage and API is
acceptable.</p></li><li><p>If your service is extremely performance-sensitive, it may be worth trading
flexibility for execution speed. If your service
doesn&rsquo;t have millions of QPS with millisecond latency,
you&rsquo;re probably not the exception.</p></li><li><p>If all of the following are true:</p><ul><li>your service <em>is</em> the storage system</li><li>your system doesn&rsquo;t make decisions based on your clients&rsquo; structured
data</li><li>your system simply stores, loads, and perhaps provides queries at your
client&rsquo;s request</li></ul><p>Note that if you are implementing something like a logging system or a
proto-based wrapper around a generic storages system, then you probably want
to aim to have your clients&rsquo; messages transit into your storage backend as
opaquely as possible so that you don&rsquo;t create a dependency nexus. Consider
using extensions or <a href=/best-practices/api#encode-opaque-data-in-strings>Encode Opaque Data in Strings by Web-safe Encoding
Binary Proto
Serialization</a>.</p></li></ul><h2 id=support-partial-updates>For Mutations, Support Partial Updates or Append-Only Updates, Not Full Replaces</h2><p>Don&rsquo;t make an <code>UpdateFooRequest</code> that only takes a <code>Foo</code>.</p><p>If a client doesn&rsquo;t preserve unknown fields, they will not have the newest
fields of <code>GetFooResponse</code> leading to data loss on a round-trip. Some systems
don&rsquo;t preserve unknown fields. Proto2 and proto3 implementations do preserve
unknown fields unless the application drops the unknown fields explicitly. In
general, public APIs should drop unknown fields on server-side to prevent
security attack via unknown fields. For example, garbage unknown fields may
cause a server to fail when it starts to use them as new fields in the future.</p><p>Absent documentation, handling of optional fields is ambiguous. Will <code>UpdateFoo</code>
clear the field? That leaves you open to data loss when the client doesn&rsquo;t know
about the field. Does it not touch a field? Then how can clients clear the
field? Neither are good.</p><h3 id=use-update-field-mask>Fix #1: Use an Update Field-mask</h3><p>Have your client pass which fields it wants to modify and include only those
fields in the update request. Your server leaves other fields alone and updates
only those specified by the mask.
In general, the structure of your mask should mirror the
structure of the response proto; that is, if <code>Foo</code> contains <code>Bar</code>, <code>FooMask</code>
contains <code>BarMask</code>.</p><h3 id=expose-more-narrow-mutations>Fix #2: Expose More Narrow Mutations That Change Individual Pieces</h3><p>For example, instead of <code>UpdateEmployeeRequest</code>, you might have:
<code>PromoteEmployeeRequest</code>, <code>SetEmployeePayRequest</code>, <code>TransferEmployeeRequest</code>,
etc.</p><p>Custom update methods are easier to monitor, audit, and secure than a very
flexible update method. They&rsquo;re also easier to implement and call. A <em>large</em>
number of them can increase the cognitive load of an API.</p><h2 id=dont-include-primitive-types>Don&rsquo;t Include Primitive Types in a Top-level Request or Response Proto</h2><p>Many of the pitfalls described elsewhere in this doc are solved with this rule.
For example:</p><p>Telling clients that a repeated field is unset in storage versus not-populated
in this particular call can be done by wrapping the repeated field in a message.</p><p>Common request options that are shared between requests naturally fall out of
following this rule. Read and write field masks fall out of this.</p><p>Your top-level proto should almost always be a container for other messages that
can grow independently.</p><p>Even when you only need a single primitive type today, having it wrapped in a
message gives you a clear path to expand that type and share the type among
other methods that return the similar values. For example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>MultiplicationResponse</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Bad: What if you later want to return complex numbers and have an
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// AdditionResponse that returns the same multi-field type?
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>double</span> <span style=color:#000>result</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Good: Other methods can share this type and it can grow as your
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// service adds new features (units, confidence intervals, etc.).
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>NumericResult</span> <span style=color:#000>result</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>NumericResult</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>double</span> <span style=color:#000>real_value</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>double</span> <span style=color:#000>complex_value</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>UnitType</span> <span style=color:#000>units</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>One exception to top-level primitives: Opaque strings (or bytes) that encode a
proto but are only built and parsed on the server. Continuation tokens, version
info tokens and IDs can all be returned as strings <em>if</em> the string is actually
an encoding of a structured proto.</p><h2 id=never-use-booleans-for-two-states>Never Use Booleans for Something That Has Two States Now, but Might Have More Later</h2><p>If you are using boolean for a field, make sure that the field is indeed
describing just two possible states (for all time, not just now and the near
future). Often, the flexibility of an enum, int, or message turns out to be
worth it.</p><p>For example, in returning a stream of posts a developer may need to indicate
whether a post should be rendered in two-columns or not based on the current
mocks from UX. Even though a boolean is all that&rsquo;s needed today, nothing
prevents UX from introducing two-row posts, three-column posts or four-square
posts in a future version.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>GooglePlusPost</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Bad: Whether to render this post across two columns.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>bool</span> <span style=color:#000>big_post</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Good: Rendering hints for clients displaying this post.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// Clients should use this to decide how prominently to render this
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// post. If absent, assume a default rendering.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>LayoutConfig</span> <span style=color:#000>layout_config</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Photo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Bad: True if it&#39;s a GIF.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>bool</span> <span style=color:#000>gif</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Good: File format of the referenced photo (for example, GIF, WebP, PNG).
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>PhotoType</span> <span style=color:#000>type</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>Be cautious about adding states to an enum that
conflates concepts.</p><p>If a state introduces a new dimension to the enum or implies multiple
application behaviors, you almost certainly want another field.</p><h2 id=integer-field-for-id>Rarely Use an Integer Field for an ID</h2><p>It&rsquo;s tempting to use an int64 as an identifier for an object. Opt instead for a
string.</p><p>This lets you change your ID space if you need to and reduces the chance of
collisions. 2^64 isn&rsquo;t as big as it used to be.</p><p>You can also encode a structured identifier as a string which encourages clients
to treat it as an opaque blob. You still must have a proto backing the string,
but you can serialize the proto to a string field (encoded as web-safe Base64)
which removes any of the internal details from the client-exposed API. In this
case follow the guidelines <a href=#encode-opaque-data-in-strings>below</a>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>GetFooRequest</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Which Foo to fetch.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>foo_id</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>// Serialized and websafe-base64-encoded into the GetFooRequest.foo_id field.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>InternalFooRef</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Only one of these two is set. Foos that have already been
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// migrated use the spanner_foo_id and Foos still living in
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// Caribou Storage Server have a classic_foo_id.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>bytes</span> <span style=color:#000>spanner_foo_id</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int64</span> <span style=color:#000>classic_foo_id</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>If you start off with your own serialization scheme to represent your IDs as
strings, things can get weird quickly. That&rsquo;s why it&rsquo;s often best to start
with an internal proto that backs your string field.</p><h2 id=dont-encode-data-in-a-string>Don’t Encode Data in a String That You Expect a Client to Construct or Parse</h2><p>It&rsquo;s less efficient over the wire, more work for the consumer of the proto, and
confusing for someone reading your documentation. Your clients also have to
wonder about the encoding: Are lists comma-separated? Did I escape this
untrusted data correctly? Are numbers base-10? Better to have clients send an
actual message or primitive type. It&rsquo;s more compact over the wire and clearer
for your clients.</p><p>This gets especially bad when your service acquires clients in several
languages. Now each will have to choose the right parser or builder—or
worse—write one.</p><p>More generally, choose the right primitive type. See the Scalar Value Types
table in the
<a href=/programming-guides/proto2#scalar>Protocol Buffer Language Guide</a>.</p><h3 id=returning-html>Don&rsquo;t Return HTML in a Front-End Proto</h3><p>With a JavaScript client, it&rsquo;s tempting to return HTML or
JSON in a field of your API. This is a slippery
slope towards tying your API to a specific UI. Here are three concrete dangers:</p><ul><li>A &ldquo;scrappy&rdquo; non-web client will end up parsing your HTML or JSON to get the
data they want leading to fragility if you change formats and
vulnerabilities if their parsing is bad.</li><li>Your web-client is now vulnerable to an XSS exploit if that HTML is ever
returned unsanitized.</li><li>The tags and classes you&rsquo;re returning expect a particular style-sheet and
DOM structure. From release to release, that structure will change, and you
risk a version-skew problem where the JavaScript client is older than the
server and the HTML the server returns no longer renders properly on old
clients. For projects that release often, this is not an edge case.</li></ul><p>Other than the initial page load, it&rsquo;s usually better to return data and use
client-side templating to construct HTML on the client
.</p><h2 id=encode-opaque-data-in-strings>Encode Opaque Data in Strings by Web-Safe Encoding Binary Proto Serialization</h2><p>If you do encode <em>opaque</em> data in a client-visible field (continuation tokens,
serialized IDs, version infos, and so on), document that clients should treat it
as an opaque blob. <em>Always use binary proto serialization, never text-format or
something of your own devising for these fields.</em> When you need to expand the
data encoded in an opaque field, you&rsquo;ll find yourself reinventing protocol
buffer serialization if you&rsquo;re not already using it.</p><p>Define an internal proto to hold the fields that will go in the opaque field
(even if you only need one field), serialize this internal proto to bytes then
web-safe base-64 encode the result into your string field
.</p><p>One rare exception to using proto serialization: <em>Very</em> occasionally, the
compactness wins from a carefully constructed alternative format are worth it.</p><h2 id=dont-include-fields>Don&rsquo;t Include Fields that Your Clients Can&rsquo;t Possibly Have a Use for</h2><p>The API you expose to clients should only be for describing how to interact with
your system. Including anything else in it adds cognitive overhead to someone
trying to understand it.</p><p>Returning debug data in response protos used to be a common practice, but we
have a better way. RPC response extensions (also called &ldquo;side
channels&rdquo;) let you describe your client interface with one proto and your
debugging surface with another.</p><p>Similarly, returning experiment names in response protos used to be a logging
convenience&ndash;the unwritten contract was the client would send those experiments
back on subsequent actions. The accepted way of accomplishing the same is to do
log joining in the analysis pipeline.</p><p>One exception:</p><p>If you need continuous, real-time analytics <em>and</em> are on a small machine budget,
running log joins might be prohibitive.
In cases where cost is a deciding factor,
denormalizing log data ahead of time can be a win. If you need log data
round-tripped to you, send it to clients as an opaque blob and document the
request and response fields.</p><p><strong>Caution:</strong> If you need to return or round-trip hidden data on <em>every</em> request
, you&rsquo;re hiding the true cost of using your service
and that&rsquo;s not good either.</p><h2 id=define-pagination-api><em>Rarely</em> Define a Pagination API Without a Continuation Token</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>FooQuery</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Bad: If the data changes between the first query and second, each of
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// these strategies can cause you to miss results. In an eventually
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// consistent world (that is, storage backed by Bigtable), it&#39;s not uncommon
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// to have old data appear after the new data. Also, the offset- and
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// page-based approaches all assume a sort-order, taking away some
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// flexibility.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int64</span> <span style=color:#000>max_timestamp_ms</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>result_offset</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>page_number</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>page_size</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Good: You&#39;ve got flexibility! Return this in a FooQueryResponse and
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// have clients pass it back on the next query.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>next_page_token</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>The best practice for a pagination API is to use an opaque continuation token
(called next_page_token ) backed by an internal proto that you
serialize and then <code>WebSafeBase64Escape</code> (C++) or <code>BaseEncoding.base64Url().encode</code> (Java). That internal proto could include many fields.
The important thing is it buys you flexibility and&ndash;if you choose&ndash;it can buy
your clients stability in the results.</p><p>Do not forget to validate the fields of this proto as untrustworthy inputs (see
note in <a href=#encode-opaque-data-in-strings>Encode opaque data in strings</a>).</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>InternalPaginationToken</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Track which IDs have been seen so far. This gives perfect recall at the
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// expense of a larger continuation token--especially as the user pages
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// back.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>FooRef</span> <span style=color:#000>seen_ids</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Similar to the seen_ids strategy, but puts the seen_ids in a Bloom filter
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// to save bytes and sacrifice some precision.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>bytes</span> <span style=color:#000>bloom_filter</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// A reasonable first cut and it may work for longer. Having it embedded in
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// a continuation token lets you change it later without affecting clients.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int64</span> <span style=color:#000>max_timestamp_ms</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><h2 id=group-related-fields>Group Related Fields into a new <code>message</code>. Nest Only Fields with High Cohesion</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Bad: The price and currency of this Foo.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>int</span> <span style=color:#000>price</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>CurrencyType</span> <span style=color:#000>currency</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Better: Encapsulates the price and currency of this Foo.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>CurrencyAmount</span> <span style=color:#000>price</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>Only fields with high cohesion should be
nested. If the fields are genuinely related, you&rsquo;ll often want to pass them
around together inside a server. That&rsquo;s easier if they&rsquo;re defined together in a
message. Think:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>CurrencyAmount</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>calculateLocalTax</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>CurrencyAmount</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>price</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Location</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>where</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>If your CL introduces one field, but that field might have related fields later,
preemptively put it in its own message to avoid this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// DEPRECATED! Use currency_amount.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>int</span> <span style=color:#000>price</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>deprecated</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// The price and currency of this Foo.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>google.type.Money</span> <span style=color:#000>currency_amount</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>The problem with a nested message is that while <code>CurrencyAmount</code> might be a
popular candidate for reuse in other places of your API, <code>Foo.CurrencyAmount</code>
might not. In the worst case, <code>Foo.CurrencyAmount</code> <em>is</em> reused, but
<code>Foo</code>-specific fields leak into it.</p><p>While <a href=https://en.wikipedia.org/wiki/Loose_coupling>loose coupling</a>
is generally accepted as a best practice when developing systems, that practice
may not always apply when designing <code>.proto</code> files. There may be cases in which
tightly coupling two units of information (by nesting one unit inside of the
other) may make sense. For example, if you are creating a set of fields that
appear fairly generic right now but which you anticipate adding specialized
fields into at a later time, nesting the message would dissuade others from
referencing that message from elsewhere in this or other <code>.proto</code> files.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Photo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Bad: It&#39;s likely PhotoMetadata will be reused outside the scope of Photo,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// so it&#39;s probably a good idea not to nest it and make it easier to access.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>PhotoMetadata</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>width</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>height</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>PhotoMetadata</span> <span style=color:#000>metadata</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>FooConfiguration</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Good: Reusing FooConfiguration.Rule outside the scope of FooConfiguration
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// tightly-couples it with likely unrelated components, nesting it dissuades
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// from doing that.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Rule</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>float</span> <span style=color:#000>multiplier</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>Rule</span> <span style=color:#000>rules</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><h2 id=include-field-read-mask>Include a Field Read Mask in Read Requests</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Recommended: use google.protobuf.FieldMask
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>// Alternative one:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>FooReadMask</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>bool</span> <span style=color:#000>return_field1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>bool</span> <span style=color:#000>return_field2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>// Alternative two:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>BarReadMask</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Tag numbers of the fields in Bar to return.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>fields_to_return</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>If you use the recommended <code>google.protobuf.FieldMask</code>, you can use the
<code>FieldMaskUtil</code>
(<a href=/reference/java/api-docs/com/google/protobuf/util/FieldMaskUtil.html>Java</a>/<a href=/reference/cpp/api-docs/google.protobuf.util.field_mask_util.md>C++</a>)
libraries to automatically filter a proto.</p><p>Read masks set clear expectations on the client side, give them control of how
much data they want back and allow the backend to only fetch data the client
needs.</p><p>The acceptable alternative is to always populate every field; that is, treat the
request as if there were an implicit read mask with all fields set to true. This
can get costly as your proto grows.</p><p>The worst failure mode is to have an implicit (undeclared) read mask that varies
depending on which method populated the message. This anti-pattern leads to
apparent data loss on clients that build a local cache from response protos.</p><h2 id=include-version-field>Include a Version Field to Allow for Consistent Reads</h2><p>When a client does a write followed by a read of the same object, they expect to
get back what they wrote&ndash;even when the expectation isn&rsquo;t reasonable for the
underlying storage system.</p><p>Your server will read the local value and if the local version_info is less than
the expected version_info, it will read from remote replicas to find the latest
value. Typically version_info is a
<a href=#encode-opaque-data-in-strings>proto encoded as a string</a> that includes the
datacenter the mutation went to and the timestamp at which it was committed.</p><p>Even systems backed by consistent storage often want a token to trigger the more
expensive read-consistent path rather than incurring the cost on every read.</p><h2 id=use-consistent-request-options>Use Consistent Request Options for RPCs that Return the Same Data Type</h2><p>An example failure pattern is the request options for
a service in which each RPC returns the same
data type, but has separate request options for specifying things like maximum
comments, embeds supported types list, and so on.</p><p>The cost of approaching this ad hoc is increased complexity on the client from
figuring out how to fill out each request and increased complexity on the server
transforming the N request options into a common internal one. A
not-small number of real-life bugs are traceable to
this example.</p><p>Instead, create a single, separate message to hold request options and include
that in each of the top-level request messages. Here&rsquo;s a better-practices
example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>FooRequestOptions</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Field-level read mask of which fields to return. Only fields that
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// were requested will be returned in the response. Clients should only
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// ask for fields they need to help the backend optimize requests.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>FooReadMask</span> <span style=color:#000>read_mask</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Up to this many comments will be returned on each Foo in the response.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// Comments that are marked as spam don&#39;t count towards the maximum
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// comments. By default, no comments are returned.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>int</span> <span style=color:#000>max_comments_to_return</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Foos that include embeds that are not on this supported types list will
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// have the embeds down-converted to an embed specified in this list. If no
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// supported types list is specified, no embeds will be returned. If an embed
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// can&#39;t be down-converted to one of the supplied supported types, no embed
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// will be returned. Clients are strongly encouraged to always include at
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// least the THING_V2 embed type from EmbedTypes.proto.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>EmbedType</span> <span style=color:#000>embed_supported_types_list</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>GetFooRequest</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// What Foo to read. If the viewer doesn&#39;t have access to the Foo or the
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// Foo has been deleted, the response will be empty but will succeed.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>foo_id</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Clients are required to include this field. Server returns
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// INVALID_ARGUMENT if FooRequestOptions is left empty.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>FooRequestOptions</span> <span style=color:#000>params</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>ListFooRequest</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Which Foos to return. Searches have 100% recall, but more clauses
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// impact performance.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>FooQuery</span> <span style=color:#000>query</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Clients are required to include this field. The server returns
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// INVALID_ARGUMENT if FooRequestOptions is left empty.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>FooRequestOptions</span> <span style=color:#000>params</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><h2 id=batch-multi-phase-requests>Batch/multi-phase Requests</h2><p>Where possible, make mutations atomic. Even more important, make
<a href=#prefer-idempotency>mutations idempotent</a>. A full retry of a partial failure
shouldn&rsquo;t corrupt/duplicate data.</p><p>Occasionally, you&rsquo;ll need a single RPC that encapsulates multiple operations for
performance reasons. What to do on a partial failure? If some succeeded and some
failed, it&rsquo;s best to let clients know.</p><p>Consider setting the RPC as failed and return details of both the successes and failures in an RPC status proto.</p><p>In general, you want clients who are unaware of your handling of partial
failures to still behave correctly and clients who are aware to get extra value.</p><h2 id=create-methods-manipulate-small-bits>Create Methods that Return or Manipulate Small Bits of Data and Expect Clients to Compose UIs from Batching Multiple Such Requests</h2><p>The ability to query many narrowly specified bits of data in a single round-trip
allows a wider range of UX options without server changes by letting the client
compose what they need.</p><p>This is most relevant for front-end and middle-tier servers.</p><p>Many services expose their own batching API.</p><h2 id=make-one-off-rpc>Make a One-off RPC when the Alternative is Serial Round-trips on Mobile or Web</h2><p>In cases where a <em>web or mobile</em> client needs to make two queries with a data
dependency between them, the current best practice is to create a new RPC that
protects the client from the round trip.</p><p>In the case of mobile, it&rsquo;s almost always worth saving your client the cost of
an extra round-trip by bundling the two service methods together in one new one.
For server-to-server calls, the case may not be as clear; it depends on how
performance-sensitive your service is and how much cognitive overhead the new
method introduces.</p><h2 id=repeated-fields-messages-scalar-types>Make Repeated Fields Messages, Not Scalars or Enums</h2><p>A common evolution is that a single repeated field needs to become multiple
related repeated fields. If you start with a repeated primitive your options are
limited&ndash;you either create parallel repeated fields, or define a new repeated
field with a new message that holds the values and migrate clients to it.</p><p>If you start with a repeated message, evolution becomes trivial.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Describes a type of enhancement applied to a photo
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>EnhancementType</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>ENHANCEMENT_TYPE_UNSPECIFIED</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>RED_EYE_REDUCTION</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>SKIN_SOFTENING</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>PhotoEnhancement</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>EnhancementType</span> <span style=color:#000>type</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>PhotoEnhancementReply</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Good: PhotoEnhancement can grow to describe enhancements that require
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// more fields than just an enum.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>PhotoEnhancement</span> <span style=color:#000>enhancements</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Bad: If we ever want to return parameters associated with the
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// enhancement, we&#39;d have to introduce a parallel array (terrible) or
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// deprecate this field and introduce a repeated message.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>EnhancementType</span> <span style=color:#000>enhancement_types</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>Imagine the following feature request: &ldquo;We need to know which enhancements were
performed by the user and which enhancements were automatically applied by the
system.&rdquo;</p><p>If the enhancement field in <code>PhotoEnhancementReply</code> were a scalar or enum, this
would be much harder to support.</p><p>This applies equally to maps. It is much easier to add additional fields to a
map value if it&rsquo;s already a message rather than having to migrate from
<code>map&lt;string, string></code> to <code>map&lt;string, MyProto></code>.</p><p>One exception:</p><p>Latency-critical applications will find parallel arrays of primitive types are
faster to construct and delete than a single array of messages; they can also be
smaller over the wire if you use
<a href=/programming-guides/encoding#packed>[packed=true]</a>
(eliding field tags). Allocating a fixed number of arrays is less work than
allocating N messages. Bonus: in
<a href=/programming-guides/proto3>Proto3</a>, packing is
automatic; you don&rsquo;t need to explicitly specify it.</p><h2 id=use-proto-maps>Use Proto Maps</h2><p>Prior to the introduction in
<a href=/programming-guides/proto3>Proto3</a> of
<a href=/programming-guides/proto3#maps>Proto3 maps</a>, services
would sometimes expose data as pairs using an ad-hoc KVPair message with scalar
fields. Eventually clients would need a deeper structure and would end up
devising keys or values that need to be parsed in some way. See
<a href=#dont-encode-data-in-a-string>Don&rsquo;t encode data in a string</a>.</p><p>So, using a (extensible) message type for the value is an immediate improvement
over the naive design.</p><p>Maps were back-ported to proto2 in all languages, so using <code>map&lt;scalar, **message**></code> is better than inventing your own KVPair for the same purpose<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>.</p><p>If you want to represent <em>arbitrary</em> data whose structure you don&rsquo;t know ahead
of time, use
<a href=/reference/protobuf/textformat-spec#any><code>google.protobuf.Any</code></a>.</p><h2 id=prefer-idempotency>Prefer Idempotency</h2><p>Somewhere in the stack above you, a client may have retry logic. If the retry is
a mutation, the user could be in for a surprise. Duplicate comments, build
requests, edits, and so on aren&rsquo;t good for anyone.</p><p>A simple way to avoid duplicate writes is to allow clients to specify a
client-created request ID that your server dedupes on (for example, hash of
content or UUID).</p><h2 id=service-name-globally-unique>Be Mindful of Your Service Name, and Make it Globally Unique</h2><p>A service name (that is, the part after the <code>service</code> keyword in your <code>.proto</code>
file) is used in surprisingly many places, not just to generate the service
class name. This makes this name more
important than one might think.</p><p>What&rsquo;s tricky is that these tools make the implicit assumption that your service
name is unique across a network . Worse, the service name they use is the
<em>unqualified</em> service name (for example, <code>MyService</code>), not the qualified service
name (for example, <code>my_package.MyService</code>).</p><p>For this reason, it makes sense to take steps to prevent naming conflicts on
your service name, even if it is defined inside a specific package. For example,
a service named <code>Watcher</code> is likely to cause problems; something like
<code>MyProjectWatcher</code> would be better.</p><h2 id=bound-req-res-sizes>Bound Request and Response Sizes</h2><p>Request and response sizes should be bounded.
We recommend a bound in the ballpark of 8 MiB, and 2
GiB is a hard limit at which many proto implementations break
. Many storage systems have a limit
on message sizes .</p><p>Also, unbounded messages</p><ul><li>bloat both client and server,</li><li>cause high and unpredictable latency,</li><li>decrease resiliency by relying on a long-lived connection between a single
client and a single server.</li></ul><p>Here are a few ways to bound all messages in an API:</p><ul><li>Define RPCs that return bounded messages, where each RPC call is logically
independent from the others.</li><li>Define RPCs that operate on a single object, instead of on an unbounded,
client-specified list of objects.</li><li>Avoid encoding unbounded data in string, byte, or repeated fields.</li><li>Define a long-running operation . Store the result in a
storage system designed for scalable, concurrent reads
.</li><li>Use a pagination API (see
<a href=#define-pagination-api>Rarely define a pagination API without a continuation token</a>).</li><li>Use streaming RPCs.</li></ul><p>If you are working on a UI, see also
<a href=#create-methods-manipulate-small-bits>Create methods that return or manipulate small bits of data</a>.</p><h2 id=propagate-status-codes>Propagate Status Codes Carefully</h2><p>RPC services should take care at RPC boundaries to interrogate errors, and
return meaningful status errors to their callers.</p><p>Let&rsquo;s examine a toy example to illustrate the point:</p><p>Consider a client that calls <code>ProductService.GetProducts</code>, which takes no
arguments. As part of <code>GetProducts</code>, <code>ProductService</code> might get all the
products, and call <code>LocaleService.LocaliseNutritionFacts</code> for each product.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>digraph toy_example {
</span></span><span style=display:flex><span>  node [style=filled]
</span></span><span style=display:flex><span>  client [label=&#34;Client&#34;];
</span></span><span style=display:flex><span>  product [label=&#34;ProductService&#34;];
</span></span><span style=display:flex><span>  locale [label=&#34;LocaleService&#34;];
</span></span><span style=display:flex><span>  client -&gt; product [label=&#34;GetProducts&#34;]
</span></span><span style=display:flex><span>  product -&gt; locale [label=&#34;LocaliseNutritionFacts&#34;]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>If <code>ProductService</code> is incorrectly implemented, it might send the wrong
arguments to <code>LocaleService</code>, resulting in an <code>INVALID_ARGUMENT</code>.</p><p>If <code>ProductService</code> carelessly returns errors to its callers, the client will
receive <code>INVALID_ARGUMENT</code>, since status codes propagate across RPC boundaries.
But, the client didn&rsquo;t pass any arguments to <code>ProductService.GetProducts</code>. So,
the error is worse than useless: it will cause a great deal of confusion!</p><p>Instead, <code>ProductService</code> should interrogate errors it receives at the RPC
boundary; that is, the <code>ProductService</code> RPC handler it implements. It should
return meaningful errors to users: if <em>it received</em> invalid arguments from the
caller, it should return <code>INVALID_ARGUMENT</code>. If <em>something downstream</em> received
invalid arguments, it should convert the <code>INVALID_ARGUMENT</code> to <code>INTERNAL</code> before
returning the error to the caller.</p><p>Carelessly propagating status errors leads to confusion, which can be very
expensive to debug. Worse, it can lead to an invisible outage where every
service forwards a client error without causing
any alerts to happen .</p><p>The general rule is: at RPC boundaries, take care to interrogate errors, and
return meaningful status errors to callers, with appropriate status codes. To
convey meaning, each RPC method should document what error codes it returns in
which circumstances. The implementation of each method should conform to the
documented API contract.</p><h2 id=unique-protos>Create Unique Protos per Method</h2><p>Create a unique request and response proto for each RPC method. Discovering
later that you need to diverge the top-level request or response can be
expensive. This includes &ldquo;empty&rdquo; responses; create a unique empty response proto
rather than reusing the <a href=https://github.com/protocolbuffers/protobuf/blob/main/src/google/protobuf/empty.proto>well-known Empty message type</a>.</p><h3 id=reuse-messages>Reusing Messages</h3><p>To reuse messages, create shared &ldquo;domain&rdquo; message types to include in multiple
Request and Response protos. Write your application logic in terms of those
types rather than the request and response types.</p><p>This gives you the flexibility to evolve your method request/response types
independently, but share code for logical sub-units.</p><h2 id=appendix>Appendix</h2><h3 id=returning-repeated-fields>Returning Repeated Fields</h3><p>When a repeated field is empty, the client can&rsquo;t tell if the field just wasn&rsquo;t
populated by the server or if the backing data for the field is genuinely empty.
In other words, there&rsquo;s no <code>hasFoo</code> method for repeated fields.</p><p>Wrapping a repeated field in a message is an easy way to get a hasFoo method.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>FooList</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>Foo</span> <span style=color:#000>foos</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>The more holistic way to solve it is with a field
<a href=#include-field-read-mask>read mask</a>. If the field was requested, an empty list
means there&rsquo;s no data. If the field wasn&rsquo;t requested the client should ignore
the field in the response.</p><h3 id=updating-repeated-fields>Updating Repeated Fields</h3><p>The worst way to update a repeated field is to force the client to supply a
replacement list. The dangers with forcing the client to supply the entire array
are manyfold. Clients that don&rsquo;t preserve unknown fields cause data loss.
Concurrent writes cause data loss. Even if those problems don&rsquo;t apply, your
clients will need to carefully read your documentation to know how the field is
interpreted on the server side. Does an empty field mean the server won&rsquo;t update
it, or that the server will clear it?</p><p><strong>Fix #1</strong>: Use a repeated update mask that permits the client to replace,
delete, or insert elements into the array without supplying the entire array on
a write.</p><p><strong>Fix #2</strong>: Create separate append, replace, delete arrays in the
request proto.</p><p><strong>Fix #3</strong>: Allow only appending or clearing. You can do this by wrapping the
repeated field in a message. A present, but empty, message means clear,
otherwise, any repeated elements mean append.</p><h3 id=order-independence-repeated-fields>Order Independence in Repeated Fields</h3><p><em>Try</em> to avoid order dependence in general. It&rsquo;s an extra layer of fragility. An
especially bad type of order dependence is parallel arrays. Parallel arrays make
it more difficult for clients to interpret the results and make it unnatural to
pass the two related fields around inside your own service.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>BatchEquationSolverResponse</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Bad: Solved values are returned in the order of the equations given in
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// the request.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#204a87;font-weight:700>double</span> <span style=color:#000>solved_values</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// (Usually) Bad: Parallel array for solved_values.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#204a87;font-weight:700>double</span> <span style=color:#000>solved_complex_values</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>// Good: A separate message that can grow to include more fields and be
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// shared among other methods. No order dependence between request and
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// response, no order dependence between multiple repeated fields.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>BatchEquationSolverResponse</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Deprecated, this will continue to be populated in responses until Q2
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// 2014, after which clients must move to using the solutions field below.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#204a87;font-weight:700>double</span> <span style=color:#000>solved_values</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>deprecated</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Good: Each equation in the request has a unique identifier that&#39;s
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// included in the EquationSolution below so that the solutions can be
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// correlated with the equations themselves. Equations are solved in
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// parallel and as the solutions are made they are added to this array.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>EquationSolution</span> <span style=color:#000>solutions</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><h3 id=leaking-features>Leaking Features Because Your Proto is in a Mobile Build</h3><p>Android and iOS runtimes both support reflection. To do that, the unfiltered
names of fields and messages are embedded in the application binary
(APK, IPA) as strings.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// This will leak existence of Google Teleport project on Android and iOS
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>FeatureStatus</span> <span style=color:#000>google_teleport_enabled</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>Several mitigation strategies:</p><ul><li>ProGuard obfuscation on Android. As of Q3 2014. iOS has no obfuscation
option: once you have the IPA on a desktop, piping it through <code>strings</code> will
reveal field names of included protos.
<a href=https://github.com/Bensge/Chrome-for-iOS-Headers>iOS Chrome tear-down</a></li><li>Curate precisely which fields are sent to mobile clients
.</li><li>If plugging the leak isn&rsquo;t feasible on an acceptable timescale, get buy-in
from the feature owner to risk it.</li></ul><p><em>Never</em> use this as an excuse to obfuscate the meaning of a field with a
code-name. Either plug the leak or get buy-in to risk it.</p><h3 id=performance-optimizations>Performance Optimizations</h3><p>You can trade type safety or clarity for performance wins in some cases. For
example, a proto with hundreds of fields&ndash;particularly message-type fields&ndash;is
going to be slower to parse than one with fewer fields. A very deeply-nested
message can be slow to deserialize just from the memory management. A handful of
techniques teams have used to speed deserialization:</p><ul><li>Create a parallel, trimmed proto that mirrors the larger proto but has only
some of the tags declared. Use this for parsing when you don&rsquo;t need all the
fields. Add tests to enforce that tag numbers continue to match as the
trimmed proto accumulates numbering &ldquo;holes.&rdquo;</li><li>Annotate the fields as &ldquo;lazily parsed&rdquo; with
<a href=https://github.com/protocolbuffers/protobuf/blob/cacb096002994000f8ccc6d9b8e1b5b0783ee561/src/google/protobuf/descriptor.proto#L609>[lazy=true]</a>.</li><li>Declare a field as bytes and document its type. Clients who care to parse
the field can do so manually. The danger with this approach is there&rsquo;s
nothing preventing someone from putting a message of the wrong type in the
bytes field. You should never do this with a proto that&rsquo;s written to any
logs, as it prevents the proto from being vetted for PII or scrubbed for
policy or privacy reasons.</li></ul><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>A gotcha with protos that contain <code>map&lt;k,v></code> fields. Don&rsquo;t use them as
reduce keys in a MapReduce. The wire format and iteration order of proto3
map items are <em>unspecified</em> which leads to inconsistent map shards.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow" aria-label="Stack Overflow"><a class=text-white target=_blank rel=noopener href=https://stackoverflow.com/questions/tagged/protocol-buffers aria-label="Stack Overflow"><i class="fab fa-stack-overflow"></i></a></li></ul><script type=text/javascript id=cookiebanner src=https://cdn.jsdelivr.net/gh/dobarkod/cookie-banner@1.2.2/dist/cookiebanner.min.js data-height=50px data-message="Protobuf.dev uses cookies from Google to deliver and enhance the quality of its services and to analyze traffic." data-bg=#ffb data-fg=#000 data-position=bottom data-padding="10px 16px" data-close-text="OK, got it" data-font-size=18px data-moreinfo=https://policies.google.com/technologies/cookies></script></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/protocolbuffers/protobuf aria-label=GitHub><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Developer mailing list" aria-label="Developer mailing list"><a class=text-white target=_blank rel=noopener href=https://groups.google.com/g/protobuf aria-label="Developer mailing list"><i class="fa fa-envelope"></i></a></li></ul><script type=text/javascript id=cookiebanner src=https://cdn.jsdelivr.net/gh/dobarkod/cookie-banner@1.2.2/dist/cookiebanner.min.js data-height=50px data-message="Protobuf.dev uses cookies from Google to deliver and enhance the quality of its services and to analyze traffic." data-bg=#ffb data-fg=#000 data-position=bottom data-padding="10px 16px" data-close-text="OK, got it" data-font-size=18px data-moreinfo=https://policies.google.com/technologies/cookies></script></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2025 Google LLC All Rights Reserved</small>
<small class=ml-1><a href=https://policies.google.com/privacy target=_blank rel=noopener>Privacy Policy</a></small>
<span class=text-white>Hosted by GitHub Pages.</span> <a href=https://docs.github.com/en/site-policy/privacy-policies/github-privacy-statement target=_blank>GitHub Privacy Statement</a></div></div></div></footer></div><script src=/js/main.min.c91cdfdcc1576ecc360abc6f1c3ca0485d047f65ac6d3203ec57ed29e0af808b.js integrity="sha256-yRzf3MFXbsw2CrxvHDygSF0Ef2WsbTID7FftKeCvgIs=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>