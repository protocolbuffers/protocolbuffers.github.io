<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Encoding | Protocol Buffers Documentation</title>
<meta name=description content="Explains how Protocol Buffers encodes data to files or to the wire."><meta property="og:title" content="Encoding"><meta property="og:description" content="Explains how Protocol Buffers encodes data to files or to the wire."><meta property="og:type" content="article"><meta property="og:url" content="https://protobuf.dev/programming-guides/encoding/"><meta property="article:section" content="programming-guides"><meta itemprop=name content="Encoding"><meta itemprop=description content="Explains how Protocol Buffers encodes data to files or to the wire."><meta itemprop=wordCount content="3358"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Encoding"><meta name=twitter:description content="Explains how Protocol Buffers encodes data to files or to the wire."><link rel=preload href=/scss/main.min.27bc098c9a8f7a1246d474f5c8afcee53760c9c7f38125d343ff52e0bf493011.css as=style integrity="sha256-J7wJjJqPehJG1HT1yK/O5TdgycfzgSXTQ/9S4L9JMBE=" crossorigin=anonymous><link href=/scss/main.min.27bc098c9a8f7a1246d474f5c8afcee53760c9c7f38125d343ff52e0bf493011.css rel=stylesheet integrity="sha256-J7wJjJqPehJG1HT1yK/O5TdgycfzgSXTQ/9S4L9JMBE=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-5L8P8GRN4Y"></script><script>var doNotTrack=!1,dnt;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-5L8P8GRN4Y")}</script></head><body class=td-page><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>Protocol Buffers Documentation</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav></ul></div><div class="d-none d-lg-block"><div class=td-search><div class=td-search__icon></div><input type=search class="td-search__input form-control td-search-input" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><div class=td-search><div class=td-search__icon></div><input type=search class="td-search__input form-control td-search-input" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="td-sidebar-nav collapse td-sidebar-nav--search-disabled" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m--li><a href=/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-><span>Protocol Buffers</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-overview-li><a href=/overview/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-overview><span>Overview</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-installation-li><a href=/installation/ title="Protocol Buffer Compiler Installation" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-installation><span>Protoc Installation</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-news-li><a href=/news/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-news><span>News</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-programming-guides-li><a href=/programming-guides/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-programming-guides><span>Programming Guides</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guideseditions-li><a href=/programming-guides/editions/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guideseditions><span>Language Guide (editions)</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesproto2-li><a href=/programming-guides/proto2/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesproto2><span>Language Guide (proto 2)</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesproto3-li><a href=/programming-guides/proto3/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesproto3><span>Language Guide (proto 3)</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesproto-limits-li><a href=/programming-guides/proto-limits/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesproto-limits><span>Proto Limits</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesstyle-li><a href=/programming-guides/style/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesstyle><span>Style Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesenum-li><a href=/programming-guides/enum/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesenum><span>Enum Behavior</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-programming-guidesencoding-li><a href=/programming-guides/encoding/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-programming-guidesencoding><span class=td-sidebar-nav-active-item>Encoding</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesjson-li><a href=/programming-guides/json/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesjson><span>ProtoJSON Format</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidestechniques-li><a href=/programming-guides/techniques/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidestechniques><span>Techniques</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesaddons-li><a href=/programming-guides/addons/ title="Third-Party Add-ons" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesaddons><span>Add-ons</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesextension_declarations-li><a href=/programming-guides/extension_declarations/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesextension_declarations><span>Extension Declarations</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesfield_presence-li><a href=/programming-guides/field_presence/ title="Application Note: Field Presence" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesfield_presence><span>Field Presence</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesserialization-not-canonical-li><a href=/programming-guides/serialization-not-canonical/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesserialization-not-canonical><span>Proto Serialization Is Not Canonical</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesdeserialize-debug-li><a href=/programming-guides/deserialize-debug/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesdeserialize-debug><span>Deserializing Debug Proto Representations</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-editions-li><a href=/editions/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-editions><span>Protobuf Editions</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-editionsoverview-li><a href=/editions/overview/ title="Protobuf Editions Overview" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-editionsoverview><span>Overview</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-editionsfeatures-li><a href=/editions/features/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-editionsfeatures><span>Feature Settings for Editions</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-editionsimplementation-li><a href=/editions/implementation/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-editionsimplementation><span>Implementing Editions Support</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-design-decisions-li><a href=/design-decisions/ title="Protobuf Team Design Decisions" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-design-decisions><span>Design Decisions</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-design-decisionsnullable-getters-setters-li><a href=/design-decisions/nullable-getters-setters/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-design-decisionsnullable-getters-setters><span>No Nullable Setters/Getters Support</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-best-practices-li><a href=/best-practices/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-best-practices><span>Proto Best Practices</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-best-practicesno-cargo-cults-li><a href=/best-practices/no-cargo-cults/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-best-practicesno-cargo-cults><span>Avoid Cargo Culting</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-best-practicesdos-donts-li><a href=/best-practices/dos-donts/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-best-practicesdos-donts><span>Proto Best Practices</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-best-practicesapi-li><a href=/best-practices/api/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-best-practicesapi><span>API Best Practices</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-best-practices1-1-1-li><a href=/best-practices/1-1-1/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-best-practices1-1-1><span>1-1-1 Best Practice</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-getting-started-li><a href=/getting-started/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-getting-started><span>Tutorials</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedcpptutorial-li><a href=/getting-started/cpptutorial/ title="Protocol Buffer Basics: C++" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedcpptutorial><span>C++</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedcsharptutorial-li><a href=/getting-started/csharptutorial/ title="Protocol Buffer Basics: C#" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedcsharptutorial><span>C#</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-starteddarttutorial-li><a href=/getting-started/darttutorial/ title="Protocol Buffer Basics: Dart" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-getting-starteddarttutorial><span>Dart</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedgotutorial-li><a href=/getting-started/gotutorial/ title="Protocol Buffer Basics: Go" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedgotutorial><span>Go</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedjavatutorial-li><a href=/getting-started/javatutorial/ title="Protocol Buffer Basics: Java" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedjavatutorial><span>Java</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedkotlintutorial-li><a href=/getting-started/kotlintutorial/ title="Protocol Buffer Basics: Kotlin" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedkotlintutorial><span>Kotlin</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedpythontutorial-li><a href=/getting-started/pythontutorial/ title="Protocol Buffer Basics: Python" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedpythontutorial><span>Python</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-reference-li><a href=/reference/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-reference><span>Reference Guides</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencecpp-li><a href=/reference/cpp/ title="C++ Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referencecpp><span>C++</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecppcpp-generated-li><a href=/reference/cpp/cpp-generated/ title="C++ Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencecppcpp-generated><span>Generated Code Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecppstring-view-li><a href=/reference/cpp/string-view/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencecppstring-view><span>String View APIs</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecpparenas-li><a href=/reference/cpp/arenas/ title="C++ Arena Allocation Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencecpparenas><span>Arena Allocation Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecppabseil-li><a href=/reference/cpp/abseil/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencecppabseil><span>Abseil Support</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecppapi-docs-link-li><a href=/reference/cpp/api-docs/ target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencecppapi-docs-link><span>C++ API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencecsharp-li><a href=/reference/csharp/ title="C# Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referencecsharp><span>C#</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecsharpcsharp-generated-li><a href=/reference/csharp/csharp-generated/ title="C# Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencecsharpcsharp-generated><span>Generated Code Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecsharpapi-docs-link-li><a href=/reference/csharp/api-docs target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencecsharpapi-docs-link><span>C# API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencedart-li><a href=/reference/dart/ title="Dart Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referencedart><span>Dart</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencedartdart-generated-li><a href=/reference/dart/dart-generated/ title="Dart Generated Code" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencedartdart-generated><span>Generated Code</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencedartapi-docs-link-li><a href=https://pub.dartlang.org/documentation/protobuf target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencedartapi-docs-link><span>Dart API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencego-li><a href=/reference/go/ title="Go Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referencego><span>Go</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencegogo-generated-li><a href=/reference/go/go-generated/ title="Go Generated Code Guide (Open)" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencegogo-generated><span>Generated Code Guide (Open)</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencegogo-generated-opaque-li><a href=/reference/go/go-generated-opaque/ title="Go Generated Code Guide (Opaque)" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencegogo-generated-opaque><span>Generated Code Guide (Opaque)</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencegofaq-li><a href=/reference/go/faq/ title="Go FAQ" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencegofaq><span>FAQ</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencegosize-li><a href=/reference/go/size/ title="Go Size Semantics" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencegosize><span>Size Semantics</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencegoapi-docs-link-li><a href=https://pkg.go.dev/google.golang.org/protobuf/proto target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencegoapi-docs-link><span>Go API</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencegoopaque-migration-li><a href=/reference/go/opaque-migration/ title="Go Opaque API Migration" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencegoopaque-migration><span>Opaque API Migration</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencegoopaque-migration-manual-li><a href=/reference/go/opaque-migration-manual/ title="Go Opaque API: Manual Migration" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencegoopaque-migration-manual><span>Opaque API: Manual Migration</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencegoopaque-faq-li><a href=/reference/go/opaque-faq/ title="Go Opaque API FAQ" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencegoopaque-faq><span>Opaque API FAQ</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencejava-li><a href=/reference/java/ title="Java Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referencejava><span>Java</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencejavajava-generated-li><a href=/reference/java/java-generated/ title="Java Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencejavajava-generated><span>Generated Code Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencejavajava-proto-names-li><a href=/reference/java/java-proto-names/ title="Java Proto Names" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencejavajava-proto-names><span>Generated Proto Names</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencejavaapi-docs-link-li><a href=/reference/java/api-docs/overview-summary.html target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencejavaapi-docs-link><span>Java API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencekotlin-li><a href=/reference/kotlin/ title="Kotlin Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referencekotlin><span>Kotlin</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencekotlinapi-docs-li><a href=/reference/kotlin/api-docs/ title="Kotlin Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referencekotlinapi-docs><span>Kotlin</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencekotlinkotlin-generated-li><a href=/reference/kotlin/kotlin-generated/ title="Kotlin Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencekotlinkotlin-generated><span>Generated Code Guide</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referenceobjective-c-li><a href=/reference/objective-c/ title="Objective-C Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referenceobjective-c><span>Objective-C</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceobjective-cobjective-c-generated-li><a href=/reference/objective-c/objective-c-generated/ title="Objective-C Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referenceobjective-cobjective-c-generated><span>Generated Code Guide</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencephp-li><a href=/reference/php/ title="PHP Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referencephp><span>PHP</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencephpphp-generated-li><a href=/reference/php/php-generated/ title="PHP Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencephpphp-generated><span>Generated Code Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencephpapi-docs-link-li><a href=/reference/php/api-docs/ target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencephpapi-docs-link><span>PHP API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencepython-li><a href=/reference/python/ title="Python Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referencepython><span>Python</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencepythonpython-generated-li><a href=/reference/python/python-generated/ title="Python Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencepythonpython-generated><span>Generated Code Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencepythonapi-docs-link-li><a href=https://googleapis.dev/python/protobuf/latest/ target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencepythonapi-docs-link><span>Python API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referenceruby-li><a href=/reference/ruby/ title="Ruby Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referenceruby><span>Ruby</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencerubyruby-generated-li><a href=/reference/ruby/ruby-generated/ title="Ruby Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencerubyruby-generated><span>Generated Code Guide</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referenceprotobuf-li><a href=/reference/protobuf/ title="Protocol Buffers Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referenceprotobuf><span>Protocol Buffers</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceprotobufedition-2023-spec-li><a href=/reference/protobuf/edition-2023-spec/ title="Protocol Buffers Edition 2023 Language Specification" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referenceprotobufedition-2023-spec><span>2023 Language Specification</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceprotobufproto2-spec-li><a href=/reference/protobuf/proto2-spec/ title="Protocol Buffers Version 2 Language Specification" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referenceprotobufproto2-spec><span>Version 2 Language Specification</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceprotobufproto3-spec-li><a href=/reference/protobuf/proto3-spec/ title="Protocol Buffers Version 3 Language Specification" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referenceprotobufproto3-spec><span>Version 3 Language Specification</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceprotobuftextformat-spec-li><a href=/reference/protobuf/textformat-spec/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referenceprotobuftextformat-spec><span>Text Format Language Specification</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceprotobufgoogleprotobuf-li><a href=/reference/protobuf/google.protobuf/ title="Protocol Buffers Well-Known Types" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referenceprotobufgoogleprotobuf><span>Well-Known Types</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceother-li><a href=/reference/other/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referenceother><span>Other Languages</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-support-li><a href=/support/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-support><span>Support</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-supportversion-support-li><a href=/support/version-support/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-supportversion-support><span>Version Support</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-supportmigration-li><a href=/support/migration/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-supportmigration><span>Migration Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-supportcross-version-runtime-guarantee-li><a href=/support/cross-version-runtime-guarantee/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-supportcross-version-runtime-guarantee><span>Cross-Version Runtime Guarantee</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-downloads-li><a href=/downloads/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-downloads><span>Downloads</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-history-li><a href=/history/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-history><span>History</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-forum-link-li><a href=https://groups.google.com/g/protobuf target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-forum-link><span>Forum</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-navbar-li><a href=/navbar/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-navbar><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-search-li><a href=/search/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-search><span>Search Results</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/protocolbuffers/protocolbuffers.github.io/tree/main/content/programming-guides/encoding.md class=td-page-meta--view target=_blank rel=noopener><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
<a href=https://github.com/protocolbuffers/protocolbuffers.github.io/edit/main/content/programming-guides/encoding.md class=td-page-meta--edit target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
<a href="https://github.com/protocolbuffers/protocolbuffers.github.io/new/main/content/programming-guides/encoding.md?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class=td-page-meta--child target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
<a href="https://github.com/protocolbuffers/protocolbuffers.github.io/issues/new?title=Encoding" class=td-page-meta--issue target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create documentation issue</a>
<a href=https://github.com/protocolbuffers/protobuf/issues/new class=td-page-meta--project-issue target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create project issue</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#simple>A Simple Message</a></li><li><a href=#varints>Base 128 Varints</a></li><li><a href=#structure>Message Structure</a></li><li><a href=#int-types>More Integer Types</a><ul><li><a href=#bools-and-enums>Bools and Enums</a></li><li><a href=#signed-ints>Signed Integers</a></li><li><a href=#non-varints>Non-varint Numbers</a></li></ul></li><li><a href=#length-types>Length-Delimited Records</a><ul><li><a href=#embedded>Submessages</a></li></ul></li><li><a href=#optional>Missing Elements</a></li><li><a href=#repeated>Repeated Elements</a><ul><li><a href=#oneofs>Oneofs</a></li><li><a href=#last-one-wins>Last One Wins</a></li><li><a href=#maps>Maps</a></li></ul></li><li><a href=#groups>Groups</a></li><li><a href=#order>Field Order</a><ul><li><a href=#implications>Implications</a></li></ul></li><li><a href=#size-limit>Encoded Proto Size Limitations</a></li><li><a href=#cheat-sheet>Condensed Reference Card</a><ul><li><a href=#cheat-sheet-key>Key</a></li></ul></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=/programming-guides/>Programming Guides</a></li><li class="breadcrumb-item active" aria-current=page>Encoding</li></ol></nav><div class=td-content><h1>Encoding</h1><div class=lead>Explains how Protocol Buffers encodes data to files or to the wire.</div><header class=article-meta></header><p>This document describes the protocol buffer <em>wire format</em>, which defines the
details of how your message is sent on the wire and how much space it consumes
on disk. You probably don&rsquo;t need to understand this to use protocol buffers in
your application, but it&rsquo;s useful information for doing optimizations.</p><p>If you already know the concepts but want a reference, skip to the
<a href=#cheat-sheet>Condensed reference card</a> section.</p><p><a href=https://github.com/protocolbuffers/protoscope>Protoscope</a> is a very simple
language for describing snippets of the low-level wire format, which we&rsquo;ll use
to provide a visual reference for the encoding of various messages. Protoscope&rsquo;s
syntax consists of a sequence of <em>tokens</em> that each encode down to a specific
byte sequence.</p><p>For example, backticks denote a raw hex literal, like <code>`70726f746f6275660a`</code>. This encodes into the exact bytes denoted as hex in the literal. Quotes
denote UTF-8 strings, like <code>"Hello, Protobuf!"</code>. This literal is synonymous with
<code>`48656c6c6f2c2050726f746f62756621`</code> (which, if you observe closely, is
composed of ASCII bytes). We&rsquo;ll introduce more of the Protoscope language as we
discuss aspects of the wire format.</p><p>The Protoscope tool can also dump encoded protocol buffers as text. See
<a href=https://github.com/protocolbuffers/protoscope/tree/main/testdata>https://github.com/protocolbuffers/protoscope/tree/main/testdata</a> for examples.</p><p>All examples in this topic assume that you are using Edition 2023 or later.</p><h2 id=simple>A Simple Message</h2><p>Let&rsquo;s say you have the following very simple message definition:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Test1</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>a</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>In an application, you create a <code>Test1</code> message and set <code>a</code> to 150. You then
serialize the message to an output stream. If you were able to examine the
encoded message, you&rsquo;d see three bytes:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#0000cf;font-weight:700>08</span> <span style=color:#0000cf;font-weight:700>96</span> <span style=color:#0000cf;font-weight:700>01</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>So far, so small and numeric &ndash; but what does it mean? If you use the Protoscope
tool to dump those bytes, you&rsquo;d get something like <code>1: 150</code>. How does it know
this is the contents of the message?</p><h2 id=varints>Base 128 Varints</h2><p>Variable-width integers, or <em>varints</em>, are at the core of the wire format. They
allow encoding unsigned 64-bit integers using anywhere between one and ten
bytes, with small values using fewer bytes.</p><p>Each byte in the varint has a <em>continuation bit</em> that indicates if the byte that
follows it is part of the varint. This is the <em>most significant bit</em> (MSB) of
the byte (sometimes also called the <em>sign bit</em>). The lower 7 bits are a payload;
the resulting integer is built by appending together the 7-bit payloads of its
constituent bytes.</p><p>So, for example, here is the number 1, encoded as <code>`01`</code> &ndash; it&rsquo;s a single
byte, so the MSB is not set:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#0000cf;font-weight:700>0000</span> <span style=color:#0000cf;font-weight:700>0001</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>^</span> <span style=color:#000>msb</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>And here is 150, encoded as <code>`9601`</code> &ndash; this is a bit more complicated:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#0000cf;font-weight:700>10010110</span> <span style=color:#0000cf;font-weight:700>00000001</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>^</span> <span style=color:#000>msb</span>    <span style=color:#a40000>^</span> <span style=color:#000>msb</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>How do you figure out that this is 150? First you drop the MSB from each byte,
as this is just there to tell us whether we&rsquo;ve reached the end of the number (as
you can see, it&rsquo;s set in the first byte as there is more than one byte in the
varint). These 7-bit payloads are in little-endian order. Convert to big-endian
order, concatenate, and interpret as an unsigned 64-bit integer:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#0000cf;font-weight:700>10010110</span> <span style=color:#0000cf;font-weight:700>00000001</span>        <span style=color:#8f5902;font-style:italic>// Original inputs.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span> <span style=color:#0000cf;font-weight:700>0010110</span>  <span style=color:#0000cf;font-weight:700>0000001</span>        <span style=color:#8f5902;font-style:italic>// Drop continuation bits.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span> <span style=color:#0000cf;font-weight:700>0000001</span>  <span style=color:#0000cf;font-weight:700>0010110</span>        <span style=color:#8f5902;font-style:italic>// Convert to big-endian.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#0000cf;font-weight:700>00000010010110</span>        <span style=color:#8f5902;font-style:italic>// Concatenate.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span> <span style=color:#0000cf;font-weight:700>128</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#0000cf;font-weight:700>16</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#0000cf;font-weight:700>4</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>150</span>  <span style=color:#8f5902;font-style:italic>// Interpret as an unsigned 64-bit integer.
</span></span></span></code></pre></div><p>Because varints are so crucial to protocol buffers, in protoscope syntax, we
refer to them as plain integers. <code>150</code> is the same as <code>`9601`</code>.</p><h2 id=structure>Message Structure</h2><p>A protocol buffer message is a series of key-value pairs. The binary version of
a message just uses the field&rsquo;s number as the key &ndash; the name and declared type
for each field can only be determined on the decoding end by referencing the
message type&rsquo;s definition (i.e. the <code>.proto</code> file). Protoscope does not have
access to this information, so it can only provide the field numbers.</p><p>When a message is encoded, each key-value pair is turned into a <em>record</em>
consisting of the field number, a wire type and a payload. The wire type tells
the parser how big the payload after it is. This allows old parsers to skip over
new fields they don&rsquo;t understand. This type of scheme is sometimes called
<a href=https://en.wikipedia.org/wiki/Type%E2%80%93length%E2%80%93value>Tag-Length-Value</a>,
or TLV.</p><p>There are six wire types: <code>VARINT</code>, <code>I64</code>, <code>LEN</code>, <code>SGROUP</code>, <code>EGROUP</code>, and <code>I32</code></p><table><thead><tr><th>ID</th><th>Name</th><th>Used For</th></tr></thead><tbody><tr><td>0</td><td>VARINT</td><td>int32, int64, uint32, uint64, sint32, sint64, bool, enum</td></tr><tr><td>1</td><td>I64</td><td>fixed64, sfixed64, double</td></tr><tr><td>2</td><td>LEN</td><td>string, bytes, embedded messages, packed repeated fields</td></tr><tr><td>3</td><td>SGROUP</td><td>group start (deprecated)</td></tr><tr><td>4</td><td>EGROUP</td><td>group end (deprecated)</td></tr><tr><td>5</td><td>I32</td><td>fixed32, sfixed32, float</td></tr></tbody></table><p>The &ldquo;tag&rdquo; of a record is encoded as a varint formed from the field number and
the wire type via the formula <code>(field_number &lt;&lt; 3) | wire_type</code>. In other words,
after decoding the varint representing a field, the low 3 bits tell us the wire
type, and the rest of the integer tells us the field number.</p><p>Now let&rsquo;s look at our simple example again. You now know that the first number
in the stream is always a varint key, and here it&rsquo;s <code>`08`</code>, or (dropping the
MSB):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#0000cf;font-weight:700>000</span> <span style=color:#0000cf;font-weight:700>1000</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>You take the last three bits to get the wire type (0) and then right-shift by
three to get the field number (1). Protoscope represents a tag as an integer
followed by a colon and the wire type, so we can write the above bytes as
<code>1:VARINT</code>.</p><p>Because the wire type is 0, or <code>VARINT</code>, we know that we need to decode a varint
to get the payload. As we saw above, the bytes <code>`9601`</code> varint-decode to
150, giving us our record. We can write it in Protoscope as <code>1:VARINT 150</code>.</p><p>Protoscope can infer the type for a tag if there is whitespace after the <code>:</code>. It
does so by looking ahead at the next token and guessing what you meant (the
rules are documented in detail in
<a href=https://github.com/protocolbuffers/protoscope/blob/main/language.txt>Protoscope&rsquo;s language.txt</a>).
For example, in <code>1: 150</code>, there is a varint immediately after the untyped tag,
so Protoscope infers its type to be <code>VARINT</code>. If you wrote <code>2: {}</code>, it would see
the <code>{</code> and guess <code>LEN</code>; if you wrote <code>3: 5i32</code> it would guess <code>I32</code>, and so on.</p><h2 id=int-types>More Integer Types</h2><h3 id=bools-and-enums>Bools and Enums</h3><p>Bools and enums are both encoded as if they were <code>int32</code>s. Bools, in particular,
always encode as either <code>`00`</code> or <code>`01`</code>. In Protoscope, <code>false</code> and
<code>true</code> are aliases for these byte strings.</p><h3 id=signed-ints>Signed Integers</h3><p>As you saw in the previous section, all the protocol buffer types associated
with wire type 0 are encoded as varints. However, varints are unsigned, so the
different signed types, <code>sint32</code> and <code>sint64</code> vs <code>int32</code> or <code>int64</code>, encode
negative integers differently.</p><p>The <code>intN</code> types encode negative numbers as two&rsquo;s complement, which means that,
as unsigned, 64-bit integers, they have their highest bit set. As a result, this
means that <em>all ten bytes</em> must be used. For example, <code>-2</code> is converted by
protoscope into</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#0000cf;font-weight:700>11111110</span> <span style=color:#0000cf;font-weight:700>11111111</span> <span style=color:#0000cf;font-weight:700>11111111</span> <span style=color:#0000cf;font-weight:700>11111111</span> <span style=color:#0000cf;font-weight:700>11111111</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#0000cf;font-weight:700>11111111</span> <span style=color:#0000cf;font-weight:700>11111111</span> <span style=color:#0000cf;font-weight:700>11111111</span> <span style=color:#0000cf;font-weight:700>11111111</span> <span style=color:#0000cf;font-weight:700>00000001</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>This is the <em>two&rsquo;s complement</em> of 2, defined in unsigned arithmetic as <code>~0 - 2 + 1</code>, where <code>~0</code> is the all-ones 64-bit integer. It is a useful exercise to
understand why this produces so many ones.</p><p><code>sintN</code> uses the &ldquo;ZigZag&rdquo; encoding instead of two&rsquo;s complement to encode
negative integers. Positive integers <code>p</code> are encoded as <code>2 * p</code> (the even
numbers), while negative integers <code>n</code> are encoded as <code>2 * |n| - 1</code> (the odd
numbers). The encoding thus &ldquo;zig-zags&rdquo; between positive and negative numbers.
For example:</p><table><thead><tr><th>Signed Original</th><th>Encoded As</th></tr></thead><tbody><tr><td>0</td><td>0</td></tr><tr><td>-1</td><td>1</td></tr><tr><td>1</td><td>2</td></tr><tr><td>-2</td><td>3</td></tr><tr><td>&mldr;</td><td>&mldr;</td></tr><tr><td>0x7fffffff</td><td>0xfffffffe</td></tr><tr><td>-0x80000000</td><td>0xffffffff</td></tr></tbody></table><p>In other words, each value <code>n</code> is encoded using</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>(n &lt;&lt; 1) ^ (n &gt;&gt; 31)
</span></span></code></pre></div><p>for <code>sint32</code>s, or</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>(n &lt;&lt; 1) ^ (n &gt;&gt; 63)
</span></span></code></pre></div><p>for the 64-bit version.</p><p>When the <code>sint32</code> or <code>sint64</code> is parsed, its value is decoded back to the
original, signed version.</p><p>In protoscope, suffixing an integer with a <code>z</code> will make it encode as ZigZag.
For example, <code>-500z</code> is the same as the varint <code>999</code>.</p><h3 id=non-varints>Non-varint Numbers</h3><p>Non-varint numeric types are simple &ndash; <code>double</code> and <code>fixed64</code> have wire type
<code>I64</code>, which tells the parser to expect a fixed eight-byte lump of data. We can
specify a <code>double</code> record by writing <code>5: 25.4</code>, or a <code>fixed64</code> record with <code>6: 200i64</code>. In both cases, omitting an explicit wire type implies the <code>I64</code> wire
type.</p><p>Similarly <code>float</code> and <code>fixed32</code> have wire type <code>I32</code>, which tells it to expect
four bytes instead. The syntax for these consists of adding an <code>i32</code> suffix.
<code>25.4i32</code> will emit four bytes, as will <code>200i32</code>. Tag types are inferred as
<code>I32</code>.</p><h2 id=length-types>Length-Delimited Records</h2><p><em>Length prefixes</em> are another major concept in the wire format. The <code>LEN</code> wire
type has a dynamic length, specified by a varint immediately after the tag,
which is followed by the payload as usual.</p><p>Consider this message schema:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Test2</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>b</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>A record for the field <code>b</code> is a string, and strings are <code>LEN</code>-encoded. If we set
<code>b</code> to <code>"testing"</code>, we encoded as a <code>LEN</code> record with field number 2 containing
the ASCII string <code>"testing"</code>. The result is <code>`120774657374696e67`</code>. Breaking
up the bytes,</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#0000cf;font-weight:700>12</span> <span style=color:#0000cf;font-weight:700>07</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>74</span> <span style=color:#0000cf;font-weight:700>65</span> <span style=color:#0000cf;font-weight:700>73</span> <span style=color:#0000cf;font-weight:700>74</span> <span style=color:#0000cf;font-weight:700>69</span> <span style=color:#0000cf;font-weight:700>6</span><span style=color:#000>e</span> <span style=color:#0000cf;font-weight:700>67</span><span style=color:#000;font-weight:700>]</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>we see that the tag, <code>`12`</code>, is <code>00010 010</code>, or <code>2:LEN</code>. The byte that
follows is the int32 varint <code>7</code>, and the next seven bytes are the UTF-8
encoding of <code>"testing"</code>. The int32 varint means that the max length of a string
is 2GB.</p><p>In Protoscope, this is written as <code>2:LEN 7 "testing"</code>. However, it can be
inconvenient to repeat the length of the string (which, in Protoscope text, is
already quote-delimited). Wrapping Protoscope content in braces will generate a
length prefix for it: <code>{"testing"}</code> is a shorthand for <code>7 "testing"</code>. <code>{}</code> is
always inferred by fields to be a <code>LEN</code> record, so we can write this record
simply as <code>2: {"testing"}</code>.</p><p><code>bytes</code> fields are encoded in the same way.</p><h3 id=embedded>Submessages</h3><p>Submessage fields also use the <code>LEN</code> wire type. Here&rsquo;s a message definition with
an embedded message of our original example message, <code>Test1</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Test3</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>Test1</span> <span style=color:#000>c</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>If <code>Test1</code>&rsquo;s <code>a</code> field (i.e., <code>Test3</code>&rsquo;s <code>c.a</code> field) is set to 150, we get <code>``1a03089601``</code>. Breaking it up:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000>a</span> <span style=color:#0000cf;font-weight:700>03</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>08</span> <span style=color:#0000cf;font-weight:700>96</span> <span style=color:#0000cf;font-weight:700>01</span><span style=color:#000;font-weight:700>]</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>The last three bytes (in <code>[]</code>) are exactly the same ones from our
<a href=#simple>very first example</a>. These bytes are preceded by a <code>LEN</code>-typed tag,
and a length of 3, exactly the same way as strings are encoded.</p><p>In Protoscope, submessages are quite succinct. <code>``1a03089601``</code> can be written
as <code>3: {1: 150}</code>.</p><h2 id=optional>Missing Elements</h2><p>Missing fields are easy to encode: we just leave out the record if
it&rsquo;s not present. This means that &ldquo;huge&rdquo; protos with only a few fields set are
quite sparse.</p><p><span id=packed></span></p><h2 id=repeated>Repeated Elements</h2><p>Starting in Edition 2023, <code>repeated</code> fields of a primitive type
(any <a href=/programming-guides/proto2#scalar>scalar type</a>
that is not <code>string</code> or <code>bytes</code>) are <a href=/editions/features#repeated_field_encoding>&ldquo;packed&rdquo;</a> by default.</p><p>Packed <code>repeated</code> fields, instead of being encoded as one
record per entry, are encoded as a single <code>LEN</code> record that contains each
element concatenated. To decode, elements are decoded from the <code>LEN</code> record one
by one until the payload is exhausted. The start of the next element is
determined by the length of the previous, which itself depends on the type of
the field. Thus, if we have:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Test4</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>d</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>e</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>6</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>and we construct a <code>Test4</code> message with <code>d</code> set to <code>"hello"</code>, and <code>e</code> set to
<code>1</code>, <code>2</code>, and <code>3</code>, this <em>could</em> be encoded as <code>`3206038e029ea705`</code>, or
written out as Protoscope,</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span><span style=color:#4e9a06>&#34;hello&#34;</span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#0000cf;font-weight:700>6</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>3</span> <span style=color:#0000cf;font-weight:700>270</span> <span style=color:#0000cf;font-weight:700>86942</span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>However, if the repeated field is set to expanded (overriding the default packed
state) or is not packable (strings and messages) then an entry for each
individual value is encoded. Also, records for <code>e</code> do not need to appear
consecutively, and can be interleaved with other fields; only the order of
records for the same field with respect to each other is preserved. Thus, this
could look like the following:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span><span style=color:#4e9a06>&#34;hello&#34;</span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>Only repeated fields of primitive numeric types can be declared &ldquo;packed&rdquo;. These
are types that would normally use the <code>VARINT</code>, <code>I32</code>, or <code>I64</code> wire types.</p><p>Note that although there&rsquo;s usually no reason to encode more than one key-value
pair for a packed repeated field, parsers must be prepared to accept multiple
key-value pairs. In this case, the payloads should be concatenated. Each pair
must contain a whole number of elements. The following is a valid encoding of
the same message above that parsers must accept:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#0000cf;font-weight:700>6</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>3</span> <span style=color:#0000cf;font-weight:700>270</span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#0000cf;font-weight:700>6</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>86942</span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>Protocol buffer parsers must be able to parse repeated fields that were compiled
as <code>packed</code> as if they were not packed, and vice versa. This permits adding
<code>[packed=true]</code> to existing fields in a forward- and backward-compatible way.</p><h3 id=oneofs>Oneofs</h3><p><a href=/programming-guides/proto2#oneof><code>Oneof</code> fields</a> are
encoded the same as if the fields were not in a <code>oneof</code>. The rules that apply to
<code>oneofs</code> are independent of how they are represented on the wire.</p><h3 id=last-one-wins>Last One Wins</h3><p>Normally, an encoded message would never have more than one instance of a
non-<code>repeated</code> field. However, parsers are expected to handle the case in which
they do. For numeric types and strings, if the same field appears multiple
times, the parser accepts the <em>last</em> value it sees. For embedded message fields,
the parser merges multiple instances of the same field, as if with the
<code>Message::MergeFrom</code> method &ndash; that is, all singular scalar fields in the latter
instance replace those in the former, singular embedded messages are merged, and
<code>repeated</code> fields are concatenated. The effect of these rules is that parsing
the concatenation of two encoded messages produces exactly the same result as if
you had parsed the two messages separately and merged the resulting objects.
That is, this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#000>MyMessage</span> <span style=color:#000>message</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ParseFromString</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>str1</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>str2</span><span style=color:#000;font-weight:700>);</span>
</span></span></code></pre></div><p>is equivalent to this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#000>MyMessage</span> <span style=color:#000>message</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>message2</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ParseFromString</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>str1</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>message2</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ParseFromString</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>str2</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>MergeFrom</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>message2</span><span style=color:#000;font-weight:700>);</span>
</span></span></code></pre></div><p>This property is occasionally useful, as it allows you to merge two messages (by
concatenation) even if you do not know their types.</p><h3 id=maps>Maps</h3><p>Map fields are just a shorthand for a special kind of repeated field. If we have</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Test6</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>map</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>int32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000>g</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>7</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>this is actually the same as</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Test6</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>g_Entry</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>key</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>value</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>g_Entry</span> <span style=color:#000>g</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>7</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>Thus, maps are encoded exactly like a <code>repeated</code> message field: as a sequence of
<code>LEN</code>-typed records, with two fields each.</p><h2 id=groups>Groups</h2><p>Groups are a deprecated feature that should not be used, but they remain in the
wire format, and deserve a passing mention.</p><p>A group is a bit like a submessage, but it is delimited by special tags rather
than by a <code>LEN</code> prefix. Each group in a message has a field number, which is
used on these special tags.</p><p>A group with field number <code>8</code> begins with an <code>8:SGROUP</code> tag. <code>SGROUP</code> records
have empty payloads, so all this does is denote the start of the group. Once all
the fields in the group are listed, a corresponding <code>8:EGROUP</code> tag denotes its
end. <code>EGROUP</code> records also have no payload, so <code>8:EGROUP</code> is the entire record.
Group field numbers need to match up. If we encounter <code>7:EGROUP</code> where we expect
<code>8:EGROUP</code>, the message is mal-formed.</p><p>Protoscope provides a convenient syntax for writing groups. Instead of writing</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#000>SGROUP</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span><span style=color:#4e9a06>&#34;foo&#34;</span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#000>EGROUP</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>Protoscope allows</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#a40000>!</span><span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span><span style=color:#4e9a06>&#34;foo&#34;</span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>This will generate the appropriate start and end group markers. The <code>!{}</code> syntax
can only occur immediately after an un-typed tag expression, like <code>8:</code>.</p><h2 id=order>Field Order</h2><p>Field numbers may be declared in any order in a <code>.proto</code> file. The order chosen
has no effect on how the messages are serialized.</p><p>When a message is serialized, there is no guaranteed order for how its known or
<a href=/programming-guides/proto2#updating>unknown fields</a>
will be written. Serialization order is an implementation detail, and the
details of any particular implementation may change in the future. Therefore,
protocol buffer parsers must be able to parse fields in any order.</p><h3 id=implications>Implications</h3><ul><li>Do not assume the byte output of a serialized message is stable. This is
especially true for messages with transitive bytes fields representing other
serialized protocol buffer messages.</li><li>By default, repeated invocations of serialization methods on the same
protocol buffer message instance may not produce the same byte output. That
is, the default serialization is not deterministic.<ul><li>Deterministic serialization only guarantees the same byte output for a
particular binary. The byte output may change across different versions
of the binary.</li></ul></li><li>The following checks may fail for a protocol buffer message instance <code>foo</code>:<ul><li><code>foo.SerializeAsString() == foo.SerializeAsString()</code></li><li><code>Hash(foo.SerializeAsString()) == Hash(foo.SerializeAsString())</code></li><li><code>CRC(foo.SerializeAsString()) == CRC(foo.SerializeAsString())</code></li><li><code>FingerPrint(foo.SerializeAsString()) == FingerPrint(foo.SerializeAsString())</code></li></ul></li><li>Here are a few example scenarios where logically equivalent protocol buffer
messages <code>foo</code> and <code>bar</code> may serialize to different byte outputs:<ul><li><code>bar</code> is serialized by an old server that treats some fields as unknown.</li><li><code>bar</code> is serialized by a server that is implemented in a different
programming language and serializes fields in different order.</li><li><code>bar</code> has a field that serializes in a non-deterministic manner.</li><li><code>bar</code> has a field that stores a serialized byte output of a protocol
buffer message which is serialized differently.</li><li><code>bar</code> is serialized by a new server that serializes fields in a
different order due to an implementation change.</li><li><code>foo</code> and <code>bar</code> are concatenations of the same individual messages in a
different order.</li></ul></li></ul><h2 id=size-limit>Encoded Proto Size Limitations</h2><p>Protos must be smaller than 2 GiB when serialized. Many proto implementations
will refuse to serialize or parse messages that exceed this limit.</p><h2 id=cheat-sheet>Condensed Reference Card</h2><p>The following provides the most prominent parts of the wire format in an
easy-to-reference format.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span><span style=color:#000>message</span>    <span style=color:#000;font-weight:700>:</span><span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>tag</span> <span style=color:#000>value</span><span style=color:#000;font-weight:700>)</span><span style=color:#ce5c00;font-weight:700>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>tag</span>        <span style=color:#000;font-weight:700>:</span><span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>field</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>bit</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#204a87;font-weight:700>or</span> <span style=color:#000>wire_type</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>                <span style=color:#000>encoded</span> <span style=color:#000>as</span> <span style=color:#000>uint32</span> <span style=color:#000>varint</span>
</span></span><span style=display:flex><span><span style=color:#000>value</span>      <span style=color:#000;font-weight:700>:</span><span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>varint</span>      <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>wire_type</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#000>VARINT</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#000>i32</span>         <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>wire_type</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#000>I32</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#000>i64</span>         <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>wire_type</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#000>I64</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#000>len</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>prefix</span>  <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>wire_type</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#000>LEN</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>empty</span><span style=color:#ce5c00;font-weight:700>&gt;</span>     <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>wire_type</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#000>SGROUP</span> <span style=color:#204a87;font-weight:700>or</span> <span style=color:#000>EGROUP</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>varint</span>     <span style=color:#000;font-weight:700>:</span><span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>int32</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>int64</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>uint32</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>uint64</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#c00;font-weight:700>bool</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#204a87;font-weight:700>enum</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>sint32</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>sint64</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>                <span style=color:#000>encoded</span> <span style=color:#000>as</span> <span style=color:#000>varints</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>sintN</span> <span style=color:#000>are</span> <span style=color:#000>ZigZag</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>encoded</span> <span style=color:#000>first</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>i32</span>        <span style=color:#000;font-weight:700>:</span><span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>sfixed32</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>fixed32</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#c00;font-weight:700>float</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>                <span style=color:#000>encoded</span> <span style=color:#000>as</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>byte</span> <span style=color:#000>little</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>endian</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>                <span style=color:#000>memcpy</span> <span style=color:#000>of</span> <span style=color:#000>the</span> <span style=color:#000>equivalent</span> <span style=color:#000>C</span> <span style=color:#000>types</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>u</span><span style=color:#a40000>?</span><span style=color:#000>int32_t</span><span style=color:#000;font-weight:700>,</span> <span style=color:#c00;font-weight:700>float</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>i64</span>        <span style=color:#000;font-weight:700>:</span><span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>sfixed64</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>fixed64</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>double</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>                <span style=color:#000>encoded</span> <span style=color:#000>as</span> <span style=color:#0000cf;font-weight:700>8</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>byte</span> <span style=color:#000>little</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>endian</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>                <span style=color:#000>memcpy</span> <span style=color:#000>of</span> <span style=color:#000>the</span> <span style=color:#000>equivalent</span> <span style=color:#000>C</span> <span style=color:#000>types</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>u</span><span style=color:#a40000>?</span><span style=color:#000>int64_t</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>double</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>len</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>prefix</span> <span style=color:#000;font-weight:700>:</span><span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>size</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>message</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>string</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>bytes</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>packed</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>                <span style=color:#000>size</span> <span style=color:#000>encoded</span> <span style=color:#000>as</span> <span style=color:#000>int32</span> <span style=color:#000>varint</span>
</span></span><span style=display:flex><span><span style=color:#000>string</span>     <span style=color:#000;font-weight:700>:</span><span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>valid</span> <span style=color:#000>UTF</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>8</span> <span style=color:#000>string</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>e</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>g</span><span style=color:#ce5c00;font-weight:700>.</span> <span style=color:#000>ASCII</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87>max</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000>GB</span> <span style=color:#000>of</span> <span style=color:#000>bytes</span>
</span></span><span style=display:flex><span><span style=color:#000>bytes</span>      <span style=color:#000;font-weight:700>:</span><span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>any</span> <span style=color:#000>sequence</span> <span style=color:#000>of</span> <span style=color:#0000cf;font-weight:700>8</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>bit</span> <span style=color:#000>bytes</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87>max</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000>GB</span> <span style=color:#000>of</span> <span style=color:#000>bytes</span>
</span></span><span style=display:flex><span><span style=color:#000>packed</span>     <span style=color:#000;font-weight:700>:</span><span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>varint</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>i32</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>i64</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                <span style=color:#000>consecutive</span> <span style=color:#000>values</span> <span style=color:#000>of</span> <span style=color:#000>the</span> <span style=color:#000>type</span> <span style=color:#000>specified</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#a40000>`</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>proto</span><span style=color:#a40000>`</span>
</span></span></code></pre></div><p>See also the
<a href=https://github.com/protocolbuffers/protoscope/blob/main/language.txt>Protoscope Language Reference</a>.</p><h3 id=cheat-sheet-key>Key</h3><dl><dt><code>message := (tag value)*</code></dt><dd>A message is encoded as a sequence of zero or more pairs of tags and values.</dd><dt><code>tag := (field &lt;&lt; 3) bit-or wire_type</code></dt><dd>A tag is a combination of a <code>wire_type</code>, stored in the least significant
three bits, and the field number that is defined in the <code>.proto</code> file.</dd><dt><code>value := varint for wire_type == VARINT, ...</code></dt><dd>A value is stored differently depending on the <code>wire_type</code> specified in the
tag.</dd><dt><code>varint := int32 | int64 | uint32 | uint64 | bool | enum | sint32 | sint64</code></dt><dd>You can use varint to store any of the listed data types.</dd><dt><code>i32 := sfixed32 | fixed32 | float</code></dt><dd>You can use fixed32 to store any of the listed data types.</dd><dt><code>i64 := sfixed64 | fixed64 | double</code></dt><dd>You can use fixed64 to store any of the listed data types.</dd><dt><code>len-prefix := size (message | string | bytes | packed)</code></dt><dd>A length-prefixed value is stored as a length (encoded as a varint), and
then one of the listed data types.</dd><dt><code>string := valid UTF-8 string (e.g. ASCII)</code></dt><dd>As described, a string must use UTF-8 character encoding. A string cannot
exceed 2GB.</dd><dt><code>bytes := any sequence of 8-bit bytes</code></dt><dd>As described, bytes can store custom data types, up to 2GB in size.</dd><dt><code>packed := varint* | i32* | i64*</code></dt><dd>Use the <code>packed</code> data type when you are storing consecutive values of the
type described in the protocol definition. The tag is dropped for values
after the first, which amortizes the costs of tags to one per field, rather
than per element.</dd></dl></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow" aria-label="Stack Overflow"><a class=text-white target=_blank rel=noopener href=https://stackoverflow.com/questions/tagged/protocol-buffers aria-label="Stack Overflow"><i class="fab fa-stack-overflow"></i></a></li></ul><script type=text/javascript id=cookiebanner src=https://cdn.jsdelivr.net/gh/dobarkod/cookie-banner@1.2.2/dist/cookiebanner.min.js data-height=50px data-message="Protobuf.dev uses cookies from Google to deliver and enhance the quality of its services and to analyze traffic." data-bg=#ffb data-fg=#000 data-position=bottom data-padding="10px 16px" data-close-text="OK, got it" data-font-size=18px data-moreinfo=https://policies.google.com/technologies/cookies></script></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/protocolbuffers/protobuf aria-label=GitHub><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Developer mailing list" aria-label="Developer mailing list"><a class=text-white target=_blank rel=noopener href=https://groups.google.com/g/protobuf aria-label="Developer mailing list"><i class="fa fa-envelope"></i></a></li></ul><script type=text/javascript id=cookiebanner src=https://cdn.jsdelivr.net/gh/dobarkod/cookie-banner@1.2.2/dist/cookiebanner.min.js data-height=50px data-message="Protobuf.dev uses cookies from Google to deliver and enhance the quality of its services and to analyze traffic." data-bg=#ffb data-fg=#000 data-position=bottom data-padding="10px 16px" data-close-text="OK, got it" data-font-size=18px data-moreinfo=https://policies.google.com/technologies/cookies></script></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2025 Google LLC All Rights Reserved</small>
<small class=ml-1><a href=https://policies.google.com/privacy target=_blank rel=noopener>Privacy Policy</a></small>
<span class=text-white>Hosted by GitHub Pages.</span> <a href=https://docs.github.com/en/site-policy/privacy-policies/github-privacy-statement target=_blank>GitHub Privacy Statement</a></div></div></div></footer></div><script src=/js/main.min.c91cdfdcc1576ecc360abc6f1c3ca0485d047f65ac6d3203ec57ed29e0af808b.js integrity="sha256-yRzf3MFXbsw2CrxvHDygSF0Ef2WsbTID7FftKeCvgIs=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>