<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Language Guide (proto 2) | Protocol Buffers Documentation</title>
<meta name=description content="Covers how to use the proto2 revision of Protocol Buffers language in your project."><meta property="og:title" content="Language Guide (proto 2)"><meta property="og:description" content="Covers how to use the proto2 revision of Protocol Buffers language in your project."><meta property="og:type" content="article"><meta property="og:url" content="https://protobuf.dev/programming-guides/proto2/"><meta property="article:section" content="programming-guides"><meta itemprop=name content="Language Guide (proto 2)"><meta itemprop=description content="Covers how to use the proto2 revision of Protocol Buffers language in your project."><meta itemprop=wordCount content="12357"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Language Guide (proto 2)"><meta name=twitter:description content="Covers how to use the proto2 revision of Protocol Buffers language in your project."><link rel=preload href=/scss/main.min.54528691b89298d381d16410c181786ee86e839372e7753bca35f2eb614744cf.css as=style integrity="sha256-VFKGkbiSmNOB0WQQwYF4buhug5Ny53U7yjXy62FHRM8=" crossorigin=anonymous><link href=/scss/main.min.54528691b89298d381d16410c181786ee86e839372e7753bca35f2eb614744cf.css rel=stylesheet integrity="sha256-VFKGkbiSmNOB0WQQwYF4buhug5Ny53U7yjXy62FHRM8=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-5L8P8GRN4Y"></script><script>var doNotTrack=!1,dnt;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-5L8P8GRN4Y")}</script></head><body class=td-page><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>Protocol Buffers Documentation</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav></ul></div><div class="d-none d-lg-block"><div class=td-search><div class=td-search__icon></div><input type=search class="td-search__input form-control td-search-input" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><div class=td-search><div class=td-search__icon></div><input type=search class="td-search__input form-control td-search-input" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="td-sidebar-nav collapse td-sidebar-nav--search-disabled" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m--li><a href=/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-><span>Protocol Buffers</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-overview-li><a href=/overview/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-overview><span>Overview</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-installation-li><a href=/installation/ title="Protocol Buffer Compiler Installation" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-installation><span>Protoc Installation</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-news-li><a href=/news/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-news><span>News</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-programming-guides-li><a href=/programming-guides/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-programming-guides><span>Programming Guides</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guideseditions-li><a href=/programming-guides/editions/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guideseditions><span>Language Guide (editions)</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-programming-guidesproto2-li><a href=/programming-guides/proto2/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-programming-guidesproto2><span class=td-sidebar-nav-active-item>Language Guide (proto 2)</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesproto3-li><a href=/programming-guides/proto3/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesproto3><span>Language Guide (proto 3)</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesproto-limits-li><a href=/programming-guides/proto-limits/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesproto-limits><span>Proto Limits</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesstyle-li><a href=/programming-guides/style/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesstyle><span>Style Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesenum-li><a href=/programming-guides/enum/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesenum><span>Enum Behavior</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesencoding-li><a href=/programming-guides/encoding/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesencoding><span>Encoding</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesjson-li><a href=/programming-guides/json/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesjson><span>ProtoJSON Format</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidestechniques-li><a href=/programming-guides/techniques/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidestechniques><span>Techniques</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesaddons-li><a href=/programming-guides/addons/ title="Third-Party Add-ons" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesaddons><span>Add-ons</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesextension_declarations-li><a href=/programming-guides/extension_declarations/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesextension_declarations><span>Extension Declarations</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesfield_presence-li><a href=/programming-guides/field_presence/ title="Application Note: Field Presence" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesfield_presence><span>Field Presence</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesserialization-not-canonical-li><a href=/programming-guides/serialization-not-canonical/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesserialization-not-canonical><span>Proto Serialization Is Not Canonical</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-programming-guidesdeserialize-debug-li><a href=/programming-guides/deserialize-debug/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-programming-guidesdeserialize-debug><span>Deserializing Debug Proto Representations</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-editions-li><a href=/editions/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-editions><span>Protobuf Editions</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-editionsoverview-li><a href=/editions/overview/ title="Protobuf Editions Overview" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-editionsoverview><span>Overview</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-editionsfeatures-li><a href=/editions/features/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-editionsfeatures><span>Feature Settings for Editions</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-editionsimplementation-li><a href=/editions/implementation/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-editionsimplementation><span>Implementing Editions Support</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-design-decisions-li><a href=/design-decisions/ title="Protobuf Team Design Decisions" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-design-decisions><span>Design Decisions</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-design-decisionsnullable-getters-setters-li><a href=/design-decisions/nullable-getters-setters/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-design-decisionsnullable-getters-setters><span>No Nullable Setters/Getters Support</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-best-practices-li><a href=/best-practices/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-best-practices><span>Proto Best Practices</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-best-practicesno-cargo-cults-li><a href=/best-practices/no-cargo-cults/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-best-practicesno-cargo-cults><span>Avoid Cargo Culting</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-best-practicesdos-donts-li><a href=/best-practices/dos-donts/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-best-practicesdos-donts><span>Proto Best Practices</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-best-practicesapi-li><a href=/best-practices/api/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-best-practicesapi><span>API Best Practices</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-best-practices1-1-1-li><a href=/best-practices/1-1-1/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-best-practices1-1-1><span>1-1-1 Best Practice</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-getting-started-li><a href=/getting-started/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-getting-started><span>Tutorials</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedcpptutorial-li><a href=/getting-started/cpptutorial/ title="Protocol Buffer Basics: C++" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedcpptutorial><span>C++</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedcsharptutorial-li><a href=/getting-started/csharptutorial/ title="Protocol Buffer Basics: C#" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedcsharptutorial><span>C#</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-starteddarttutorial-li><a href=/getting-started/darttutorial/ title="Protocol Buffer Basics: Dart" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-getting-starteddarttutorial><span>Dart</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedgotutorial-li><a href=/getting-started/gotutorial/ title="Protocol Buffer Basics: Go" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedgotutorial><span>Go</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedjavatutorial-li><a href=/getting-started/javatutorial/ title="Protocol Buffer Basics: Java" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedjavatutorial><span>Java</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedkotlintutorial-li><a href=/getting-started/kotlintutorial/ title="Protocol Buffer Basics: Kotlin" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedkotlintutorial><span>Kotlin</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-getting-startedpythontutorial-li><a href=/getting-started/pythontutorial/ title="Protocol Buffer Basics: Python" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-getting-startedpythontutorial><span>Python</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-reference-li><a href=/reference/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-reference><span>Reference Guides</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencecpp-li><a href=/reference/cpp/ title="C++ Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referencecpp><span>C++</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecppcpp-generated-li><a href=/reference/cpp/cpp-generated/ title="C++ Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencecppcpp-generated><span>Generated Code Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecppstring-view-li><a href=/reference/cpp/string-view/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencecppstring-view><span>String View APIs</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecpparenas-li><a href=/reference/cpp/arenas/ title="C++ Arena Allocation Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencecpparenas><span>Arena Allocation Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecppabseil-li><a href=/reference/cpp/abseil/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencecppabseil><span>Abseil Support</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecppapi-docs-link-li><a href=/reference/cpp/api-docs/ target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencecppapi-docs-link><span>C++ API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencecsharp-li><a href=/reference/csharp/ title="C# Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referencecsharp><span>C#</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecsharpcsharp-generated-li><a href=/reference/csharp/csharp-generated/ title="C# Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencecsharpcsharp-generated><span>Generated Code Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencecsharpapi-docs-link-li><a href=/reference/csharp/api-docs target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencecsharpapi-docs-link><span>C# API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencedart-li><a href=/reference/dart/ title="Dart Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referencedart><span>Dart</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencedartdart-generated-li><a href=/reference/dart/dart-generated/ title="Dart Generated Code" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencedartdart-generated><span>Generated Code</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencedartapi-docs-link-li><a href=https://pub.dartlang.org/documentation/protobuf target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencedartapi-docs-link><span>Dart API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencego-li><a href=/reference/go/ title="Go Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referencego><span>Go</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencegogo-generated-li><a href=/reference/go/go-generated/ title="Go Generated Code Guide (Open)" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencegogo-generated><span>Generated Code Guide (Open)</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencegogo-generated-opaque-li><a href=/reference/go/go-generated-opaque/ title="Go Generated Code Guide (Opaque)" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencegogo-generated-opaque><span>Generated Code Guide (Opaque)</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencegofaq-li><a href=/reference/go/faq/ title="Go FAQ" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencegofaq><span>FAQ</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencegosize-li><a href=/reference/go/size/ title="Go Size Semantics" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencegosize><span>Size Semantics</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencegoapi-docs-link-li><a href=https://pkg.go.dev/google.golang.org/protobuf/proto target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencegoapi-docs-link><span>Go API</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencegoopaque-migration-li><a href=/reference/go/opaque-migration/ title="Go Opaque API Migration" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencegoopaque-migration><span>Opaque API Migration</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencegoopaque-migration-manual-li><a href=/reference/go/opaque-migration-manual/ title="Go Opaque API: Manual Migration" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencegoopaque-migration-manual><span>Opaque API: Manual Migration</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencegoopaque-faq-li><a href=/reference/go/opaque-faq/ title="Go Opaque API FAQ" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencegoopaque-faq><span>Opaque API FAQ</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencejava-li><a href=/reference/java/ title="Java Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referencejava><span>Java</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencejavajava-generated-li><a href=/reference/java/java-generated/ title="Java Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencejavajava-generated><span>Generated Code Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencejavajava-proto-names-li><a href=/reference/java/java-proto-names/ title="Java Proto Names" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencejavajava-proto-names><span>Generated Proto Names</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencejavaapi-docs-link-li><a href=/reference/java/api-docs/overview-summary.html target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencejavaapi-docs-link><span>Java API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencekotlin-li><a href=/reference/kotlin/ title="Kotlin Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referencekotlin><span>Kotlin</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencekotlinapi-docs-li><a href=/reference/kotlin/api-docs/ title="Kotlin Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referencekotlinapi-docs><span>Kotlin</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencekotlinkotlin-generated-li><a href=/reference/kotlin/kotlin-generated/ title="Kotlin Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencekotlinkotlin-generated><span>Generated Code Guide</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referenceobjective-c-li><a href=/reference/objective-c/ title="Objective-C Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referenceobjective-c><span>Objective-C</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceobjective-cobjective-c-generated-li><a href=/reference/objective-c/objective-c-generated/ title="Objective-C Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referenceobjective-cobjective-c-generated><span>Generated Code Guide</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencephp-li><a href=/reference/php/ title="PHP Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referencephp><span>PHP</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencephpphp-generated-li><a href=/reference/php/php-generated/ title="PHP Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencephpphp-generated><span>Generated Code Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencephpapi-docs-link-li><a href=/reference/php/api-docs/ target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencephpapi-docs-link><span>PHP API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referencepython-li><a href=/reference/python/ title="Python Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referencepython><span>Python</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencepythonpython-generated-li><a href=/reference/python/python-generated/ title="Python Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencepythonpython-generated><span>Generated Code Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencepythonapi-docs-link-li><a href=https://googleapis.dev/python/protobuf/latest/ target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencepythonapi-docs-link><span>Python API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referenceruby-li><a href=/reference/ruby/ title="Ruby Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referenceruby><span>Ruby</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referencerubyruby-generated-li><a href=/reference/ruby/ruby-generated/ title="Ruby Generated Code Guide" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referencerubyruby-generated><span>Generated Code Guide</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-referenceprotobuf-li><a href=/reference/protobuf/ title="Protocol Buffers Reference" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-referenceprotobuf><span>Protocol Buffers</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceprotobufedition-2023-spec-li><a href=/reference/protobuf/edition-2023-spec/ title="Protocol Buffers Edition 2023 Language Specification" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referenceprotobufedition-2023-spec><span>2023 Language Specification</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceprotobufproto2-spec-li><a href=/reference/protobuf/proto2-spec/ title="Protocol Buffers Version 2 Language Specification" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referenceprotobufproto2-spec><span>Version 2 Language Specification</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceprotobufproto3-spec-li><a href=/reference/protobuf/proto3-spec/ title="Protocol Buffers Version 3 Language Specification" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referenceprotobufproto3-spec><span>Version 3 Language Specification</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceprotobuftextformat-spec-li><a href=/reference/protobuf/textformat-spec/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referenceprotobuftextformat-spec><span>Text Format Language Specification</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceprotobufgoogleprotobuf-li><a href=/reference/protobuf/google.protobuf/ title="Protocol Buffers Well-Known Types" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referenceprotobufgoogleprotobuf><span>Well-Known Types</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-referenceother-li><a href=/reference/other/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-referenceother><span>Other Languages</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-support-li><a href=/support/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-support><span>Support</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-supportversion-support-li><a href=/support/version-support/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-supportversion-support><span>Version Support</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-supportmigration-li><a href=/support/migration/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-supportmigration><span>Migration Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-supportcross-version-runtime-guarantee-li><a href=/support/cross-version-runtime-guarantee/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-supportcross-version-runtime-guarantee><span>Cross-Version Runtime Guarantee</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-downloads-li><a href=/downloads/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-downloads><span>Downloads</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-history-li><a href=/history/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-history><span>History</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-forum-link-li><a href=https://groups.google.com/g/protobuf target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-forum-link><span>Forum</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-navbar-li><a href=/navbar/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-navbar><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-search-li><a href=/search/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-search><span>Search Results</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/protocolbuffers/protocolbuffers.github.io/tree/main/content/programming-guides/proto2.md class=td-page-meta--view target=_blank rel=noopener><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
<a href=https://github.com/protocolbuffers/protocolbuffers.github.io/edit/main/content/programming-guides/proto2.md class=td-page-meta--edit target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
<a href="https://github.com/protocolbuffers/protocolbuffers.github.io/new/main/content/programming-guides/proto2.md?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class=td-page-meta--child target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
<a href="https://github.com/protocolbuffers/protocolbuffers.github.io/issues/new?title=Language%20Guide%20%28proto%202%29" class=td-page-meta--issue target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create documentation issue</a>
<a href=https://github.com/protocolbuffers/protobuf/issues/new class=td-page-meta--project-issue target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create project issue</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#simple>Defining A Message Type</a><ul><li><a href=#specifying-types>Specifying Field Types</a></li><li><a href=#assigning>Assigning Field Numbers</a></li><li><a href=#field-labels>Specifying Field Cardinality</a></li><li><a href=#adding-types>Adding More Message Types</a></li><li><a href=#adding-comments>Adding Comments</a></li><li><a href=#deleting>Deleting Fields</a></li><li><a href=#generated>What&rsquo;s Generated from Your <code>.proto</code>?</a></li></ul></li><li><a href=#scalar>Scalar Value Types</a></li><li><a href=#default>Default Field Values</a><ul><li><a href=#explicit-default>Overriding Default Scalar Values</a></li></ul></li><li><a href=#enum>Enumerations</a><ul><li><a href=#enum-default>Enum Default Value</a></li><li><a href=#enum-aliases>Enum Value Aliases</a></li><li><a href=#reserved>Reserved Values</a></li></ul></li><li><a href=#other>Using Other Message Types</a><ul><li><a href=#importing>Importing Definitions</a></li><li><a href=#proto3>Using proto3 Message Types</a></li></ul></li><li><a href=#nested>Nested Types</a><ul><li><a href=#groups>Groups</a></li></ul></li><li><a href=#updating>Updating a Message Type</a></li><li><a href=#unknowns>Unknown Fields</a><ul><li><a href=#retaining>Retaining Unknown Fields</a></li></ul></li><li><a href=#extensions>Extensions</a><ul><li><a href=#why-ext>Why Use Extensions?</a></li><li><a href=#ext-example>Example Extension</a></li><li><a href=#defining-ranges>Defining Extension Ranges</a></li><li><a href=#choosing>Choosing Extension Numbers</a></li><li><a href=#specifying-extension-types>Specifying Extension Types</a></li><li><a href=#nested-exts>Nested Extensions (not recommended)</a></li></ul></li><li><a href=#any>Any</a></li><li><a href=#oneof>Oneof</a><ul><li><a href=#using-oneof>Using Oneof</a></li><li><a href=#oneof-features>Oneof Features</a></li><li><a href=#backward>Backwards-compatibility issues</a></li></ul></li><li><a href=#maps>Maps</a><ul><li><a href=#maps-features>Maps Features</a></li><li><a href=#backwards>Backwards Compatibility</a></li></ul></li><li><a href=#packages>Packages</a><ul><li><a href=#name-resolution>Packages and Name Resolution</a></li></ul></li><li><a href=#services>Defining Services</a></li><li><a href=#json>JSON Mapping</a></li><li><a href=#options>Options</a><ul><li><a href=#enum-value-options>Enum Value Options</a></li><li><a href=#customoptions>Custom Options</a></li><li><a href=#option-retention>Option Retention</a></li><li><a href=#option-targets>Option Targets</a></li></ul></li><li><a href=#generating>Generating Your Classes</a></li><li><a href=#location>File location</a><ul><li><a href=#location-language-agnostic>Location Should be Language-agnostic</a></li></ul></li><li><a href=#platforms>Supported Platforms</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=/programming-guides/>Programming Guides</a></li><li class="breadcrumb-item active" aria-current=page>Language Guide (proto 2)</li></ol></nav><div class=td-content><h1>Language Guide (proto 2)</h1><div class=lead>Covers how to use the proto2 revision of Protocol Buffers language in your project.</div><header class=article-meta></header><p>This guide describes how to use the protocol buffer language to structure your
protocol buffer data, including <code>.proto</code> file syntax and how to generate data
access classes from your <code>.proto</code> files. It covers the <strong>proto2</strong> revision of
the protocol buffers language.</p><p>For information on <strong>editions</strong> syntax, see the
<a href=/programming-guides/editions>Protobuf Editions Language Guide</a>.</p><p>For information on <strong>proto3</strong> syntax, see the
<a href=/programming-guides/proto3>Proto3 Language Guide</a>.</p><p>This is a reference guide – for a step by step example that uses many of the
features described in this document, see the
<a href=/getting-started>tutorial</a>
for your chosen language.</p><h2 id=simple>Defining A Message Type</h2><p>First let&rsquo;s look at a very simple example. Let&rsquo;s say you want to define a search
request message format, where each search request has a query string, the
particular page of results you are interested in, and a number of results per
page. Here&rsquo;s the <code>.proto</code> file you use to define the message type.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#000>syntax</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;proto2&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>SearchRequest</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>query</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>page_number</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>results_per_page</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><ul><li><p>The first line of the file specifies that you&rsquo;re using the proto2 revision
of the protobuf language spec.</p><ul><li>The <code>syntax</code> must be the first non-empty, non-comment line of the file.</li><li>If no <code>syntax</code> is specified, the protocol buffer compiler will assume
you are using proto2.</li></ul></li><li><p>The <code>SearchRequest</code> message definition specifies three fields (name/value
pairs), one for each piece of data that you want to include in this type of
message. Each field has a name and a type.</p></li></ul><h3 id=specifying-types>Specifying Field Types</h3><p>In the earlier example, all the fields are <a href=#scalar>scalar types</a>: two integers
(<code>page_number</code> and <code>results_per_page</code>) and a string (<code>query</code>). You can also
specify <a href=#enum>enumerations</a> and composite types like other message types for
your field.</p><h3 id=assigning>Assigning Field Numbers</h3><p>You must give each field in your message definition a number between <code>1</code> and
<code>536,870,911</code> with the following restrictions:</p><ul><li>The given number <strong>must be unique</strong> among all fields for that message.</li><li>Field numbers <code>19,000</code> to <code>19,999</code> are reserved for the Protocol Buffers
implementation. The protocol buffer compiler will complain if you use one of
these reserved field numbers in your message.</li><li>You cannot use any previously <a href=#fieldreserved>reserved</a> field numbers or
any field numbers that have been allocated to <a href=#extensions>extensions</a>.</li></ul><p>This number <strong>cannot be changed once your message type is in use</strong> because it
identifies the field in the
<a href=/programming-guides/encoding>message wire format</a>.
&ldquo;Changing&rdquo; a field number is equivalent to deleting that field and creating a
new field with the same type but a new number. See <a href=#deleting>Deleting Fields</a>
for how to do this properly.</p><p>Field numbers <strong>should never be reused</strong>. Never take a field number out of the
<a href=#fieldreserved>reserved</a> list for reuse with a new field definition. See
<a href=#consequences>Consequences of Reusing Field Numbers</a>.</p><p>You should use the field numbers 1 through 15 for the most-frequently-set
fields. Lower field number values take less space in the wire format. For
example, field numbers in the range 1 through 15 take one byte to encode. Field
numbers in the range 16 through 2047 take two bytes. You can find out more about
this in
<a href=/programming-guides/encoding#structure>Protocol Buffer Encoding</a>.</p><h4 id=consequences>Consequences of Reusing Field Numbers</h4><p>Reusing a field number makes decoding wire-format messages ambiguous.</p><p>The protobuf wire format is lean and doesn&rsquo;t provide a way to detect fields
encoded using one definition and decoded using another.</p><p>Encoding a field using one definition and then decoding that same field with a
different definition can lead to:</p><ul><li>Developer time lost to debugging</li><li>A parse/merge error (best case scenario)</li><li>Leaked PII/SPII</li><li>Data corruption</li></ul><p>Common causes of field number reuse:</p><ul><li><p>renumbering fields (sometimes done to achieve a more aesthetically pleasing
number order for fields). Renumbering effectively deletes and re-adds all
the fields involved in the renumbering, resulting in incompatible
wire-format changes.</p></li><li><p>deleting a field and not <a href=#fieldreserved>reserving</a> the number to prevent
future reuse.</p><ul><li>This has been a very easy mistake to make with
<a href=#extensions>extension fields</a> for several reasons.
<a href=/programming-guides/extension_declarations>Extension Declarations</a>
provide a mechanism for reserving extension fields.</li></ul></li></ul><p>The field number is limited to 29 bits rather than 32 bits because three bits
are used to specify the field&rsquo;s wire format. For more on this, see the
<a href=/programming-guides/encoding#structure>Encoding topic</a>.</p><p><a id=specifying-rules></a></p><h3 id=field-labels>Specifying Field Cardinality</h3><p>Message fields can be one of the following:</p><ul><li><p><em>Singular</em>:</p><p>In proto2, there are two types of singular fields:</p><ul><li><p><code>optional</code>: (recommended) An <code>optional</code> field is in one of two possible
states:</p><ul><li>the field is set, and contains a value that was explicitly set or
parsed from the wire. It will be serialized to the wire.</li><li>the field is unset, and will return the default value. It will not
be serialized to the wire.</li></ul><p>You can check to see if the value was explicitly set.</p></li><li><p><code>required</code>: <strong>Do not use.</strong> Required fields are so problematic they were
removed from proto3 and editions. Semantics for required field should be
implemented at the application layer.
When it <em>is</em> used, a
well-formed message must have exactly one of this field.</p></li></ul></li><li><p><code>repeated</code>: this field type can be repeated zero or more times in a
well-formed message. The order of the repeated values will be preserved.</p></li><li><p><code>map</code>: this is a paired key/value field type. See
<a href=/programming-guides/encoding#maps>Maps</a> for more on
this field type.</p></li></ul><h4 id=use-packed>Use Packed Encoding for New Repeated Fields</h4><p>For historical reasons, <code>repeated</code> fields of scalar numeric types (for example,
<code>int32</code>, <code>int64</code>, <code>enum</code>) aren&rsquo;t encoded as efficiently as they could be. New
code should use the special option <code>[packed = true]</code> to get a more efficient
encoding. For example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>samples</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>4</span> <span style=color:#000;font-weight:700>[</span><span style=color:#204a87;font-weight:700>packed</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>ProtoEnum</span> <span style=color:#000>results</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>5</span> <span style=color:#000;font-weight:700>[</span><span style=color:#204a87;font-weight:700>packed</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>You can find out more about <code>packed</code> encoding in
<a href=/programming-guides/encoding#packed>Protocol Buffer Encoding</a>.</p><h4 id=required-deprecated>Required is Strongly Deprecated</h4><div class="alert alert-warning" role=alert><h4 class=alert-heading>Important</h4><strong>Required Is Forever</strong>
As mentioned earlier <strong><code>required</code> must not be used for new fields</strong>. Semantics
for required fields should be implemented at the application layer instead.
Existing <code>required</code> fields should be treated as permanent, immutable elements of
the message definition. It is nearly impossible to safely change a field from
<code>required</code> to <code>optional</code>. If there is any chance that a stale reader exists, it
will consider messages without this field to be incomplete and may reject or
drop them.</div><p>A second issue with required fields appears when someone adds a value to an
enum. In this case, the unrecognized enum value is treated as if it were
missing, which also causes the required value check to fail.</p><h4 id=well-formed>Well-formed Messages</h4><p>The term &ldquo;well-formed,&rdquo; when applied to protobuf messages, refers to the bytes
serialized/deserialized. The protoc parser validates that a given proto
definition file is parseable.</p><p>Singular fields can appear more than once in wire-format bytes. The parser will
accept the input, but only the last instance of that field will be accessible
through the generated bindings. See
<a href=/programming-guides/encoding#last-one-wins>Last One Wins</a>
for more on this topic.</p><h3 id=adding-types>Adding More Message Types</h3><p>Multiple message types can be defined in a single <code>.proto</code> file. This is useful
if you are defining multiple related messages – so, for example, if you wanted
to define the reply message format that corresponds to your <code>SearchResponse</code>
message type, you could add it to the same <code>.proto</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>SearchRequest</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>query</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>page_number</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>results_per_page</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>SearchResponse</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span> <span style=color:#ce5c00;font-weight:700>...</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p><strong>Combining Messages leads to bloat</strong> While multiple message types (such as
message, enum, and service) can be defined in a single <code>.proto</code> file, it can
also lead to dependency bloat when large numbers of messages with varying
dependencies are defined in a single file. It&rsquo;s recommended to include as few
message types per <code>.proto</code> file as possible.</p><h3 id=adding-comments>Adding Comments</h3><p>To add comments to your <code>.proto</code> files:</p><ul><li><p>Prefer C/C++/Java line-end-style comments &lsquo;//&rsquo; on the line before the .proto
code element</p></li><li><p>C-style inline/multi-line comments <code>/* ... */</code> are also accepted.</p><ul><li>When using multi-line comments, a margin line of &lsquo;*&rsquo; is preferred.</li></ul></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#8f5902;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic> * SearchRequest represents a search query, with pagination options to
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic> * indicate which results to include in the response.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic> */</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>SearchRequest</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>query</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Which page number do we want?
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>page_number</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Number of results to return per page.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>results_per_page</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><h3 id=deleting>Deleting Fields</h3><p>Deleting fields can cause serious problems if not done properly.</p><p><strong>Do not delete</strong> <code>required</code> fields. This is almost impossible to do safely. If
you must delete a <code>required</code> field, you should first mark the field <code>optional</code>
and <code>deprecated</code> and ensure that all systems which in any way observe the
message have been deployed with the new schema. Then you can consider removing
the field (but note that this is still an error-prone process).</p><p>When you no longer need a field that is not <code>required</code>, first delete all
references to the field from client code, and then delete the field definition
from the message. However, you <strong>must</strong>
<a href=#fieldreserved>reserve the deleted field number</a>. If you do not reserve the
field number, it is possible for a developer to reuse that number in the future
and cause a breakage.</p><p>You should also reserve the field name to allow JSON and TextFormat encodings of
your message to continue to parse.</p><p><a id=fieldreserved></a></p><h4 id=reserved-field-numbers>Reserved Field Numbers</h4><p>If you <a href=#updating>update</a> a message type by entirely deleting a field, or
commenting it out, future developers can reuse the field number when making
their own updates to the type. This can cause severe issues, as described in
<a href=#consequences>Consequences of Reusing Field Numbers</a>. To make sure this
doesn&rsquo;t happen, add your deleted field number to the <code>reserved</code> list.</p><p>The protoc compiler will generate error messages if any future developers try to
use these reserved field numbers.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>reserved</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>15</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>9</span> <span style=color:#204a87;font-weight:700>to</span> <span style=color:#0000cf;font-weight:700>11</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>Reserved field number ranges are inclusive (<code>9 to 11</code> is the same as <code>9, 10, 11</code>).</p><h4 id=reserved-field-names>Reserved Field Names</h4><p>Reusing an old field name later is generally safe, except when using TextProto
or JSON encodings where the field name is serialized. To avoid this risk, you
can add the deleted field name to the <code>reserved</code> list.</p><p>Reserved names affect only the protoc compiler behavior and not runtime
behavior, with one exception: TextProto implementations may discard unknown
fields (without raising an error like with other unknown fields) with reserved
names at parse time (only the C++ and Go implementations do so today). Runtime
JSON parsing is not affected by reserved names.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>reserved</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>15</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>9</span> <span style=color:#204a87;font-weight:700>to</span> <span style=color:#0000cf;font-weight:700>11</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>reserved</span> <span style=color:#4e9a06>&#34;foo&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;bar&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>Note that you can&rsquo;t mix field names and field numbers in the same <code>reserved</code>
statement.</p><h3 id=generated>What&rsquo;s Generated from Your <code>.proto</code>?</h3><p>When you run the <a href=#generating>protocol buffer compiler</a> on a <code>.proto</code>, the
compiler generates the code in your chosen language you&rsquo;ll need to work with the
message types you&rsquo;ve described in the file, including getting and setting field
values, serializing your messages to an output stream, and parsing your messages
from an input stream.</p><ul><li>For <strong>C++</strong>, the compiler generates a <code>.h</code> and <code>.cc</code> file from each
<code>.proto</code>, with a class for each message type described in your file.</li><li>For <strong>Java</strong>, the compiler generates a <code>.java</code> file with a class for each
message type, as well as a special <code>Builder</code> class for creating message
class instances.</li><li>For <strong>Kotlin</strong>, in addition to the Java generated code, the compiler
generates a <code>.kt</code> file for each message type with an improved Kotlin API.
This includes a DSL that simplifies creating message instances, a nullable
field accessor, and a copy function.</li><li><strong>Python</strong> is a little different — the Python compiler generates a module
with a static descriptor of each message type in your <code>.proto</code>, which is
then used with a <em>metaclass</em> to create the necessary Python data access
class at runtime.</li><li>For <strong>Go</strong>, the compiler generates a <code>.pb.go</code> file with a type for each
message type in your file.</li><li>For <strong>Ruby</strong>, the compiler generates a <code>.rb</code> file with a Ruby module
containing your message types.</li><li>For <strong>Objective-C</strong>, the compiler generates a <code>pbobjc.h</code> and <code>pbobjc.m</code> file
from each <code>.proto</code>, with a class for each message type described in your
file.</li><li>For <strong>C#</strong>, the compiler generates a <code>.cs</code> file from each <code>.proto</code>, with a
class for each message type described in your file.</li><li>For <strong>PHP</strong>, the compiler generates a <code>.php</code> message file for each message
type described in your file, and a <code>.php</code> metadata file for each <code>.proto</code>
file you compile. The metadata file is used to load the valid message types
into the descriptor pool.</li><li>For <strong>Dart</strong>, the compiler generates a <code>.pb.dart</code> file with a class for each
message type in your file.</li></ul><p>You can find out more about using the APIs for each language by following the
tutorial for your chosen language. For even more API
details, see the relevant <a href=/reference/>API reference</a>.</p><h2 id=scalar>Scalar Value Types</h2><p>A scalar message field can have one of the following types – the table shows the
type specified in the <code>.proto</code> file, and the corresponding type in the
automatically generated class:</p><div><table><tbody><tr><th>Proto Type</th><th>Notes</th></tr><tr><td>double</td><td></td></tr><tr><td>float</td><td></td></tr><tr><td>int32</td><td>Uses variable-length encoding. Inefficient for encoding negative
numbers – if your field is likely to have negative values, use sint32
instead.</td></tr><tr><td>int64</td><td>Uses variable-length encoding. Inefficient for encoding negative
numbers – if your field is likely to have negative values, use sint64
instead.</td></tr><tr><td>uint32</td><td>Uses variable-length encoding.</td></tr><tr><td>uint64</td><td>Uses variable-length encoding.</td></tr><tr><td>sint32</td><td>Uses variable-length encoding. Signed int value. These more
efficiently encode negative numbers than regular int32s.</td></tr><tr><td>sint64</td><td>Uses variable-length encoding. Signed int value. These more
efficiently encode negative numbers than regular int64s.</td></tr><tr><td>fixed32</td><td>Always four bytes. More efficient than uint32 if values are often
greater than 2<sup>28</sup>.</td></tr><tr><td>fixed64</td><td>Always eight bytes. More efficient than uint64 if values are often
greater than 2<sup>56</sup>.</td></tr><tr><td>sfixed32</td><td>Always four bytes.</td></tr><tr><td>sfixed64</td><td>Always eight bytes.</td></tr><tr><td>bool</td><td></td></tr><tr><td>string</td><td>A string must always contain UTF-8 encoded or 7-bit ASCII text, and cannot
be longer than 2<sup>32</sup>.</td></tr><tr><td>bytes</td><td>May contain any arbitrary sequence of bytes no longer than 2<sup>32</sup>.</td></tr></tbody></table></div><div><table style=width:100%;overflow-x:scroll><tbody><tr><th>Proto Type</th><th>C++ Type</th><th>Java/Kotlin Type<sup>[1]</sup></th><th>Python Type<sup>[3]</sup></th><th>Go Type</th><th>Ruby Type</th><th>C# Type</th><th>PHP Type</th><th>Dart Type</th><th>Rust Type</th></tr><tr><td>double</td><td>double</td><td>double</td><td>float</td><td>*float64</td><td>Float</td><td>double</td><td>float</td><td>double</td><td>f64</td></tr><tr><td>float</td><td>float</td><td>float</td><td>float</td><td>*float32</td><td>Float</td><td>float</td><td>float</td><td>double</td><td>f32</td></tr><tr><td>int32</td><td>int32_t</td><td>int</td><td>int</td><td>int32</td><td>Fixnum or Bignum (as required)</td><td>int</td><td>integer</td><td>*int32</td><td>i32</td></tr><tr><td>int64</td><td>int64_t</td><td>long</td><td>int/long<sup>[4]</sup></td><td>*int64</td><td>Bignum</td><td>long</td><td>integer/string<sup>[6]</sup></td><td>Int64</td><td>i64</td></tr><tr><td>uint32</td><td>uint32_t</td><td>int<sup>[2]</sup></td><td>int/long<sup>[4]</sup></td><td>*uint32</td><td>Fixnum or Bignum (as required)</td><td>uint</td><td>integer</td><td>int</td><td>u32</td></tr><tr><td>uint64</td><td>uint64_t</td><td>long<sup>[2]</sup></td><td>int/long<sup>[4]</sup></td><td>*uint64</td><td>Bignum</td><td>ulong</td><td>integer/string<sup>[6]</sup></td><td>Int64</td><td>u64</td></tr><tr><td>sint32</td><td>int32_t</td><td>int</td><td>int</td><td>int32</td><td>Fixnum or Bignum (as required)</td><td>int</td><td>integer</td><td>*int32</td><td>i32</td></tr><tr><td>sint64</td><td>int64_t</td><td>long</td><td>int/long<sup>[4]</sup></td><td>*int64</td><td>Bignum</td><td>long</td><td>integer/string<sup>[6]</sup></td><td>Int64</td><td>i64</td></tr><tr><td>fixed32</td><td>uint32_t</td><td>int<sup>[2]</sup></td><td>int/long<sup>[4]</sup></td><td>*uint32</td><td>Fixnum or Bignum (as required)</td><td>uint</td><td>integer</td><td>int</td><td>u32</td></tr><tr><td>fixed64</td><td>uint64_t</td><td>long<sup>[2]</sup></td><td>int/long<sup>[4]</sup></td><td>*uint64</td><td>Bignum</td><td>ulong</td><td>integer/string<sup>[6]</sup></td><td>Int64</td><td>u64</td></tr><tr><td>sfixed32</td><td>int32_t</td><td>int</td><td>int</td><td>*int32</td><td>Fixnum or Bignum (as required)</td><td>int</td><td>integer</td><td>int</td><td>i32</td></tr><tr><td>sfixed64</td><td>int64_t</td><td>long</td><td>int/long<sup>[4]</sup></td><td>*int64</td><td>Bignum</td><td>long</td><td>integer/string<sup>[6]</sup></td><td>Int64</td><td>i64</td></tr><tr><td>bool</td><td>bool</td><td>boolean</td><td>bool</td><td>*bool</td><td>TrueClass/FalseClass</td><td>bool</td><td>boolean</td><td>bool</td><td>bool</td></tr><tr><td>string</td><td>string</td><td>String</td><td>unicode (Python 2), str (Python 3)</td><td>*string</td><td>String (UTF-8)</td><td>string</td><td>string</td><td>String</td><td>ProtoString</td></tr><tr><td>bytes</td><td>string</td><td>ByteString</td><td>bytes</td><td>[]byte</td><td>String (ASCII-8BIT)</td><td>ByteString</td><td>string</td><td>List<int></td><td>ProtoBytes</td></tr></tbody></table></div><p><sup>[1]</sup> Kotlin uses the corresponding types from Java, even for unsigned
types, to ensure compatibility in mixed Java/Kotlin codebases.</p><p><sup>[2]</sup> In Java, unsigned 32-bit and 64-bit integers are represented
using their signed counterparts, with the top bit simply being stored in the
sign bit.</p><p><sup>[3]</sup> In all cases, setting values to a field will perform type
checking to make sure it is valid.</p><p><sup>[4]</sup> 64-bit or unsigned 32-bit integers are always represented as long
when decoded, but can be an int if an int is given when setting the field. In
all cases, the value must fit in the type represented when set. See [2].</p><p><sup>[5]</sup> Proto2 typically doesn&rsquo;t ever check the UTF-8 validity of string
fields. Behavior varies between languages though, and invalid UTF-8 data should
not be stored in string fields.</p><p><sup>[6]</sup> Integer is used on 64-bit machines and string is used on 32-bit
machines.</p><p>You can find out more about how these types are encoded when you serialize your
message in
<a href=/programming-guides/encoding>Protocol Buffer Encoding</a>.</p><h2 id=default>Default Field Values</h2><p>When a message is parsed, if the encoded message bytes do not contain a
particular field, accessing that field in the parsed object returns the default
value for that field. The default values are type-specific:</p><ul><li>For strings, the default value is the empty string.</li><li>For bytes, the default value is empty bytes.</li><li>For bools, the default value is false.</li><li>For numeric types, the default value is zero.</li><li>For message fields, the field is not set. Its exact value is
language-dependent. See the
<a href=/reference/>generated code guide</a> for your language
for details.</li><li>For enums, the default value is the <strong>first defined enum value</strong>, which
should be 0 (recommended for compatibility with open enums). See
<a href=#enum-default>Enum Default Value</a>.</li></ul><p>The default value for repeated fields is empty (generally an empty list in the
appropriate language).</p><p>The default value for map fields is empty (generally an empty map in the
appropriate language).</p><h3 id=explicit-default>Overriding Default Scalar Values</h3><p>In proto2, you can specify explicit default values for singular non-message
fields. For example, let&rsquo;s say you want to provide a default value of 10 for the
<code>SearchRequest.results_per_page</code> field:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>results_per_page</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span> <span style=color:#000;font-weight:700>[</span><span style=color:#204a87;font-weight:700>default</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>If the sender does not specify <code>results_per_page</code>, the receiver will observe the
following state:</p><ul><li>The <code>results_per_page</code> field is not present. That is, the
<code>has_results_per_page()</code> (hazzer method) method would return <code>false</code>.</li><li>The value of <code>results_per_page</code> (returned from the &ldquo;getter&rdquo;) is <code>10</code>.</li></ul><p>If the sender does send a value for <code>results_per_page</code> the default value of 10
is ignored and the sender&rsquo;s value is returned from the &ldquo;getter&rdquo;.</p><p>See the <a href=/reference/>generated code guide</a> for your
chosen language for more details about how defaults work in generated code.</p><p>Because the default value for enums is the first defined enum value, take care
when adding a value to the beginning of an enum value list. See the
<a href=#updating>Updating a Message Type</a> section for guidelines on how to safely
change definitions.</p><h2 id=enum>Enumerations</h2><p>When you&rsquo;re defining a message type, you might want one of its fields to only
have one of a predefined list of values. For example, let&rsquo;s say you want to add
a <code>corpus</code> field for each <code>SearchRequest</code>, where the corpus can be <code>UNIVERSAL</code>,
<code>WEB</code>, <code>IMAGES</code>, <code>LOCAL</code>, <code>NEWS</code>, <code>PRODUCTS</code> or <code>VIDEO</code>. You can do this very
simply by adding an <code>enum</code> to your message definition with a constant for each
possible value.</p><p>In the following example we&rsquo;ve added an <code>enum</code> called <code>Corpus</code> with all the
possible values, and a field of type <code>Corpus</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>Corpus</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>CORPUS_UNSPECIFIED</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>CORPUS_UNIVERSAL</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>CORPUS_WEB</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>CORPUS_IMAGES</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>CORPUS_LOCAL</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>CORPUS_NEWS</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>CORPUS_PRODUCTS</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>6</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>CORPUS_VIDEO</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>7</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>SearchRequest</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>query</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>page_number</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>results_per_page</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>Corpus</span> <span style=color:#000>corpus</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><h3 id=enum-default>Enum Default Value</h3><p>The default value for the <code>SearchRequest.corpus</code> field is <code>CORPUS_UNSPECIFIED</code>
because that is the first value defined in the enum.</p><p>It is strongly recommended to define the first value of every enum as
<code>ENUM_TYPE_NAME_UNSPECIFIED = 0;</code> or <code>ENUM_TYPE_NAME_UNKNOWN = 0;</code>. This is
because of the way proto2 handles unknown values for enum fields.</p><p>It is also recommended that this first, default value have no semantic meaning
other than &ldquo;this value was unspecified&rdquo;.</p><p>The default value for an enum field like <code>SearchRequest.corpus</code> field can be
explicitly overridden like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>  optional Corpus corpus = 4 [default = CORPUS_UNIVERSAL];
</span></span></code></pre></div><h3 id=enum-aliases>Enum Value Aliases</h3><p>You can define aliases by assigning the same value to different enum constants.
To do this you need to set the <code>allow_alias</code> option to <code>true</code>. Otherwise, the
protocol buffer compiler generates a warning message when aliases are
found. Though all alias values are valid for serialization, only the first value
is used when deserializing.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>EnumAllowingAlias</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>option</span> <span style=color:#000>allow_alias</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>EAA_UNSPECIFIED</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>EAA_STARTED</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>EAA_RUNNING</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>EAA_FINISHED</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>EnumNotAllowingAlias</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>ENAA_UNSPECIFIED</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>ENAA_STARTED</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// ENAA_RUNNING = 1;  // Uncommenting this line will cause a warning message.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>ENAA_FINISHED</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>Enumerator constants must be in the range of a 32-bit integer. Since <code>enum</code>
values use
<a href=/programming-guides/encoding>varint encoding</a> on the
wire, negative values are inefficient and thus not recommended. You can define
<code>enum</code>s within a message definition, as in the earlier example, or outside –
these <code>enum</code>s can be reused in any message definition in your <code>.proto</code> file. You
can also use an <code>enum</code> type declared in one message as the type of a field in a
different message, using the syntax <code>_MessageType_._EnumType_</code>.</p><p>When you run the protocol buffer compiler on a <code>.proto</code> that uses an <code>enum</code>, the
generated code will have a corresponding <code>enum</code> for Java, Kotlin, or C++, or a
special <code>EnumDescriptor</code> class for Python that&rsquo;s used to create a set of
symbolic constants with integer values in the runtime-generated class.</p><div class="alert alert-warning" role=alert><h4 class=alert-heading>Important</h4>The
generated code may be subject to language-specific limitations on the number of
enumerators (low thousands for one language). Review the
limitations for the languages you plan to use.</div><div class="alert alert-warning" role=alert><h4 class=alert-heading>Important</h4>For
information on how enums should work contrasted with how they currently work in
different languages, see
<a href=/programming-guides/enum>Enum Behavior</a>.</div><p>Removing enum values is a breaking change for persisted protos. Instead of
removing a value, mark the value with the <code>reserved</code> keyword to prevent the enum
value from being code-generated, or keep the value but indicate that it will be
removed later by using the <code>deprecated</code> field option:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>PhoneType</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>PHONE_TYPE_UNSPECIFIED</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>PHONE_TYPE_MOBILE</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>PHONE_TYPE_HOME</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>PHONE_TYPE_WORK</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>deprecated</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>reserved</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>For more information about how to work with message <code>enum</code>s in your
applications, see the <a href=/reference/>generated code guide</a>
for your chosen language.</p><h3 id=reserved>Reserved Values</h3><p>If you <a href=#updating>update</a> an enum type by entirely removing an enum entry, or
commenting it out, future users can reuse the numeric value when making their
own updates to the type. This can cause severe issues if they later load old
instances of the same <code>.proto</code>, including data corruption, privacy bugs, and so
on. One way to make sure this doesn&rsquo;t happen is to specify that the numeric
values (and/or names, which can also cause issues for JSON serialization) of
your deleted entries are <code>reserved</code>. The protocol buffer compiler will complain
if any future users try to use these identifiers. You can specify that your
reserved numeric value range goes up to the maximum possible value using the
<code>max</code> keyword.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>reserved</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>15</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>9</span> <span style=color:#204a87;font-weight:700>to</span> <span style=color:#0000cf;font-weight:700>11</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>40</span> <span style=color:#204a87;font-weight:700>to</span> <span style=color:#204a87;font-weight:700>max</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>reserved</span> <span style=color:#4e9a06>&#34;FOO&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;BAR&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>Note that you can&rsquo;t mix field names and numeric values in the same <code>reserved</code>
statement.</p><h2 id=other>Using Other Message Types</h2><p>You can use other message types as field types. For example, let&rsquo;s say you
wanted to include <code>Result</code> messages in each <code>SearchResponse</code> message – to do
this, you can define a <code>Result</code> message type in the same <code>.proto</code> and then
specify a field of type <code>Result</code> in <code>SearchResponse</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>SearchResponse</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>Result</span> <span style=color:#000>results</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Result</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>url</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>title</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>snippets</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><h3 id=importing>Importing Definitions</h3><p>In the earlier example, the <code>Result</code> message type is defined in the same file as
<code>SearchResponse</code> – what if the message type you want to use as a field type is
already defined in another <code>.proto</code> file?</p><p>You can use definitions from other <code>.proto</code> files by <em>importing</em> them. To import
another <code>.proto</code>&rsquo;s definitions, you add an import statement to the top of your
file:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;myproject/other_protos.proto&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>By default, you can use definitions only from directly imported <code>.proto</code> files.
However, sometimes you may need to move a <code>.proto</code> file to a new location.
Instead of moving the <code>.proto</code> file directly and updating all the call sites in
a single change, you can put a placeholder <code>.proto</code> file in the old location to
forward all the imports to the new location using the <code>import public</code> notion.</p><p><strong>Note that the public import functionality is not available in Java, Kotlin,
TypeScript, JavaScript, GCL, as well as C++ targets that use protobuf static
reflection.</strong></p><p><code>import public</code> dependencies can be transitively relied upon by any code
importing the proto containing the <code>import public</code> statement. For example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// new.proto
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// All definitions are moved here
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// old.proto
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// This is the proto that all clients are importing.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>public</span> <span style=color:#4e9a06>&#34;new.proto&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;other.proto&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// client.proto
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;old.proto&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>// You use definitions from old.proto and new.proto, but not other.proto
</span></span></span></code></pre></div><p>The protocol compiler searches for imported files in a set of directories
specified on the protocol compiler command line using the <code>-I</code>/<code>--proto_path</code>
flag. If no flag was given, it looks in the directory in which the compiler was
invoked. In general you should set the <code>--proto_path</code> flag to the root of your
project and use fully qualified names for all imports.</p><h3 id=proto3>Using proto3 Message Types</h3><p>It&rsquo;s possible to import
<a href=/programming-guides/proto3>proto3</a> and
<a href=/programming-guides/editions>edition 2023</a> message
types and use them in your proto2 messages, and vice versa. However, proto2
enums cannot be used directly in proto3 syntax (it&rsquo;s okay if an imported proto2
message uses them).</p><h2 id=nested>Nested Types</h2><p>You can define and use message types inside other message types, as in the
following example – here the <code>Result</code> message is defined inside the
<code>SearchResponse</code> message:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>SearchResponse</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Result</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>url</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>title</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>snippets</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>Result</span> <span style=color:#000>results</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>If you want to reuse this message type outside its parent message type, you
refer to it as <code>_Parent_._Type_</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>SomeOtherMessage</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>SearchResponse.Result</span> <span style=color:#000>result</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>You can nest messages as deeply as you like. In the example below, note that the
two nested types named <code>Inner</code> are entirely independent, since they are defined
within different messages:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Outer</span> <span style=color:#000;font-weight:700>{</span>       <span style=color:#8f5902;font-style:italic>// Level 0
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>MiddleAA</span> <span style=color:#000;font-weight:700>{</span>  <span style=color:#8f5902;font-style:italic>// Level 1
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Inner</span> <span style=color:#000;font-weight:700>{</span>   <span style=color:#8f5902;font-style:italic>// Level 2
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>      <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int64</span> <span style=color:#000>ival</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>      <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>bool</span>  <span style=color:#000>booly</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>MiddleBB</span> <span style=color:#000;font-weight:700>{</span>  <span style=color:#8f5902;font-style:italic>// Level 1
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Inner</span> <span style=color:#000;font-weight:700>{</span>   <span style=color:#8f5902;font-style:italic>// Level 2
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>      <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span>  <span style=color:#000>ival</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>      <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>bool</span>   <span style=color:#000>booly</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><h3 id=groups>Groups</h3><p><strong>Note that the groups feature is deprecated and should not be used when
creating new message types. Use nested message types instead.</strong></p><p>Groups are another way to nest information in your message definitions. For
example, another way to specify a <code>SearchResponse</code> containing a number of
<code>Result</code>s is as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>SearchResponse</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#204a87;font-weight:700>group</span> <span style=color:#000>Result</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>url</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>title</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>snippets</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>A group simply combines a nested message type and a field into a single
declaration. In your code, you can treat this message just as if it had a
<code>Result</code> type field called <code>result</code> (the latter name is converted to lower-case
so that it does not conflict with the former). Therefore, this example is
exactly equivalent to the <code>SearchResponse</code> earlier, except that the message has
a different <a href=/programming-guides/encoding>wire format</a>.</p><h2 id=updating>Updating a Message Type</h2><p>If an existing message type no longer meets all your needs – for example, you&rsquo;d
like the message format to have an extra field – but you&rsquo;d still like to use
code created with the old format, don&rsquo;t worry! It&rsquo;s very simple to update
message types without breaking any of your existing code when you use the binary
wire format.</p><div class="alert alert-note" role=alert><h4 class=alert-heading>Note</h4>If
you use JSON or
<a href=/reference/protobuf/textformat-spec>proto text format</a>
to store your protocol buffer messages, the changes that you can make in your
proto definition are different.</div><p>Check
<a href=/best-practices/dos-donts>Proto Best Practices</a> and the
following rules:</p><ul><li>Don&rsquo;t change the field numbers for any existing fields. &ldquo;Changing&rdquo; the field
number is equivalent to deleting the field and adding a new field with the
same type. If you want to renumber a field, see the instructions for
<a href=#deleting>deleting a field</a>.</li><li>Any new fields that you add should be <code>optional</code> or <code>repeated</code>. This means
that any messages serialized by code using your &ldquo;old&rdquo; message format can
still be parsed by your new generated code, as they won&rsquo;t be missing any
<code>required</code> elements. You should keep in mind the <a href=#optional>default values</a>
for these elements so that new code can properly interact with messages
generated by old code. Similarly, messages created by your new code can be
parsed by your old code: old binaries simply ignore the new field when
parsing. However, the unknown fields are not discarded, and if the message
is later serialized, the unknown fields are serialized along with it – so if
the message is passed on to new code, the new fields are still available.
See the <a href=#unknowns>Unknown Fields</a> section for details.</li><li>Non-required fields can be removed, as long as the field number is not used
again in your updated message type. You may want to rename the field
instead, perhaps adding the prefix &ldquo;OBSOLETE_&rdquo;, or make the field number
<a href=#fieldreserved>reserved</a>, so that future users of your <code>.proto</code> can&rsquo;t
accidentally reuse the number.</li><li>A non-required field can be converted to an <a href=#extensions>extension</a> and
vice versa, as long as the type and number stay the same.</li><li><code>int32</code>, <code>uint32</code>, <code>int64</code>, <code>uint64</code>, and <code>bool</code> are all compatible – this
means you can change a field from one of these types to another without
breaking forwards- or backwards-compatibility. If a number is parsed from
the wire which doesn&rsquo;t fit in the corresponding type, you will get the same
effect as if you had cast the number to that type in C++ (for example, if a
64-bit number is read as an int32, it will be truncated to 32 bits).</li><li><code>sint32</code> and <code>sint64</code> are compatible with each other but are <em>not</em>
compatible with the other integer types.</li><li><code>string</code> and <code>bytes</code> are compatible as long as the bytes are valid UTF-8.</li><li>Embedded messages are compatible with <code>bytes</code> if the bytes contain an
encoded instance of the message.</li><li><code>fixed32</code> is compatible with <code>sfixed32</code>, and <code>fixed64</code> with <code>sfixed64</code>.</li><li>For <code>string</code>, <code>bytes</code>, and message fields, singular is compatible with
<code>repeated</code>. Given serialized data of a repeated field as input, clients that
expect this field to be singular will take the last input value if it&rsquo;s a
primitive type field or merge all input elements if it&rsquo;s a message type
field. Note that this is <strong>not</strong> generally safe for numeric types, including
bools and enums. Repeated fields of numeric types may be serialized in the
<a href=/programming-guides/encoding#packed>packed</a> format,
which will not be parsed correctly when a singular field is expected.</li><li>Changing a default value is generally OK, as long as you remember that
default values are never sent over the wire. Thus, if a program receives a
message in which a particular field isn&rsquo;t set, the program will see the
default value as it was defined in that program&rsquo;s version of the protocol.
It will NOT see the default value that was defined in the sender&rsquo;s code.</li><li><code>enum</code> is compatible with <code>int32</code>, <code>uint32</code>, <code>int64</code>, and <code>uint64</code> in terms
of wire format (note that values will be truncated if they don&rsquo;t fit).
However, be aware that client code may treat them differently when the
message is deserialized. Notably, unrecognized <code>enum</code> values are discarded
when the message is deserialized, which makes the field&rsquo;s <code>has..</code> accessor
return false and its getter return the first value listed in the <code>enum</code>
definition, or the default value if one is specified. In the case of
repeated enum fields, any unrecognized values are stripped out of the list.
However, an integer field will always preserve its value. Because of this,
you need to be very careful when upgrading an integer to an <code>enum</code> in terms
of receiving out of bounds enum values on the wire.</li><li>In the current Java and C++ implementations, when unrecognized <code>enum</code> values
are stripped out, they are stored along with other unknown fields. Note that
this can result in strange behavior if this data is serialized and then
reparsed by a client that recognizes these values. In the case of optional
fields, even if a new value was written after the original message was
deserialized, the old value will be still read by clients that recognize it.
In the case of repeated fields, the old values will appear after any
recognized and newly-added values, which means that order will not be
preserved.</li><li>Changing a single <code>optional</code> field or extension into a member of a <strong>new</strong>
<code>oneof</code> is binary compatible, however for some languages (notably, Go) the
generated code&rsquo;s API will change in incompatible ways. For this reason,
Google does not make such changes in its public APIs, as documented in
<a href=https://google.aip.dev/180#moving-into-oneofs>AIP-180</a>. With
the same caveat about source-compatibility, moving multiple fields into a
new <code>oneof</code> may be safe if you are sure that no code sets more than one at a
time. Moving fields into an existing <code>oneof</code> is not safe. Likewise, changing
a single field <code>oneof</code> to an <code>optional</code> field or extension is safe.</li><li>Changing a field between a <code>map&lt;K, V></code> and the corresponding <code>repeated</code>
message field is binary compatible (see <a href=#maps>Maps</a>, below, for the
message layout and other restrictions). However, the safety of the change is
application-dependent: when deserializing and reserializing a message,
clients using the <code>repeated</code> field definition will produce a semantically
identical result; however, clients using the <code>map</code> field definition may
reorder entries and drop entries with duplicate keys.</li></ul><h2 id=unknowns>Unknown Fields</h2><p>Unknown fields are well-formed protocol buffer serialized data representing
fields that the parser does not recognize. For example, when an old binary
parses data sent by a new binary with new fields, those new fields become
unknown fields in the old binary.</p><p>Originally, proto3 messages always discarded unknown fields during parsing, but
in version 3.5 we reintroduced the preservation of unknown fields to match the
proto2 behavior. In versions 3.5 and later, unknown fields are retained during
parsing and included in the serialized output.</p><h3 id=retaining>Retaining Unknown Fields</h3><p>Some actions can cause unknown fields to be lost. For example, if you do one of
the following, unknown fields are lost:</p><ul><li>Serialize a proto to JSON.</li><li>Iterate over all of the fields in a message to populate a new message.</li></ul><p>To avoid losing unknown fields, do the following:</p><ul><li>Use binary; avoid using text formats for data exchange.</li><li>Use message-oriented APIs, such as <code>CopyFrom()</code> and <code>MergeFrom()</code>, to copy data
rather than copying field-by-field</li></ul><p>TextFormat is a bit of a special case. Serializing to TextFormat prints unknown
fields using their field numbers. But parsing TextFormat data back into a binary
proto fails if there are entries that use field numbers.</p><h2 id=extensions>Extensions</h2><p>An extension is a field defined outside of its container message; usually in a
<code>.proto</code> file separate from the container message&rsquo;s <code>.proto</code> file.</p><h3 id=why-ext>Why Use Extensions?</h3><p>There are two main reasons to use extensions:</p><ul><li>The container message&rsquo;s <code>.proto</code> file will have fewer imports/dependencies.
This can improve build times, break circular dependencies, and otherwise
promote loose coupling. Extensions are very good for this.</li><li>Allow systems to attach data to a container message with minimal dependency
and coordination. Extensions are not a great solution for this because of
the limited field number space and the
<a href=#consequences>Consequences of Reusing Field Numbers</a>. If your use case
requires very low coordination for a large number of extensions, consider
using the
<a href=/reference/protobuf/google.protobuf#any><code>Any</code> message type</a>
instead.</li></ul><h3 id=ext-example>Example Extension</h3><p>Let&rsquo;s look at an example extension:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// file kittens/video_ext.proto
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;kittens/video.proto&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;media/user_content.proto&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>kittens</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>// This extension allows kitten videos in a media.UserContent message.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>media</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>UserContent</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Video is a message imported from kittens/video.proto
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>Video</span> <span style=color:#000>kitten_videos</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>126</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>Note that the file defining the extension (<code>kittens/video_ext.proto</code>) imports
the container message&rsquo;s file (<code>media/user_content.proto</code>).</p><p>The container message must reserve a subset of its field numbers for extensions.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// file media/user_content.proto
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>media</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>// A container message to hold stuff that a user has created.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>UserContent</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Set verification to `DECLARATION` to enforce extension declarations for all
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// extensions in this range.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>extensions</span> <span style=color:#0000cf;font-weight:700>100</span> <span style=color:#204a87;font-weight:700>to</span> <span style=color:#0000cf;font-weight:700>199</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>verification</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>DECLARATION</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>The container message&rsquo;s file (<code>media/user_content.proto</code>) defines the message
<code>UserContent</code>, which reserves field numbers [100 to 199] for extensions. It is
recommended to set <code>verification = DECLARATION</code> for the range to require
declarations for all its extensions.</p><p>When the new extension (<code>kittens/video_ext.proto</code>) is added, a corresponding
declaration should be added to <code>UserContent</code> and <code>verification</code> should be
removed.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>// A container message to hold stuff that a user has created.
</span></span><span style=display:flex><span>message UserContent {
</span></span><span style=display:flex><span>  extensions 100 to 199 [
</span></span><span style=display:flex><span>    declaration = {
</span></span><span style=display:flex><span>      number: 126,
</span></span><span style=display:flex><span>      full_name: &#34;.kittens.kitten_videos&#34;,
</span></span><span style=display:flex><span>      type: &#34;.kittens.Video&#34;,
</span></span><span style=display:flex><span>      repeated: true
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    // Ensures all field numbers in this extension range are declarations.
</span></span><span style=display:flex><span>    verification = DECLARATION
</span></span><span style=display:flex><span>  ];
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>UserContent</code> declares that field number <code>126</code> will be used by a <code>repeated</code>
extension field with the fully-qualified name <code>.kittens.kitten_videos</code> and the
fully-qualified type <code>.kittens.Video</code>. To learn more about extension
declarations see
<a href=/programming-guides/extension_declarations>Extension Declarations</a>.</p><p>Note that the container message&rsquo;s file (<code>media/user_content.proto</code>) <strong>does not</strong>
import the kitten_video extension definition (<code>kittens/video_ext.proto</code>)</p><p>There is no difference in the wire-format encoding of extension fields as
compared to a standard field with the same field number, type, and cardinality.
Therefore, it is safe to move a standard field out of its container to be an
extension or to move an extension field into its container message as a standard
field so long as the field number, type, and cardinality remain constant.</p><p>However, because extensions are defined outside of the container message, no
specialized accessors are generated to get and set specific extension fields.
For our example, the protobuf compiler <strong>will not generate</strong> <code>AddKittenVideos()</code>
or <code>GetKittenVideos()</code> accessors. Instead, extensions are accessed through
parameterized functions like: <code>HasExtension()</code>, <code>ClearExtension()</code>,
<code>GetExtension()</code>, <code>MutableExtension()</code>, and <code>AddExtension()</code>.</p><p>In C++, it would look something like:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#000>UserContent</span> <span style=color:#000>user_content</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000>user_content</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>AddExtension</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>kittens</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>kitten_videos</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>kittens</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Video</span><span style=color:#000;font-weight:700>());</span>
</span></span><span style=display:flex><span><span style=color:#000>assert</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#000>user_content</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetExtensionCount</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>kittens</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>kitten_videos</span><span style=color:#000;font-weight:700>));</span>
</span></span><span style=display:flex><span><span style=color:#000>user_content</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetExtension</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>kittens</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>kitten_videos</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>);</span>
</span></span></code></pre></div><h3 id=defining-ranges>Defining Extension Ranges</h3><p>If you are the owner of a container message, you will need to define an
extension range for the extensions to your message.</p><p>Field numbers allocated to extension fields cannot be reused for standard
fields.</p><p>It is safe to expand an extension range after it is defined. A good default is
to allocate 1000 relatively small numbers, and densely populate that space using
extension declarations:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>ModernExtendableMessage</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// All extensions in this range should use extension declarations.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>extensions</span> <span style=color:#0000cf;font-weight:700>1000</span> <span style=color:#204a87;font-weight:700>to</span> <span style=color:#0000cf;font-weight:700>2000</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>verification</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>DECLARATION</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>When adding a range for extension declarations before the actual extensions, you
should add <code>verification = DECLARATION</code> to enforce that declarations are used
for this new range. This placeholder can be removed once an actual declaration
is added.</p><p>It is safe to split an existing extension range into separate ranges that cover
the same total range. This might be necessary for migrating a legacy message
type to
<a href=/programming-guides/extension_declarations>Extension Declarations</a>.
For example, before migration, the range might be defined as:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>LegacyMessage</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>extensions</span> <span style=color:#0000cf;font-weight:700>1000</span> <span style=color:#204a87;font-weight:700>to</span> <span style=color:#204a87;font-weight:700>max</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>And after migration (splitting the range) it can be:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>LegacyMessage</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Legacy range that was using an unverified allocation scheme.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>extensions</span> <span style=color:#0000cf;font-weight:700>1000</span> <span style=color:#204a87;font-weight:700>to</span> <span style=color:#0000cf;font-weight:700>524999999</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>verification</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>UNVERIFIED</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Current range that uses extension declarations.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>extensions</span> <span style=color:#0000cf;font-weight:700>525000000</span> <span style=color:#204a87;font-weight:700>to</span> <span style=color:#204a87;font-weight:700>max</span>  <span style=color:#000;font-weight:700>[</span><span style=color:#000>verification</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>DECLARATION</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>It is not safe to increase the start field number nor decrease the end field
number to move or shrink an extension range. These changes can invalidate an
existing extension.</p><p>Prefer using field numbers 1 to 15 for standard fields that are populated in
most instances of your proto. It is not recommended to use these numbers for
extensions.</p><p>If your numbering convention might involve extensions having very large field
numbers, you can specify that your extension range goes up to the maximum
possible field number using the <code>max</code> keyword:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>extensions</span> <span style=color:#0000cf;font-weight:700>1000</span> <span style=color:#204a87;font-weight:700>to</span> <span style=color:#204a87;font-weight:700>max</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p><code>max</code> is 2<sup>29</sup> - 1, or 536,870,911.</p><h3 id=choosing>Choosing Extension Numbers</h3><p>Extensions are just fields that can be specified outside of their container
messages. All the same rules for <a href=#assigning>Assigning Field Numbers</a> apply to
extension field numbers. The same
<a href=#consequences>Consequences of Reusing Field Numbers</a> also apply to reusing
extension field numbers.</p><p>Choosing unique extension field numbers is simple if the container message uses
<a href=/programming-guides/extension_declarations>extension declarations</a>.
When defining a new extension, choose the lowest field number above all other
declarations from the highest extension range defined in the container message.
For example, if a container message is defined like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Container</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Legacy range that was using an unverified allocation scheme
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>extensions</span> <span style=color:#0000cf;font-weight:700>1000</span> <span style=color:#204a87;font-weight:700>to</span> <span style=color:#0000cf;font-weight:700>524999999</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Current range that uses extension declarations. (highest extension range)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>extensions</span> <span style=color:#0000cf;font-weight:700>525000000</span> <span style=color:#204a87;font-weight:700>to</span> <span style=color:#204a87;font-weight:700>max</span>  <span style=color:#000;font-weight:700>[</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>declaration</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>      <span style=color:#000>number</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>525000001</span><span style=color:#000;font-weight:700>,</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>      <span style=color:#000>full_name</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;.bar.baz_ext&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>      <span style=color:#000>type</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;.bar.Baz&#34;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#8f5902;font-style:italic>// 525,000,002 is the lowest field number above all other declarations
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>The next extension of <code>Container</code> should add a new declaration with the number
<code>525000002</code>.</p><h4 id=unverified>Unverified Extension Number Allocation (not recommended)</h4><p>The owner of a container message may choose to forgo extension declarations in
favor of their own unverified extension number allocation strategy.</p><p>An unverified allocation scheme uses a mechanism external to the protobuf
ecosystem to allocate extension field numbers within the selected extension
range. One example could be using a monorepo&rsquo;s commit number. This system is
&ldquo;unverified&rdquo; from the protobuf compiler&rsquo;s point of view since there is no way to
check that an extension is using a properly acquired extension field number.</p><p>The benefit of an unverified system over a verified system like extension
declarations is the ability to define an extension without coordinating with the
container message owner.</p><p>The downside of an unverified system is that the protobuf compiler cannot
protect participants from reusing extension field numbers.</p><p><strong>Unverified extension field number allocation strategies are not recommended</strong>
because the <a href=#consequences>Consequences of Reusing Field Numbers</a> fall on all
extenders of a message (not just the developer that didn&rsquo;t follow the
recommendations). If your use case requires very low coordination, consider
using the
<a href=/reference/protobuf/google.protobuf#any><code>Any</code> message</a>
instead.</p><p>Unverified extension field number allocation strategies are limited to the range
1 to 524,999,999. Field numbers 525,000,000 and above can only be used with
extension declarations.</p><h3 id=specifying-extension-types>Specifying Extension Types</h3><p>Extensions can be of any field type except <code>oneof</code>s and <code>map</code>s.</p><h3 id=nested-exts>Nested Extensions (not recommended)</h3><p>You can declare extensions in the scope of another message:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;common/user_profile.proto&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>puppies</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Photo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>common</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>UserProfile</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>likes_count</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>111</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#ce5c00;font-weight:700>...</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>In this case, the C++ code to access this extension is:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#000>UserProfile</span> <span style=color:#000>user_profile</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000>user_profile</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SetExtension</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>puppies</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Photo</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>likes_count</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>42</span><span style=color:#000;font-weight:700>);</span>
</span></span></code></pre></div><p>In other words, the only effect is that <code>likes_count</code> is defined within the
scope of <code>puppies.Photo</code>.</p><p>This is a common source of confusion: Declaring an <code>extend</code> block nested inside
a message type <em>does not</em> imply any relationship between the outer type and the
extended type. In particular, the earlier example <em>does not</em> mean that <code>Photo</code>
is any sort of subclass of <code>UserProfile</code>. All it means is that the symbol
<code>likes_count</code> is declared inside the scope of <code>Photo</code>; it&rsquo;s simply a static
member.</p><p>A common pattern is to define extensions inside the scope of the extension&rsquo;s
field type - for example, here&rsquo;s an extension to <code>media.UserContent</code> of type
<code>puppies.Photo</code>, where the extension is defined as part of <code>Photo</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;media/user_content.proto&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>puppies</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Photo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>media</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>UserContent</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>Photo</span> <span style=color:#000>puppy_photo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>127</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#ce5c00;font-weight:700>...</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>However, there is no requirement that an extension with a message type be
defined inside that type. You can also use the standard definition pattern:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;media/user_content.proto&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>puppies</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Photo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#ce5c00;font-weight:700>...</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>// This can even be in a different file.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>media</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>UserContent</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>Photo</span> <span style=color:#000>puppy_photo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>127</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>This <strong>standard (file-level) syntax is preferred</strong> to avoid confusion. The
nested syntax is often mistaken for subclassing by users who are not already
familiar with extensions.</p><h2 id=any>Any</h2><p>The <code>Any</code> message type lets you use messages as embedded types without having
their .proto definition. An <code>Any</code> contains an arbitrary serialized message as
<code>bytes</code>, along with a URL that acts as a globally unique identifier for and
resolves to that message&rsquo;s type. To use the <code>Any</code> type, you need to
<a href=#other>import</a> <code>google/protobuf/any.proto</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;google/protobuf/any.proto&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>ErrorStatus</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>string</span> <span style=color:#204a87;font-weight:700>message</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>google.protobuf.Any</span> <span style=color:#000>details</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>The default type URL for a given message type is
<code>type.googleapis.com/_packagename_._messagename_</code>.</p><p>Different language implementations will support runtime library helpers to pack
and unpack <code>Any</code> values in a typesafe manner – for example, in Java, the <code>Any</code>
type will have special <code>pack()</code> and <code>unpack()</code> accessors, while in C++ there are
<code>PackFrom()</code> and <code>UnpackTo()</code> methods:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Storing an arbitrary message type in Any.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>NetworkErrorDetails</span> <span style=color:#000>details</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>...;</span>
</span></span><span style=display:flex><span><span style=color:#000>ErrorStatus</span> <span style=color:#000>status</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000>status</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>add_details</span><span style=color:#000;font-weight:700>()</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>PackFrom</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>details</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Reading an arbitrary message from Any.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>ErrorStatus</span> <span style=color:#000>status</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>...;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>for</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>protobuf</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Any</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#f57900>detail</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000>status</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>details</span><span style=color:#000;font-weight:700>())</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>detail</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Is</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>NetworkErrorDetails</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>())</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>NetworkErrorDetails</span> <span style=color:#000>network_error</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>detail</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>UnpackTo</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>network_error</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>...</span> <span style=color:#000>processing</span> <span style=color:#000>network_error</span> <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>If you want to limit contained messages to a small number of types and to
require permission before adding new types to the list, consider using
<a href=#extensions>extensions</a> with
<a href=/programming-guides/extension_declarations>extension declarations</a>
instead of <code>Any</code> message types.</p><h2 id=oneof>Oneof</h2><p>If you have a message with many optional fields and where at most one field will
be set at the same time, you can enforce this behavior and save memory by using
the oneof feature.</p><p>Oneof fields are like optional fields except all the fields in a oneof share
memory, and at most one field can be set at the same time. Setting any member of
the oneof automatically clears all the other members. You can check which value
in a oneof is set (if any) using a special <code>case()</code> or <code>WhichOneof()</code> method,
depending on your chosen language.</p><p>Note that if <em>multiple values are set, the last set value as determined by the
order in the proto will overwrite all previous ones</em>.</p><p>Field numbers for oneof fields must be unique within the enclosing message.</p><h3 id=using-oneof>Using Oneof</h3><p>To define a oneof in your <code>.proto</code> you use the <code>oneof</code> keyword followed by your
oneof name, in this case <code>test_oneof</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>SampleMessage</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>oneof</span> <span style=color:#000>test_oneof</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>     <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>     <span style=color:#000>SubMessage</span> <span style=color:#000>sub_message</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>9</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>You then add your oneof fields to the oneof definition. You can add fields of
any type except <code>map</code> fields, but you cannot use the <code>required</code>, <code>optional</code>, or
<code>repeated</code> keywords. If you need to add a repeated field to a oneof, you can use
a message containing the repeated field.</p><p>In your generated code, oneof fields have the same getters and setters as
regular <code>optional</code> fields. You also get a special method for checking which
value (if any) in the oneof is set. You can find out more about the oneof API
for your chosen language in the relevant
<a href=/reference/>API reference</a>.</p><h3 id=oneof-features>Oneof Features</h3><ul><li><p>Setting a oneof field will automatically clear all other members of the
oneof. So if you set several oneof fields, only the <em>last</em> field you set
will still have a value.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#000>SampleMessage</span> <span style=color:#000>message</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>set_name</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;name&#34;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>CHECK</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>has_name</span><span style=color:#000;font-weight:700>());</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Calling mutable_sub_message() will clear the name field and will set
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// sub_message to a new instance of SubMessage with none of its fields set.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>mutable_sub_message</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#000>CHECK</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>!</span><span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>has_name</span><span style=color:#000;font-weight:700>());</span>
</span></span></code></pre></div></li><li><p>If the parser encounters multiple members of the same oneof on the wire,
only the last member seen is used in the parsed message. When parsing data
on the wire, starting at the beginning of the bytes, evaluate the next
value, and apply the following parsing rules:</p><ul><li><p>First, check if a <em>different</em> field in the same oneof is currently set,
and if so clear it.</p></li><li><p>Then apply the contents as though the field was not in a oneof:</p><ul><li>A primitive will overwrite any value already set</li><li>A message will merge into any value already set</li></ul></li></ul></li><li><p>Extensions are not supported for oneof.</p></li><li><p>A oneof cannot be <code>repeated</code>.</p></li><li><p>Reflection APIs work for oneof fields.</p></li><li><p>If you set a oneof field to the default value (such as setting an int32
oneof field to 0), the &ldquo;case&rdquo; of that oneof field will be set, and the value
will be serialized on the wire.</p></li><li><p>If you&rsquo;re using C++, make sure your code doesn&rsquo;t cause memory crashes. The
following sample code will crash because <code>sub_message</code> was already deleted
by calling the <code>set_name()</code> method.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#000>SampleMessage</span> <span style=color:#000>message</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000>SubMessage</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>sub_message</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>mutable_sub_message</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>set_name</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;name&#34;</span><span style=color:#000;font-weight:700>);</span>      <span style=color:#8f5902;font-style:italic>// Will delete sub_message
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>sub_message</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>set_</span><span style=color:#000;font-weight:700>...</span>            <span style=color:#8f5902;font-style:italic>// Crashes here
</span></span></span></code></pre></div></li><li><p>Again in C++, if you <code>Swap()</code> two messages with oneofs, each message will
end up with the other&rsquo;s oneof case: in the example below, <code>msg1</code> will have a
<code>sub_message</code> and <code>msg2</code> will have a <code>name</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#000>SampleMessage</span> <span style=color:#000>msg1</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000>msg1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>set_name</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;name&#34;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>SampleMessage</span> <span style=color:#000>msg2</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000>msg2</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>mutable_sub_message</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#000>msg1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>swap</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>msg2</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>CHECK</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>msg1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>has_sub_message</span><span style=color:#000;font-weight:700>());</span>
</span></span><span style=display:flex><span><span style=color:#000>CHECK</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>msg2</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>has_name</span><span style=color:#000;font-weight:700>());</span>
</span></span></code></pre></div></li></ul><h3 id=backward>Backwards-compatibility issues</h3><p>Be careful when adding or removing oneof fields. If checking the value of a
oneof returns <code>None</code>/<code>NOT_SET</code>, it could mean that the oneof has not been set or
it has been set to a field in a different version of the oneof. There is no way
to tell the difference, since there&rsquo;s no way to know if an unknown field on the
wire is a member of the oneof.</p><h4 id=reuse>Tag Reuse Issues</h4><ul><li><strong>Move optional fields into or out of a oneof</strong>: You may lose some of your
information (some fields will be cleared) after the message is serialized
and parsed. However, you can safely move a single field into a <strong>new</strong> oneof
and may be able to move multiple fields if it is known that only one is ever
set. See <a href=#updating>Updating A Message Type</a> for further details.</li><li><strong>Delete a oneof field and add it back</strong>: This may clear your currently set
oneof field after the message is serialized and parsed.</li><li><strong>Split or merge oneof</strong>: This has similar issues to moving <code>optional</code>
fields.</li></ul><h2 id=maps>Maps</h2><p>If you want to create an associative map as part of your data definition,
protocol buffers provides a handy shortcut syntax:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#000>map</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>key_type</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>value_type</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000>map_field</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>N</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>&mldr;where the <code>key_type</code> can be any integral or string type (so, any
<a href=#scalar>scalar</a> type except for floating point types and <code>bytes</code>). Note that
neither enum nor proto messages are valid for <code>key_type</code>.
The <code>value_type</code> can be any type except another map.</p><p>So, for example, if you wanted to create a map of projects where each <code>Project</code>
message is associated with a string key, you could define it like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#000>map</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Project</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000>projects</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span></code></pre></div><h3 id=maps-features>Maps Features</h3><ul><li>Extensions are not supported for maps.</li><li>Maps cannot be <code>repeated</code>, <code>optional</code>, or <code>required</code>.</li><li>Wire format ordering and map iteration ordering of map values is undefined,
so you cannot rely on your map items being in a particular order.</li><li>When generating text format for a <code>.proto</code>, maps are sorted by key. Numeric
keys are sorted numerically.</li><li>When parsing from the wire or when merging, if there are duplicate map keys
the last key seen is used. When parsing a map from text format, parsing may
fail if there are duplicate keys.</li><li>If you provide a key but no value for a map field, the behavior when the
field is serialized is language-dependent. In C++, Java, Kotlin, and Python
the default value for the type is serialized, while in other languages
nothing is serialized.</li><li>No symbol <code>FooEntry</code> can exist in the same scope as a map <code>foo</code>, because
<code>FooEntry</code> is already used by the implementation of the map.</li></ul><p>The generated map API is currently available for all supported languages. You
can find out more about the map API for your chosen language in the relevant
<a href=/reference/>API reference</a>.</p><h3 id=backwards>Backwards Compatibility</h3><p>The map syntax is equivalent to the following on the wire, so protocol buffers
implementations that do not support maps can still handle your data:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>MapFieldEntry</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>key_type</span> <span style=color:#000>key</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>value_type</span> <span style=color:#000>value</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>MapFieldEntry</span> <span style=color:#000>map_field</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>N</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>Any protocol buffers implementation that supports maps must both produce and
accept data that can be accepted by the earlier definition.</p><h2 id=packages>Packages</h2><p>You can add an optional <code>package</code> specifier to a <code>.proto</code> file to prevent name
clashes between protocol message types.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bar</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Open</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#ce5c00;font-weight:700>...</span> <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>You can then use the package specifier when defining fields of your message
type:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#ce5c00;font-weight:700>...</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>foo.bar.Open</span> <span style=color:#000>open</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#ce5c00;font-weight:700>...</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>The way a package specifier affects the generated code depends on your chosen
language:</p><ul><li>In <strong>C++</strong> the generated classes are wrapped inside a C++ namespace. For
example, <code>Open</code> would be in the namespace <code>foo::bar</code>.</li><li>In <strong>Java</strong> and <strong>Kotlin</strong>, the package is used as the Java package, unless
you explicitly provide an <code>option java_package</code> in your <code>.proto</code> file.</li><li>In <strong>Python</strong>, the <code>package</code> directive is ignored, since Python modules are
organized according to their location in the file system.</li><li>In <strong>Go</strong>, the <code>package</code> directive is ignored, and the generated <code>.pb.go</code>
file is in the package named after the corresponding <code>go_proto_library</code>
Bazel rule. For open source projects, you <strong>must</strong> provide either a <code>go_package</code> option or set the Bazel <code>-M</code> flag.</li><li>In <strong>Ruby</strong>, the generated classes are wrapped inside nested Ruby
namespaces, converted to the required Ruby capitalization style (first
letter capitalized; if the first character is not a letter, <code>PB_</code> is
prepended). For example, <code>Open</code> would be in the namespace <code>Foo::Bar</code>.</li><li>In <strong>PHP</strong> the package is used as the namespace after converting to
PascalCase, unless you explicitly provide an <code>option php_namespace</code> in your
<code>.proto</code> file. For example, <code>Open</code> would be in the namespace <code>Foo\Bar</code>.</li><li>In <strong>C#</strong> the package is used as the namespace after converting to
PascalCase, unless you explicitly provide an <code>option csharp_namespace</code> in
your <code>.proto</code> file. For example, <code>Open</code> would be in the namespace <code>Foo.Bar</code>.</li></ul><p>Note that even when the <code>package</code> directive does not directly affect the
generated code, for example in Python, it is still strongly recommended to
specify the package for the <code>.proto</code> file, as otherwise it may lead to naming
conflicts in descriptors and make the proto not portable for other languages.</p><h3 id=name-resolution>Packages and Name Resolution</h3><p>Type name resolution in the protocol buffer language works like C++: first the
innermost scope is searched, then the next-innermost, and so on, with each
package considered to be &ldquo;inner&rdquo; to its parent package. A leading &lsquo;.&rsquo; (for
example, <code>.foo.bar.Baz</code>) means to start from the outermost scope instead.</p><p>The protocol buffer compiler resolves all type names by parsing the imported
<code>.proto</code> files. The code generator for each language knows how to refer to each
type in that language, even if it has different scoping rules.</p><h2 id=services>Defining Services</h2><p>If you want to use your message types with an RPC (Remote Procedure Call)
system, you can define an RPC service interface in a <code>.proto</code> file and the
protocol buffer compiler will generate service interface code and stubs in your
chosen language. So, for example, if you want to define an RPC service with a
method that takes your <code>SearchRequest</code> and returns a <code>SearchResponse</code>, you can
define it in your <code>.proto</code> file as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>service</span> <span style=color:#000>SearchService</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>rpc</span> <span style=color:#000>Search</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>SearchRequest</span><span style=color:#000;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>returns</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>SearchResponse</span><span style=color:#000;font-weight:700>);</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>By default, the protocol compiler will then generate an abstract interface
called <code>SearchService</code> and a corresponding &ldquo;stub&rdquo; implementation. The stub
forwards all calls to an <code>RpcChannel</code>, which in turn is an abstract interface
that you must define yourself in terms of your own RPC system. For example, you
might implement an <code>RpcChannel</code> which serializes the message and sends it to a
server via HTTP. In other words, the generated stub provides a type-safe
interface for making protocol-buffer-based RPC calls, without locking you into
any particular RPC implementation. So, in C++, you might end up with code like
this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>protobuf</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>protobuf</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>RpcChannel</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>channel</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000>protobuf</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>RpcController</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>controller</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000>SearchService</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>service</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000>SearchRequest</span> <span style=color:#000>request</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000>SearchResponse</span> <span style=color:#000>response</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>DoSearch</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// You provide classes MyRpcChannel and MyRpcController, which implement
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// the abstract interfaces protobuf::RpcChannel and protobuf::RpcController.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>channel</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>MyRpcChannel</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;somehost.example.com:1234&#34;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#000>controller</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>MyRpcController</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// The protocol compiler generates the SearchService class based on the
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// definition given earlier.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>service</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>SearchService</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Stub</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>channel</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Set up the request.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>request</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>set_query</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;protocol buffers&#34;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Execute the RPC.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>service</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>Search</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>controller</span><span style=color:#000;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>request</span><span style=color:#000;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>response</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                  <span style=color:#000>protobuf</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>NewCallback</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>Done</span><span style=color:#000;font-weight:700>));</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>Done</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>delete</span> <span style=color:#000>service</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>delete</span> <span style=color:#000>channel</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>delete</span> <span style=color:#000>controller</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>All service classes also implement the <code>Service</code> interface, which provides a way
to call specific methods without knowing the method name or its input and output
types at compile time. On the server side, this can be used to implement an RPC
server with which you could register services.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>protobuf</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>ExampleSearchService</span> <span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>SearchService</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span> <span style=color:#204a87;font-weight:700>public</span><span style=color:#ce5c00;font-weight:700>:</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>Search</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>protobuf</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>RpcController</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>controller</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>SearchRequest</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>request</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#000>SearchResponse</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>response</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#000>protobuf</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Closure</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>done</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>request</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>query</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;google&#34;</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>response</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>add_result</span><span style=color:#000;font-weight:700>()</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>set_url</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;http://www.google.com&#34;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>request</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>query</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;protocol buffers&#34;</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>response</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>add_result</span><span style=color:#000;font-weight:700>()</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>set_url</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;http://protobuf.googlecode.com&#34;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000>done</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>Run</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>};</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// You provide class MyRpcServer.  It does not have to implement any
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// particular interface; this is just an example.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>MyRpcServer</span> <span style=color:#000>server</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>protobuf</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Service</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>service</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>ExampleSearchService</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>server</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ExportOnPort</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1234</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>service</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#000>server</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Run</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>delete</span> <span style=color:#000>service</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>If you don&rsquo;t want to plug in your own existing RPC system, you can use
<a href=https://github.com/grpc/grpc-common>gRPC</a>: a language- and platform-neutral
open source RPC system developed at Google. gRPC works particularly well with
protocol buffers and lets you generate the relevant RPC code directly from your
<code>.proto</code> files using a special protocol buffer compiler plugin. However, as
there are potential compatibility issues between clients and servers generated
with proto2 and proto3, we recommend that you use proto3 or edition 2023 for
defining gRPC services. You can find out more about proto3 syntax in the
<a href=/programming-guides/proto3>Proto3 Language Guide</a> and
about edition 2023 in
<a href=/programming-guides/editions>Edition 2023 Language Guide</a>.</p><p>In addition to gRPC, there are also a number of ongoing third-party projects to
develop RPC implementations for Protocol Buffers. For a list of links to
projects we know about, see the
<a href=https://github.com/protocolbuffers/protobuf/blob/master/docs/third_party.md>third-party add-ons wiki page</a>.</p><h2 id=json>JSON Mapping</h2><p>The standard protobuf binary wire format is the preferred serialization format
for communication between two systems that use protobufs. For communicating with
systems that use JSON rather than protobuf wire format, Protobuf supports a
canonical encoding in <a href=/programming-guides/json>JSON</a>.</p><h2 id=options>Options</h2><p>Individual declarations in a <code>.proto</code> file can be annotated with a number of
<em>options</em>. Options do not change the overall meaning of a declaration, but may
affect the way it is handled in a particular context. The complete list of
available options is defined in <a href=https://github.com/protocolbuffers/protobuf/blob/main/src/google/protobuf/descriptor.proto><code>/google/protobuf/descriptor.proto</code></a>.</p><p>Some options are file-level options, meaning they should be written at the
top-level scope, not inside any message, enum, or service definition. Some
options are message-level options, meaning they should be written inside message
definitions. Some options are field-level options, meaning they should be
written inside field definitions. Options can also be written on enum types,
enum values, oneof fields, service types, and service methods; however, no
useful options currently exist for any of these.</p><p>Here are a few of the most commonly used options:</p><ul><li><p><code>java_package</code> (file option): The package you want to use for your generated
Java/Kotlin classes. If no explicit <code>java_package</code> option is given in the
<code>.proto</code> file, then by default the proto package (specified using the
&ldquo;package&rdquo; keyword in the <code>.proto</code> file) will be used. However, proto
packages generally do not make good Java packages since proto packages are
not expected to start with reverse domain names. If not generating Java or
Kotlin code, this option has no effect.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>option</span> <span style=color:#000>java_package</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;com.example.foo&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span></code></pre></div></li><li><p><code>java_outer_classname</code> (file option): The class name (and hence the file
name) for the wrapper Java class you want to generate. If no explicit
<code>java_outer_classname</code> is specified in the <code>.proto</code> file, the class name
will be constructed by converting the <code>.proto</code> file name to camel-case (so
<code>foo_bar.proto</code> becomes <code>FooBar.java</code>). If the <code>java_multiple_files</code> option
is disabled, then all other classes/enums/etc. generated for the <code>.proto</code>
file will be generated <em>within</em> this outer wrapper Java class as nested
classes/enums/etc. If not generating Java code, this option has no effect.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>option</span> <span style=color:#000>java_outer_classname</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;Ponycopter&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span></code></pre></div></li><li><p><code>java_multiple_files</code> (file option): If false, only a single <code>.java</code> file
will be generated for this <code>.proto</code> file, and all the Java
classes/enums/etc. generated for the top-level messages, services, and
enumerations will be nested inside of an outer class (see
<code>java_outer_classname</code>). If true, separate <code>.java</code> files will be generated
for each of the Java classes/enums/etc. generated for the top-level
messages, services, and enumerations, and the wrapper Java class generated
for this <code>.proto</code> file won&rsquo;t contain any nested classes/enums/etc. This is a
Boolean option which defaults to <code>false</code>. If not generating Java code, this
option has no effect.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>option</span> <span style=color:#000>java_multiple_files</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span></code></pre></div></li><li><p><code>optimize_for</code> (file option): Can be set to <code>SPEED</code>, <code>CODE_SIZE</code>, or
<code>LITE_RUNTIME</code>. This affects the C++ and Java code generators (and possibly
third-party generators) in the following ways:</p><ul><li><code>SPEED</code> (default): The protocol buffer compiler will generate code for
serializing, parsing, and performing other common operations on your
message types. This code is highly optimized.</li><li><code>CODE_SIZE</code>: The protocol buffer compiler will generate minimal classes
and will rely on shared, reflection-based code to implement
serialization, parsing, and various other operations. The generated code
will thus be much smaller than with <code>SPEED</code>, but operations will be
slower. Classes will still implement exactly the same public API as they
do in <code>SPEED</code> mode. This mode is most useful in apps that contain a very
large number of <code>.proto</code> files and do not need all of them to be
blindingly fast.</li><li><code>LITE_RUNTIME</code>: The protocol buffer compiler will generate classes that
depend only on the &ldquo;lite&rdquo; runtime library (<code>libprotobuf-lite</code> instead of
<code>libprotobuf</code>). The lite runtime is much smaller than the full library
(around an order of magnitude smaller) but omits certain features like
descriptors and reflection. This is particularly useful for apps running
on constrained platforms like mobile phones. The compiler will still
generate fast implementations of all methods as it does in <code>SPEED</code> mode.
Generated classes will only implement the <code>MessageLite</code> interface in
each language, which provides only a subset of the methods of the full
<code>Message</code> interface.</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>option</span> <span style=color:#000>optimize_for</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>CODE_SIZE</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span></code></pre></div></li><li><p><code>cc_generic_services</code>, <code>java_generic_services</code>, <code>py_generic_services</code> (file
options): <strong>Generic services are deprecated.</strong> Whether or not the protocol
buffer compiler should generate abstract service code based on
<a href=#services>services definitions</a> in C++, Java, and Python, respectively.
For legacy reasons, these default to <code>true</code>. However, as of version 2.3.0
(January 2010), it is considered preferable for RPC implementations to
provide
<a href=/reference/cpp/api-docs/google.protobuf.compiler.plugin.pb>code generator plugins</a>
to generate code more specific to each system, rather than rely on the
&ldquo;abstract&rdquo; services.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// This file relies on plugins to generate service code.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>option</span> <span style=color:#000>cc_generic_services</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>option</span> <span style=color:#000>java_generic_services</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>option</span> <span style=color:#000>py_generic_services</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span></code></pre></div></li><li><p><code>cc_enable_arenas</code> (file option): Enables
<a href=/reference/cpp/arenas>arena allocation</a> for C++
generated code.</p></li><li><p><code>objc_class_prefix</code> (file option): Sets the Objective-C class prefix which
is prepended to all Objective-C generated classes and enums from this
.proto. There is no default. You should use prefixes that are between 3-5
uppercase characters as
<a href=https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/ProgrammingWithObjectiveC/Conventions/Conventions.html#//apple_ref/doc/uid/TP40011210-CH10-SW4>recommended by Apple</a>.
Note that all 2 letter prefixes are reserved by Apple.</p></li><li><p><code>message_set_wire_format</code> (message option): If set to <code>true</code>, the message
uses a different binary format intended to be compatible with an old format
used inside Google called <code>MessageSet</code>. Users outside Google will probably
never need to use this option. The message must be declared exactly as
follows:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>option</span> <span style=color:#000>message_set_wire_format</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>extensions</span> <span style=color:#0000cf;font-weight:700>4</span> <span style=color:#204a87;font-weight:700>to</span> <span style=color:#204a87;font-weight:700>max</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div></li><li><p><code>packed</code> (field option): If set to <code>true</code> on a repeated field of a basic
numeric type, it causes a more compact
<a href=/programming-guides/encoding#packed>encoding</a> to be
used. The only reason to not use this option is if you need compatibility
with parsers prior to version 2.3.0. These older parsers would ignore packed
data when it was not expected. Therefore, it was not possible to change an
existing field to packed format without breaking wire compatibility. In
2.3.0 and later, this change is safe, as parsers for packable fields will
always accept both formats, but be careful if you have to deal with old
programs using old protobuf versions.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>samples</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>4</span> <span style=color:#000;font-weight:700>[</span><span style=color:#204a87;font-weight:700>packed</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span></code></pre></div></li><li><p><code>deprecated</code> (field option): If set to <code>true</code>, indicates that the field is
deprecated and should not be used by new code. In most languages this has no
actual effect. In Java, this becomes a <code>@Deprecated</code> annotation. For C++,
clang-tidy will generate warnings whenever deprecated fields are used. In
the future, other language-specific code generators may generate deprecation
annotations on the field&rsquo;s accessors, which will in turn cause a warning to
be emitted when compiling code which attempts to use the field. If the field
is not used by anyone and you want to prevent new users from using it,
consider replacing the field declaration with a <a href=#fieldreserved>reserved</a>
statement.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>old_field</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>6</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>deprecated</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span></code></pre></div></li></ul><h3 id=enum-value-options>Enum Value Options</h3><p>Enum value options are supported. You can use the <code>deprecated</code> option to
indicate that a value shouldn&rsquo;t be used anymore. You can also create custom
options using extensions.</p><p>The following example shows the syntax for adding these options:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;google/protobuf/descriptor.proto&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>protobuf.EnumValueOptions</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>string_name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>123456789</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>Data</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>DATA_UNSPECIFIED</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>DATA_SEARCH</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>deprecated</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>DATA_DISPLAY</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>[</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000;font-weight:700>(</span><span style=color:#000>string_name</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;display_value&#34;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>The C++ code to read the <code>string_name</code> option might look something like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>absl</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>string_view</span> <span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>proto2</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>GetEnumDescriptor</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Data</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>FindValueByName</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;DATA_DISPLAY&#34;</span><span style=color:#000;font-weight:700>)</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>options</span><span style=color:#000;font-weight:700>().</span><span style=color:#000>GetExtension</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>string_name</span><span style=color:#000;font-weight:700>);</span>
</span></span></code></pre></div><p>See <a href=#customoptions>Custom Options</a> to see how to apply custom options to enum
values and to fields.</p><h3 id=customoptions>Custom Options</h3><p>Protocol Buffers also allows you to define and use your own options. Note that
this is an <strong>advanced feature</strong> which most people don&rsquo;t need. Since options are
defined by the messages defined in <code>google/protobuf/descriptor.proto</code> (like
<code>FileOptions</code> or <code>FieldOptions</code>), defining your own options is simply a matter
of <a href=#extensions>extending</a> those messages. For example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;google/protobuf/descriptor.proto&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>protobuf.MessageOptions</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>my_option</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>51234</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>MyMessage</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>option</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>my_option</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;Hello world!&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>Here we have defined a new message-level option by extending <code>MessageOptions</code>.
When we then use the option, the option name must be enclosed in parentheses to
indicate that it is an extension. We can now read the value of <code>my_option</code> in
C++ like so:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>value</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>MyMessage</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>descriptor</span><span style=color:#000;font-weight:700>()</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000;font-weight:700>&gt;</span><span style=color:#000>options</span><span style=color:#000;font-weight:700>()</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>GetExtension</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>my_option</span><span style=color:#000;font-weight:700>);</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>Here, <code>MyMessage::descriptor()->options()</code> returns the <code>MessageOptions</code> protocol
message for <code>MyMessage</code>. Reading custom options from it is just like reading any
other <a href=#extensions>extension</a>.</p><p>Similarly, in Java we would write:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>String</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>value</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>MyProtoFile</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>MyMessage</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getDescriptor</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>getOptions</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getExtension</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>MyProtoFile</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>myOption</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>In Python it would be:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>value</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>my_proto_file_pb2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>MyMessage</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>DESCRIPTOR</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>GetOptions</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Extensions</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>my_proto_file_pb2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>my_option</span><span style=color:#000;font-weight:700>]</span>
</span></span></code></pre></div><p>Custom options can be defined for every kind of construct in the Protocol
Buffers language. Here is an example that uses every kind of option:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;google/protobuf/descriptor.proto&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>protobuf.FileOptions</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>my_file_option</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>50000</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>protobuf.MessageOptions</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>my_message_option</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>50001</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>protobuf.FieldOptions</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>float</span> <span style=color:#000>my_field_option</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>50002</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>protobuf.OneofOptions</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int64</span> <span style=color:#000>my_oneof_option</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>50003</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>protobuf.EnumOptions</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>bool</span> <span style=color:#000>my_enum_option</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>50004</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>protobuf.EnumValueOptions</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>uint32</span> <span style=color:#000>my_enum_value_option</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>50005</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>protobuf.ServiceOptions</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>MyEnum</span> <span style=color:#000>my_service_option</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>50006</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>protobuf.MethodOptions</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>MyMessage</span> <span style=color:#000>my_method_option</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>50007</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>option</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>my_file_option</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;Hello world!&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>MyMessage</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>option</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>my_message_option</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1234</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>[(</span><span style=color:#000>my_field_option</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>4.5</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>bar</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>oneof</span> <span style=color:#000>qux</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>option</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>my_oneof_option</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>42</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>quux</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>MyEnum</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>option</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>my_enum_option</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>FOO</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>[(</span><span style=color:#000>my_enum_value_option</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>321</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>BAR</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>RequestType</span> <span style=color:#000;font-weight:700>{}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>ResponseType</span> <span style=color:#000;font-weight:700>{}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>service</span> <span style=color:#000>MyService</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>option</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>my_service_option</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>FOO</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>rpc</span> <span style=color:#000>MyMethod</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>RequestType</span><span style=color:#000;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>returns</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ResponseType</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#8f5902;font-style:italic>// Note:  my_method_option has type MyMessage.  We can set each field
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#8f5902;font-style:italic>//   within it using a separate &#34;option&#34; line.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#204a87;font-weight:700>option</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>my_method_option</span><span style=color:#000;font-weight:700>)</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>567</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>option</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>my_method_option</span><span style=color:#000;font-weight:700>)</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bar</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;Some string&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>Note that if you want to use a custom option in a package other than the one in
which it was defined, you must prefix the option name with the package name,
just as you would for type names. For example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// foo.proto
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;google/protobuf/descriptor.proto&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>foo</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>protobuf.MessageOptions</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>my_option</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>51234</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// bar.proto
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;foo.proto&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>bar</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>MyMessage</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>option</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>foo.my_option</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;Hello world!&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>One last thing: Since custom options are extensions, they must be assigned field
numbers like any other field or extension. In the examples earlier, we have used
field numbers in the range 50000-99999. This range is reserved for internal use
within individual organizations, so you can use numbers in this range freely for
in-house applications. If you intend to use custom options in public
applications, however, then it is important that you make sure that your field
numbers are globally unique. To obtain globally unique field numbers, send a
request to add an entry to
<a href=https://github.com/protocolbuffers/protobuf/blob/master/docs/options.md>protobuf global extension registry</a>.
Usually you only need one extension number. You can declare multiple options
with only one extension number by putting them in a sub-message:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>FooOptions</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>opt1</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>opt2</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>protobuf.FieldOptions</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>FooOptions</span> <span style=color:#000>foo_options</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1234</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>// usage:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Bar</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>a</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>[(</span><span style=color:#000>foo_options</span><span style=color:#000;font-weight:700>)</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>opt1</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>123</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>foo_options</span><span style=color:#000;font-weight:700>)</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>opt2</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;baz&#34;</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// alternative aggregate syntax (uses TextFormat):
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>b</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>[(</span><span style=color:#000>foo_options</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>opt1</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>123</span> <span style=color:#000>opt2</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;baz&#34;</span> <span style=color:#000;font-weight:700>}];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>Also, note that each option type (file-level, message-level, field-level, etc.)
has its own number space, so, for example, you could declare extensions of
FieldOptions and MessageOptions with the same number.</p><h3 id=option-retention>Option Retention</h3><p>Options have a notion of <em>retention</em>, which controls whether an option is
retained in the generated code. Options have <em>runtime retention</em> by default,
meaning that they are retained in the generated code and are thus visible at
runtime in the generated descriptor pool. However, you can set <code>retention = RETENTION_SOURCE</code> to specify that an option (or field within an option) must not
be retained at runtime. This is called <em>source retention</em>.</p><p>Option retention is an advanced feature that most users should not need to worry
about, but it can be useful if you would like to use certain options without
paying the code size cost of retaining them in your binaries. Options with
source retention are still visible to <code>protoc</code> and <code>protoc</code> plugins, so code
generators can use them to customize their behavior.</p><p>Retention can be set directly on an option, like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>protobuf.FileOptions</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>source_retention_option</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1234</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>      <span style=color:#000;font-weight:700>[</span><span style=color:#000>retention</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>RETENTION_SOURCE</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>It can also be set on a plain field, in which case it takes effect only when
that field appears inside an option:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>OptionsMessage</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>source_retention_field</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>retention</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>RETENTION_SOURCE</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>You can set <code>retention = RETENTION_RUNTIME</code> if you like, but this has no effect
since it is the default behavior. When a message field is marked
<code>RETENTION_SOURCE</code>, its entire contents are dropped; fields inside it cannot
override that by trying to set <code>RETENTION_RUNTIME</code>.</p><div class="alert alert-note" role=alert><h4 class=alert-heading>Note</h4>As
of Protocol Buffers 22.0, support for option retention is still in progress and
only C++ and Java are supported. Go has support starting from 1.29.0. Python
support is complete but has not made it into a release yet.</div><h3 id=option-targets>Option Targets</h3><p>Fields have a <code>targets</code> option which controls the types of entities that the
field may apply to when used as an option. For example, if a field has
<code>targets = TARGET_TYPE_MESSAGE</code> then that field cannot be set in a custom option
on an enum (or any other non-message entity). Protoc enforces this and will
raise an error if there is a violation of the target constraints.</p><p>At first glance, this feature may seem unnecessary given that every custom
option is an extension of the options message for a specific entity, which
already constrains the option to that one entity. However, option targets are
useful in the case where you have a shared options message applied to multiple
entity types and you want to control the usage of individual fields in that
message. For example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>MyOptions</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>file_only_option</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>targets</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>TARGET_TYPE_FILE</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>message_and_enum_option</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>targets</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>TARGET_TYPE_MESSAGE</span><span style=color:#000;font-weight:700>,</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>                                              <span style=color:#000>targets</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>TARGET_TYPE_ENUM</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>protobuf.FileOptions</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>MyOptions</span> <span style=color:#000>file_options</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>50000</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>protobuf.MessageOptions</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>MyOptions</span> <span style=color:#000>message_options</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>50000</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>protobuf.EnumOptions</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>MyOptions</span> <span style=color:#000>enum_options</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>50000</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>// OK: this field is allowed on file options
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>option</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>file_options</span><span style=color:#000;font-weight:700>)</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>file_only_option</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;abc&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>MyMessage</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// OK: this field is allowed on both message and enum options
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>option</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>message_options</span><span style=color:#000;font-weight:700>)</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>message_and_enum_option</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>42</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>MyEnum</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>MY_ENUM_UNSPECIFIED</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Error: file_only_option cannot be set on an enum.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>option</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>enum_options</span><span style=color:#000;font-weight:700>)</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>file_only_option</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;xyz&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><h2 id=generating>Generating Your Classes</h2><p>To generate the Java, Kotlin, Python, C++, Go, Ruby, Objective-C, or C# code
that you need to work with the message types defined in a <code>.proto</code> file, you
need to run the protocol buffer compiler <code>protoc</code> on the <code>.proto</code> file. If you
haven&rsquo;t installed the compiler,
<a href=/downloads>download the package</a> and follow the
instructions in the README. For Go, you also need to install a special code
generator plugin for the compiler; you can find this and installation
instructions in the <a href=https://github.com/golang/protobuf/>golang/protobuf</a>
repository on GitHub.</p><p>The Protocol Compiler is invoked as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>protoc --proto_path<span style=color:#ce5c00;font-weight:700>=</span>IMPORT_PATH --cpp_out<span style=color:#ce5c00;font-weight:700>=</span>DST_DIR --java_out<span style=color:#ce5c00;font-weight:700>=</span>DST_DIR --python_out<span style=color:#ce5c00;font-weight:700>=</span>DST_DIR --go_out<span style=color:#ce5c00;font-weight:700>=</span>DST_DIR --ruby_out<span style=color:#ce5c00;font-weight:700>=</span>DST_DIR --objc_out<span style=color:#ce5c00;font-weight:700>=</span>DST_DIR --csharp_out<span style=color:#ce5c00;font-weight:700>=</span>DST_DIR path/to/file.proto
</span></span></code></pre></div><ul><li><p><code>IMPORT_PATH</code> specifies a directory in which to look for <code>.proto</code> files when
resolving <code>import</code> directives. If omitted, the current directory is used.
Multiple import directories can be specified by passing the <code>--proto_path</code>
option multiple times; they will be searched in order. <code>-I=_IMPORT_PATH_</code>
can be used as a short form of <code>--proto_path</code>.</p></li><li><p>You can provide one or more <em>output directives</em>:</p><ul><li><code>--cpp_out</code> generates C++ code in <code>DST_DIR</code>. See the
<a href=/reference/cpp/cpp-generated>C++ generated code reference</a>
for more.</li><li><code>--java_out</code> generates Java code in <code>DST_DIR</code>. See the
<a href=/reference/java/java-generated>Java generated code reference</a>
for more.</li><li><code>--kotlin_out</code> generates additional Kotlin code in <code>DST_DIR</code>. See the
<a href=/reference/kotlin/kotlin-generated>Kotlin generated code reference</a>
for more.</li><li><code>--python_out</code> generates Python code in <code>DST_DIR</code>. See the
<a href=/reference/python/python-generated>Python generated code reference</a>
for more.</li><li><code>--go_out</code> generates Go code in <code>DST_DIR</code>. See the
<a href=/reference/go/go-generated-opaque>Go generated code reference</a>
for more.</li><li><code>--ruby_out</code> generates Ruby code in <code>DST_DIR</code>. See the
<a href=/reference/ruby/ruby-generated>Ruby generated code reference</a>
for more.</li><li><code>--objc_out</code> generates Objective-C code in <code>DST_DIR</code>. See the
<a href=/reference/objective-c/objective-c-generated>Objective-C generated code reference</a>
for more.</li><li><code>--csharp_out</code> generates C# code in <code>DST_DIR</code>. See the
<a href=/reference/csharp/csharp-generated>C# generated code reference</a>
for more.</li><li><code>--php_out</code> generates PHP code in <code>DST_DIR</code>. See the
<a href=/reference/php/php-generated>PHP generated code reference</a>
for more.</li></ul><p>As an extra convenience, if the <code>DST_DIR</code> ends in <code>.zip</code> or <code>.jar</code>, the
compiler will write the output to a single ZIP-format archive file with the
given name. <code>.jar</code> outputs will also be given a manifest file as required by
the Java JAR specification. Note that if the output archive already exists,
it will be overwritten.</p></li><li><p>You must provide one or more <code>.proto</code> files as input. Multiple <code>.proto</code>
files can be specified at once. Although the files are named relative to the
current directory, each file must reside in one of the <code>IMPORT_PATH</code>s so
that the compiler can determine its canonical name.</p></li></ul><h2 id=location>File location</h2><p>Prefer not to put <code>.proto</code> files in the same
directory as other language sources. Consider
creating a subpackage <code>proto</code> for <code>.proto</code> files, under the root package for
your project.</p><h3 id=location-language-agnostic>Location Should be Language-agnostic</h3><p>When working with Java code, it&rsquo;s handy to put related <code>.proto</code> files in the
same directory as the Java source. However, if any non-Java code ever uses the
same protos, the path prefix will no longer make sense. So in
general, put the protos in a related language-agnostic directory such as
<code>//myteam/mypackage</code>.</p><p>The exception to this rule is when it&rsquo;s clear that the protos will be used only
in a Java context, such as for testing.</p><h2 id=platforms>Supported Platforms</h2><p>For information about:</p><ul><li>the operating systems, compilers, build systems, and C++ versions that are
supported, see
<a href=https://opensource.google/documentation/policies/cplusplus-support>Foundational C++ Support Policy</a>.</li><li>the PHP versions that are supported, see
<a href=https://cloud.google.com/php/getting-started/supported-php-versions>Supported PHP versions</a>.</li></ul></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow" aria-label="Stack Overflow"><a class=text-white target=_blank rel=noopener href=https://stackoverflow.com/questions/tagged/protocol-buffers aria-label="Stack Overflow"><i class="fab fa-stack-overflow"></i></a></li></ul><script type=text/javascript id=cookiebanner src=https://cdn.jsdelivr.net/gh/dobarkod/cookie-banner@1.2.2/dist/cookiebanner.min.js data-height=50px data-message="Protobuf.dev uses cookies from Google to deliver and enhance the quality of its services and to analyze traffic." data-bg=#ffb data-fg=#000 data-position=bottom data-padding="10px 16px" data-close-text="OK, got it" data-font-size=18px data-moreinfo=https://policies.google.com/technologies/cookies></script></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/protocolbuffers/protobuf aria-label=GitHub><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Developer mailing list" aria-label="Developer mailing list"><a class=text-white target=_blank rel=noopener href=https://groups.google.com/g/protobuf aria-label="Developer mailing list"><i class="fa fa-envelope"></i></a></li></ul><script type=text/javascript id=cookiebanner src=https://cdn.jsdelivr.net/gh/dobarkod/cookie-banner@1.2.2/dist/cookiebanner.min.js data-height=50px data-message="Protobuf.dev uses cookies from Google to deliver and enhance the quality of its services and to analyze traffic." data-bg=#ffb data-fg=#000 data-position=bottom data-padding="10px 16px" data-close-text="OK, got it" data-font-size=18px data-moreinfo=https://policies.google.com/technologies/cookies></script></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2025 Google LLC All Rights Reserved</small>
<small class=ml-1><a href=https://policies.google.com/privacy target=_blank rel=noopener>Privacy Policy</a></small>
<span class=text-white>Hosted by GitHub Pages.</span> <a href=https://docs.github.com/en/site-policy/privacy-policies/github-privacy-statement target=_blank>GitHub Privacy Statement</a></div></div></div></footer></div><script src=/js/main.min.c91cdfdcc1576ecc360abc6f1c3ca0485d047f65ac6d3203ec57ed29e0af808b.js integrity="sha256-yRzf3MFXbsw2CrxvHDygSF0Ef2WsbTID7FftKeCvgIs=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>